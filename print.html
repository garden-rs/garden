<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Garden User Guide</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="Garden grows and cultivates Git trees">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Garden</a></li><li class="chapter-item expanded "><a href="glossary.html"><strong aria-hidden="true">2.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">3.</strong> Installation</a></li><li class="chapter-item expanded "><a href="setup-and-usage.html"><strong aria-hidden="true">4.</strong> Setup and Usage</a></li><li class="chapter-item expanded "><a href="tree-queries.html"><strong aria-hidden="true">5.</strong> Tree Queries</a></li><li class="chapter-item expanded "><a href="commands.html"><strong aria-hidden="true">6.</strong> Commands</a></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">7.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="examples.html"><strong aria-hidden="true">8.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/photo-restoration.html"><strong aria-hidden="true">8.1.</strong> Photo Restoration</a></li><li class="chapter-item expanded "><a href="examples/git-cola.html"><strong aria-hidden="true">8.2.</strong> Git Cola</a></li><li class="chapter-item expanded "><a href="examples/command-interpreters.html"><strong aria-hidden="true">8.3.</strong> Custom Interpreters</a></li><li class="chapter-item expanded "><a href="examples/python.html"><strong aria-hidden="true">8.4.</strong> Python</a></li><li class="chapter-item expanded "><a href="examples/node.html"><strong aria-hidden="true">8.5.</strong> Node</a></li></ol></li><li class="chapter-item expanded "><a href="changelog.html"><strong aria-hidden="true">9.</strong> Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Garden User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://gitlab.com/garden-rs/garden/tree/main/doc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-gitlab"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="garden-user-guide"><a class="header" href="#garden-user-guide">Garden User Guide</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Garden streamlines development workflows that involve a loosely-coupled set of
multiple, independent Git trees.</p>
<p>Garden allows you to define dynamic relationships and workflows between these
repositories using a YAML configuration file that can be shared and used as
a bootstrapping mechanism for getting an audit-able, from-source project cloned,
built, installed and running with minimal effort for consumers of a Garden file.</p>
<p>Garden sits above any individual project's build scripts and conventions.
Garden is all about making it easy to remix and reuse libraries maintained
in separate Git repositories.</p>
<h3 id="project-links"><a class="header" href="#project-links">Project Links</a></h3>
<ul>
<li>
<p><a href="https://gitlab.com/garden-rs/garden">Garden source code repository</a></p>
</li>
<li>
<p><a href="https://crates.io/crates/garden-tools">Garden crates.io package</a></p>
</li>
<li>
<p><a href="https://gitlab.com/garden-rs/homebrew-garden">Garden Homebrew formula</a></p>
</li>
<li>
<p><a href="https://cdn.netbsd.org/pub/pkgsrc/current/pkgsrc/devel/garden/index.html">Garden NetBSD pkgsrc</a></p>
</li>
<li>
<p><a href="https://docs.rs/garden-tools">Garden API Documentation</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<ul>
<li>
<p><em><strong>garden.yaml</strong></em> -- also known as a &quot;Garden file&quot;, a YAML file named
<code>garden.yaml</code> defines trees, groups gardens, variables, commands and
environment variables. <code>garden</code> looks for a file named <code>garden.yaml</code>
by default, but other filenames can be specified using the
<code>garden -c | --config &lt;path&gt;</code> option.</p>
</li>
<li>
<p><em><strong>trees</strong></em> -- trees represent Git worktrees and repository clones.
A tree represents a single repository and its configuration.
Trees provide <em>garden variables</em>, <em>commands</em> and <em>environment variables</em>
that are defined when commands are run on a tree. Environment variables
are defined when a tree is operated on by itself and when combined alongside
other trees in a group or garden context.</p>
</li>
<li>
<p><em><strong>groups</strong></em> -- a named collection of trees. The <code>groups</code> block in the
garden file defines groups of trees that are available for use by
commands and gardens. Groups are lighter-weight than a garden and group
trees together into named collections that can be referenced by gardens
and commands. In contrast to gardens, groups <em>do not</em> provide a scope
in which variables, commands environment variables can be defined.</p>
</li>
<li>
<p><em><strong>garden</strong></em> -- a composite of trees and groups for defining project-level
variables, commands and environment variables. Gardens help create
environments for working on projects composed of multiple Git repositories.
The <code>gardens</code> YAML key/value block defines named gardens with a scope
in which garden-specific variables, commands and environment variables
can be defined.</p>
</li>
<li>
<p><strong>variables</strong>
A YAML key/value table defines named variables that can be used in
YAML strings by using braced <code>shell ${expressions}</code> to provide dynamic
values that can be used to provide modularity and configurability to a garden
file. Variables defined in a garden file are overridden on the
command-line by using the <code>-D / --define key=value</code> option.</p>
</li>
<li>
<p><strong>commands</strong>
The <code>commands</code> YAML key/value table defines named commands that can be run
against trees. The <code>commands</code> block extends <code>garden</code> with with user-defined
functionality. The <code>commands</code> block can be defined at global scope, within a
<code>tree</code> block, and within a <code>garden</code> block. The scope in which a command is
defined limits the scope in which it is visible. This means that a command
defined in tree scope will only execute when <code>garden &lt;command&gt; &lt;query&gt;</code>
uses a query that ends up including that tree, and will only run when garden
visits that specific tree.</p>
</li>
<li>
<p><strong>environment variables</strong>
Not to be confused with the <code>variables</code> block, the <code>environment</code> block
is a YAML key/value table that defines environment variables that will
be set when executing <em>commands</em>.</p>
</li>
<li>
<p><em><strong>tree query</strong></em> -- a <a href="https://github.com/netvl/shellexpand">shellexpand</a> glob expression that matches against
garden names, group names and tree names. Several <code>garden</code> builtin commands
take tree queries as arguments as a mechanism for selecting one or more
trees to operate on. The default behavior is to match the tree query pattern
against gardens, groups and trees, in that order, and return the first
matching set of trees. If searching for gardens finds matches then groups and
trees are not searched. If searching for groups finds matches then trees are
not searched. Prefix the tree query pattern with a percent-sign (<code>%</code>),
e.g. <code>%group*</code>, to only query for groups matching the pattern.
Prefix the pattern with an at-sign (<code>@</code>), e.g. <code>@tree</code>, to only query for trees.
Prefix the pattern with colon (<code>:</code>), e.g. <code>:garden</code>, to only query for gardens.
The <code>:garden</code> syntax is not typically used because gardens are already
searched first. <code>%group</code> and <code>@tree</code> can be used to disambiguate queries for
groups and trees that share the same name as a garden.</p>
</li>
<li>
<p><strong>string expressions</strong>
String values can use shell <code>${variables}</code> expressions to interpolate
and expand values in the string. <code>~</code> is expanded to <code>$HOME</code>.
These expressions can be used in most fields where strings are accepted,
e.g. when defining variables, commands and environment variables.</p>
</li>
<li>
<p><strong>exec expressions</strong>
When a <em>string expression</em> starts with <code>$ </code> (dollar-sign then space) then the
variable's value is computed by expanding the string's <code>${garden}</code> variables
and then executing the result and capturing stdout. The captured stdout
output from the command becomes the variable's value. For example, if a
variable called <code>my-pwd</code> is defined using an exec expression such as
<code>my-pwd: $ pwd</code> then the <code>${my_pwd}</code> variable will contain a path.
The <code>my_pwd</code> variable can be used to define other variables, environment
variables, and commands. For example, a command called <code>example-cmd</code> can be
defined using: <code>example-cmd: ls -l ${my-pwd} &amp;&amp; echo my_pwd is ${my_pwd}</code>,</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>There are multiple ways to install <code>garden</code>.</p>
<p>These instructions assume that you have <code>cargo</code> installed for Rust development.</p>
<p><a href="installation.html#install-using-homebrew">Skip ahead to the Homebrew section</a> if you're on macOS
and prefer to install <code>garden</code> using Homebrew.</p>
<p><a href="installation.html#install-on-netbsd">Skip ahead to the NetBSD section</a> if you're on NetBSD
and prefer to install <code>garden</code> using <code>pkgin</code> or the pkgsrc/NetBSD sources.</p>
<h2 id="rust-and-cargo"><a class="header" href="#rust-and-cargo">Rust and Cargo</a></h2>
<p>If you already have <code>cargo</code> installed then you can skip this section.</p>
<p>You may be able to install <code>cargo</code> on macOS and Linux using standard package
managers, e.g. <code>brew install rust</code> or <code>apt install rust-all</code>.</p>
<p>Other platforms and older distributions can get a Rust development toolchain
by going to <a href="https://rustup.rs">rustup.rs and following the installation instructions</a>.</p>
<h2 id="cratesio"><a class="header" href="#cratesio">Crates.io</a></h2>
<p>This requires at least Rust 1.45 and Cargo to be installed. Once you have
installed Rust, type the following in the terminal:</p>
<pre><code>cargo install garden-tools
</code></pre>
<p>This will download and compile garden for you. The only thing left to do is
to add the Cargo <code>$HOME/.cargo/bin</code> directory to your <code>$PATH</code>.</p>
<h2 id="latest-using-cargo"><a class="header" href="#latest-using-cargo">Latest using Cargo</a></h2>
<p>The version published to crates.io will sometimes be behind the source
code repository. If you want to install the latest pre-release version then you can
build the Git version of Garden yourself using <code>cargo</code>.</p>
<pre><code>cargo install --git https://gitlab.com/garden-rs/garden.git garden-tools
</code></pre>
<h2 id="install-using-homebrew"><a class="header" href="#install-using-homebrew">Install using Homebrew</a></h2>
<p>You can install <code>garden</code> on macOS using <a href="https://brew.sh/">Homebrew</a>.</p>
<h3 id="add-the-homebrew-garden-tap"><a class="header" href="#add-the-homebrew-garden-tap">Add the homebrew-garden tap</a></h3>
<p><em>NOTE</em>: The custom <code>brew tap</code> will not be needed in the future once the
<a href="https://github.com/Homebrew/homebrew-core/pull/119195">Garden repository gets enough stars, forks or watchers</a>
to allow <code>garden</code> to be added to the main homebrew-core repository.</p>
<p>You will need to enable the <code>homebrew-garden</code> tap until then.</p>
<pre><code class="language-bash">brew tap garden-rs/garden https://gitlab.com/garden-rs/homebrew-garden
</code></pre>
<h3 id="stable-release"><a class="header" href="#stable-release">Stable Release</a></h3>
<p>To install the latest stable release from the <code>homebrew-garden</code> tap:</p>
<pre><code class="language-bash">brew install garden
</code></pre>
<p>Upgrade <code>garden</code> in the future by using <code>brew upgrade garden</code>.</p>
<h3 id="development-version"><a class="header" href="#development-version">Development Version</a></h3>
<p>To install the latest development version from Git:</p>
<pre><code class="language-bash">brew install --head garden
</code></pre>
<p><em>NOTE</em>: If you install the latest development version with <code>--head</code> then you will need to use
<code>brew upgrade --fetch-HEAD garden</code>  to upgrade it.</p>
<p>If you don't specify <code>--fetch-HEAD</code> when upgrading then <code>brew upgrade garden</code> will
actually downgrade <code>garden</code> to the latest stable release.</p>
<h3 id="cleanup"><a class="header" href="#cleanup">Cleanup</a></h3>
<p>Installing <code>garden</code> with Homebrew may leave behind the Rust development tools.</p>
<p>Use <code>brew remove rust</code> after <code>garden</code> is installed to save on disk space.</p>
<p>Read on for how to build garden from source.</p>
<h2 id="install-on-netbsd"><a class="header" href="#install-on-netbsd">Install on NetBSD</a></h2>
<p>Garden has been packaged for
<a href="http://mail-index.netbsd.org/pkgsrc-changes/2023/01/22/msg267560.html">pkgsrc/NetBSD</a>
as described in <a href="https://github.com/davvid/garden/issues/13">#13</a>.</p>
<p>To install from the official repository, run:</p>
<pre><code class="language-bash">pkgin install garden
</code></pre>
<p>If you prefer to build from the pkgsrc sources, run:</p>
<pre><code class="language-bash">cd /usr/pkgsrc/devel/garden
make install
</code></pre>
<h2 id="build-and-install-from-source-for-development"><a class="header" href="#build-and-install-from-source-for-development">Build and Install from Source for Development</a></h2>
<p>If you would like to develop features and contribute to Garden then you will
have to clone the repository on your local machine.</p>
<pre><code class="language-bash">git clone https://gitlab.com/garden-rs/garden.git
cd garden

# Build ./target/debug/garden
cargo build

# Install $HOME/.cargo/bin/garden
cargo install --path .
</code></pre>
<p>Running <code>cargo install</code> with no arguments installs to <code>~/.cargo/bin/garden</code> by default.</p>
<p>Once you have <code>garden</code> installed then you can use Garden's <code>garden.yaml</code> to run
Garden's custom workflow commands.</p>
<ul>
<li><code>garden test</code> runs the test suite using <code>cargo test</code>.</li>
<li><code>garden check</code> runs checks and lints.</li>
<li><code>garden doc</code> builds the documentation.</li>
<li><code>garden fmt</code> formats the source code.</li>
<li><code>garden install-doc</code> installs the documentation.</li>
</ul>
<p>See Garden's <code>garden.yaml</code> for more details.</p>
<h2 id="nix-flakes"><a class="header" href="#nix-flakes">Nix Flakes</a></h2>
<p><a href="https://nixos.wiki/wiki/Flakes">Nix Flakes</a> can be used to build, test and install <code>garden</code>.
A <code>flake.nix</code> file is provided in the source tree.</p>
<p><a href="https://nixos.wiki/wiki/Flakes#Enable_flakes_permanently_in_NixOS">Enabling flakes permanently</a>
is recommended by either adding <code>experimental-features = nix-command flakes</code> to your
<code>~/.config/nix/nix.conf</code> or <code>/etc/nix/nix.conf</code>, or by using
<a href="https://nixos.wiki/wiki/Flakes#Other_Distros.2C_with_Home-Manager">Home Manager</a>
to install flakes.</p>
<p>The following commands are available once installed.</p>
<ul>
<li><code>nix build</code> builds the <code>garden</code> package.</li>
<li><code>nix shell</code> opens a shell with <code>garden</code> installed.</li>
<li><code>nix develop</code> opens a development shell with <code>garden</code> and <code>cargo</code> installed.</li>
<li><code>nix flake check</code> builds <code>garden</code> and runs the test suite.</li>
</ul>
<h3 id="activating-gardens-nix-package"><a class="header" href="#activating-gardens-nix-package">Activating Garden's Nix Package</a></h3>
<p>The <code>nix shell</code> command above only works when run from <code>garden</code>'s source tree.
A separate <code>nix-shell</code> command can be used to get a shell with <code>garden</code> from any
directory by using the package's <a href="https://nixos.org/manual/nix/stable/store/">Nix Store</a>
location. To do this we need to get the package's nix store output path.</p>
<p>Garden's nix derivation can be inspected using <code>nix derivation show</code>.
The <code>output.path</code> field contains the Nix Store location of the <code>nix</code> package.
For example, <code>nix derivation show</code> will contain output that looks like the following:</p>
<pre><code class="language-yaml">{
  &quot;/nix/store/n92qrx1j889bl2ippabpghsr4kyqbknh-garden-tools-1.0.0-beta2.drv&quot;: {
    # ...
    &quot;outputs&quot;: {
      &quot;out&quot;: {
        &quot;path&quot;: &quot;/nix/store/8i7pgb529lq8id1z4xfmcyh8xsc4w6q0-garden-tools-1.0.0-beta2&quot;
      }
    },
    # ...
  }
}
</code></pre>
<p>You can use these details to open a shell with your previously-built <code>garden</code> package.</p>
<pre><code class="language-bash">`nix-shell -p /nix/store/8i7pgb529lq8id1z4xfmcyh8xsc4w6q0-garden-tools-1.0.0-beta2
</code></pre>
<h2 id="windows"><a class="header" href="#windows">Windows</a></h2>
<p>Garden is developed on Linux and supported on macOS and BSDs where Rust is available.</p>
<p>Garden is not supported on Windows.</p>
<p>Garden &quot;should&quot; work fine on Windows if you install a shell (e.g. <code>bash.exe</code> or
<code>zsh.exe</code>) in <code>$PATH</code> and patch a few details to deal with Windows-isms, but Garden is
untested and not supported by the core team on Windows or WSL.</p>
<p>Issues related to Windows will be closed. Pull requests related to these systems are
welcome as long as they do not clutter the core or test suite with Windows-isms.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-and-usage"><a class="header" href="#setup-and-usage">Setup and Usage</a></h1>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>A garden can be created in any directory. Run <code>garden init</code> to create
an empty &quot;garden.yaml&quot; file for defining trees, groups and gardens.</p>
<pre><code class="language-bash"># Create an empty &quot;garden.yaml&quot; in the current directory.
garden init
</code></pre>
<p>By default, the garden.yaml is configured to operate on trees in the
current directory relative to the garden file. The <code>garden</code> command
searches the current directory for a &quot;garden.yaml&quot; config file.</p>
<p>If no &quot;garden.yaml&quot; could be found in the current directory then <code>garden</code>
will attempt to load a &quot;global&quot; configuration file, typically located in
<code>~/.config/garden/garden.yaml</code>.</p>
<p>The following <code>garden init</code> invocation creates an empty <code>garden.yaml</code> with a
root directory of <code>~/src</code> in the user's home configuration directory. This is
typically <code>~/.config/garden/garden.yaml</code>.</p>
<pre><code class="language-bash">garden init --global --root '~/src'
</code></pre>
<p>This allows you to access the config irrespective of the current directory and
perform garden operations without needing to <code>cd</code> into <code>~/src/</code> to do so.</p>
<p>If multiple configuration files are made available in <code>~/.config/garden</code>, then
using <code>garden -c alt.yaml ...</code> from <em><strong>any</strong></em> directory (without specifying an
absolute path) will use the <code>alt.yaml</code> garden file.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Now that we know how to create a <code>garden.yaml</code> we can start using garden to
track our development repositories.</p>
<p>When we have a <code>~/src/garden.yaml</code> file with Git worktrees alongside it in the
<code>~/src</code> directory then we can start adding those trees to the garden file.
Existing trees are added to a garden file using <code>garden plant &lt;tree&gt;</code>.</p>
<p>Once we have a garden file with trees in it then we can use the garden file to
recreate our setup using <code>garden grow</code>. The <code>garden grow</code> command brings trees
into existence by cloning trees that have been configured in a garden file.</p>
<p>Garden commands are used to operate over sets of trees once a configuration
has been defined. See the <a href="commands.html">Garden Commands Documentation</a> for
detailed information about the built-in garden commands.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tree-queries"><a class="header" href="#tree-queries">Tree Queries</a></h1>
<p>Garden commands take arguments that specify which groups, gardens or trees to
operate on. Tree queries are strings that resolve to a set of trees.</p>
<p>Command arguments with garden, group or tree names, <code>@tree</code> references,
<code>%group</code> references, <code>:garden</code> references and wildcards are all referred to as
&quot;tree queries&quot;.</p>
<p>When a name is specified, garden will use the first matching garden, group or
tree, in that order, when determining which trees to operate on.  When a
garden or group is matched, all of its associated trees are used.</p>
<h2 id="resolving-trees-groups-or-gardens-only"><a class="header" href="#resolving-trees-groups-or-gardens-only">Resolving Trees, Groups or Gardens Only</a></h2>
<p>If you have groups, gardens, and trees with the same name then you can use the
<code>@tree</code>, <code>%group</code>, and <code>:garden</code> syntax to disambiguate between them.</p>
<ul>
<li><em><strong>@tree</strong></em> - values prefixed with <code>@</code> resolve trees only</li>
<li><em><strong>%group</strong></em> - values prefixed with <code>%</code> resolve groups only</li>
<li><em><strong>:garden</strong></em> - values prefixed with <code>:</code> resolve gardens only</li>
</ul>
<pre><code class="language-bash">garden grow @tree      # grow the tree called &quot;tree&quot;
garden grow %group     # grow the group called &quot;group&quot;
garden grow :garden    # grow the garden called &quot;garden&quot;
</code></pre>
<p>When no prefixes are specified then the names are resolved in the following
order: gardens, groups and trees.</p>
<p>Gardens have the highest priority, followed by groups and lastly trees. If
your trees, groups and gardens are named uniquely then no prefixes are needed.</p>
<h2 id="tree-queries-resolve-to-multiple-trees"><a class="header" href="#tree-queries-resolve-to-multiple-trees">Tree Queries Resolve to Multiple Trees</a></h2>
<p>In the following example, the &quot;cola&quot; garden is found in the example
configuration. Each command is run over every tree in that garden.</p>
<pre><code class="language-bash"># Run &quot;git status -s&quot; over each tree in the &quot;cola&quot; garden.
garden exec cola git status -s
# Run the custom &quot;status&quot; command over each tree in the &quot;cola&quot; garden.
garden status cola
# Run the &quot;status&quot; and &quot;build&quot; commands over each tree in the &quot;cola&quot; garden.
garden cmd cola status build
</code></pre>
<h2 id="paths"><a class="header" href="#paths">Paths</a></h2>
<p>Paths can be specified as well, but the filesystem has the lowest priority
relative to gardens, groups, and trees.  When specifying paths they must
resolve to a configured tree.  For example:</p>
<pre><code class="language-bash">garden build . -- --verbose
</code></pre>
<p>This runs the <code>build</code> command on the tree in the current directory and passes the
<code>--verbose</code> flag to the configured <code>build</code> command.</p>
<h2 id="wildcards"><a class="header" href="#wildcards">Wildcards</a></h2>
<p>Garden understands shell wildcards.  Glob wildcards in tree queries allows
operations to span over ad-hoc gardens, groups and trees.</p>
<p>This following examples show how wildcards might be used:</p>
<pre><code class="language-bash"># Grow all all trees whose names start with &quot;git&quot; by cloning them.
garden grow '@git*'

# Run &quot;pwd&quot; in all of the same trees.
garden exec '@git*' pwd
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="commands"><a class="header" href="#commands">Commands</a></h1>
<p>Garden includes a set of built-in commands and can be flexibly extended
with user-defined commands. User-defined commands are one Garden's most
useful features.</p>
<h2 id="command-line-conventions"><a class="header" href="#command-line-conventions">Command-Line Conventions</a></h2>
<p>Run <code>garden help</code> to display usage information for garden commands.
The usage information is where the command-line options are documented.</p>
<pre><code class="language-bash">garden help
garden help &lt;command&gt;
garden &lt;command&gt; --help
</code></pre>
<p>Built-in commands use this basic syntax:</p>
<pre><code>garden [options] &lt;command&gt; [command-options] [command-arguments]*
</code></pre>
<p>The following options come before <code>&lt;command&gt;</code> and are common to all commands.</p>
<pre><code>-C | --chdir &lt;directory&gt;
</code></pre>
<p>Navigate to the specified directory before searching for configuration.
This is modeled after <code>make -C &lt;path&gt; ...</code> or <code>git -C &lt;path&gt; ...</code>.</p>
<pre><code>-c | --config &lt;filename&gt;
</code></pre>
<p>Specify a garden file to use instead of searching for <code>garden.yaml</code>.
The filename can be either the path to a file or the basename of a file in the
configuration search path.</p>
<pre><code>-v | --verbose
</code></pre>
<p>Enable verbose debugging output.</p>
<pre><code>-D | --define name=value
</code></pre>
<p>Override a configured variable by passing a <code>name=value</code> string to
the <code>-D | --define</code> option.  The variable named <code>name</code> will be updated with the
garden expression <code>value</code>.  Multiple variables can be set by specifying the
flag multiple times.</p>
<h2 id="garden-init"><a class="header" href="#garden-init">garden init</a></h2>
<pre><code class="language-bash">garden init [options] [&lt;filename&gt;]

# create a local garden config rooted at the current directory
garden init

# create a global garden config rooted at ~/src
garden init --global --root '~/src'
</code></pre>
<p>The init command will create an empty Garden YAML file with the minimal
boilerplate to start using garden. If no <code>&lt;filename&gt;</code> is specified,
<code>garden.yaml</code> in the current directory will be written.</p>
<p>The Garden file is written to the user's <code>~/.config/garden/</code> global configuration
directory when <code>--global</code> is specified.</p>
<p>This command is typically run without specifying a filename.
<code>garden init</code> typically creates a <code>garden.yaml</code> in the current directory:</p>
<pre><code>current-directory/
└── garden.yaml
</code></pre>
<p>If the current directory contains a Git repository then it will be added to
the <code>trees</code> block automatically. Use <code>garden init --empty</code> to disable this behavior.</p>
<h2 id="garden-plant"><a class="header" href="#garden-plant">garden plant</a></h2>
<pre><code class="language-bash">garden plant &lt;tree&gt;
</code></pre>
<p>Add a pre-existing Git worktree to <code>garden.yaml</code>.</p>
<p>The <code>trees</code> section in the <code>garden.yaml</code> file will be updated with details
about the new tree.</p>
<p><code>garden plant</code> records the Git remotes associated with a repository.
It is safe to re-run <code>garden plant</code> in order to add new remotes to
an existing configuration.</p>
<p>Repositories created using <code>git worktree</code> are supported by <code>garden plant</code>.
Parent trees must be planted first before planting a child tree.</p>
<p>Use the <code>--sort</code> option to sort all of the <code>trees</code> entries after planting.</p>
<h2 id="garden--tree-query"><a class="header" href="#garden--tree-query">garden ... [tree-query]</a></h2>
<p>Garden commands accept <a href="tree-queries.html">tree query</a> strings that are used to
refer to sets of trees.</p>
<p>Tree queries are glob string patterns that can be used to match the gardens,
groups or trees defined in &quot;garden.yaml&quot;.</p>
<h2 id="garden-grow"><a class="header" href="#garden-grow">garden grow</a></h2>
<pre><code class="language-bash">garden grow &lt;tree-query&gt;

# Example usage
garden grow cola
</code></pre>
<p>If you have a <code>garden.yaml</code> file, either one that you authored yourself or
one that was provided to you, then you will need to grow the Git trees
into existence.</p>
<p>The <code>grow</code> sub-command updates or creates the trees matched by the <code>&lt;tree-query&gt;</code>
and places them into the paths defined by the garden file.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern for filtering trees by
name post-query. This lets you filter a tree query so that only a subset of the
trees in the query are grown.</p>
<p>It is safe to re-run the <code>grow</code> command and re-grow a tree.  Existing trees will
have their git configuration updated to match the configured remotes.  Missing
repositories are created by cloning the configured tree URL.</p>
<h3 id="branches"><a class="header" href="#branches">Branches</a></h3>
<p>The <code>branch: &lt;branch-name&gt;</code> tree variable is used to specify which branch should be
cloned and checked out when the tree is grown.</p>
<pre><code class="language-yaml">trees:
  example:
    branch: dev
    url: url
</code></pre>
<p><code>garden grow example</code> clones the repository using <code>git clone --branch=dev</code>.
The <code>branch</code> setting is a tree variable and supports <code>${variable}</code> expressions.</p>
<h3 id="shallow-clones"><a class="header" href="#shallow-clones">Shallow Clones</a></h3>
<p>The <code>depth: &lt;integer&gt;</code> tree parameter is used to create shallow clones.</p>
<pre><code class="language-yaml">trees:
  example:
    depth: 42
    url: url
</code></pre>
<p><code>garden grow example</code> clones the repository using:</p>
<pre><code class="language-bash">git clone --depth=42 --no-single-branch
</code></pre>
<p>Even though a shallow clone is created, all of the remote tracking branches
(e.g. <code>origin/*</code>) are available because we clone the repository using
the <code>--no-single-branch</code> option.</p>
<p>The <code>single-branch: true</code> tree parameter is used to create clones that contain
a single branch only. This is useful if you want to limit the on-disk footprint
of repositories by only having a single branch available.</p>
<p>This par mater is typically used in conjunction with <code>branch: &lt;branch-name&gt;</code> and
<code>depth: 1</code> to create a 1-commit shallow clone with a single branch.</p>
<pre><code class="language-yaml">trees:
  example:
    branch: dev
    depth: 1
    single-branch: true
    url: url
</code></pre>
<h3 id="wildcards-1"><a class="header" href="#wildcards-1">Wildcards</a></h3>
<p>Wildcards are supported in the trees queries supported by <code>garden grow</code>.
<code>garden grow 'glob*'</code> grows the gardens, groups or trees that start with &quot;glob&quot;.</p>
<p>If <code>garden.yaml</code> contains <code>gardens</code> whose name matches the query then the trees
associated with each garden are grown.</p>
<p>If no gardens are found then garden will search for &quot;groups&quot; that match
the query. If groups are found then the trees within each group will be grown.</p>
<p>If no gardens and no groups are found then will garden search for trees and grow
those whose names match the query string.</p>
<h3 id="worktrees"><a class="header" href="#worktrees">Worktrees</a></h3>
<p><code>garden grow</code> can be used to create worktrees that share their <code>.git</code> storage
using <a href="https://git-scm.com/docs/git-worktree">git worktree</a>.</p>
<p>To create shared storage, define the primary worktree where the <code>.git</code>
storage will reside and then define additional trees that reference the
worktrees.</p>
<pre><code class="language-yaml">trees:
  example/main: url

  example/dev:
    worktree: example/main
    branch: dev

  example/v2:
    worktree: example/main
    branch: v2
</code></pre>
<p>This example uses <code>example/main</code> tree for the shared storage and two additional worktrees.
<code>example/dev</code> uses the <code>dev</code> branch and <code>example/v2</code> uses the <code>v2</code> branch.</p>
<h3 id="upstream-branches"><a class="header" href="#upstream-branches">Upstream Branches</a></h3>
<p>Remote tracking branches can be configured by defining a <code>branches</code> block that maps
local branch names (the <code>key</code>) to a remote branch name expression (the <code>value</code>).</p>
<pre><code class="language-yaml">trees:
  example/branches:
    branch: local
    branches:
      local: origin/dev
      dev: origin/dev
</code></pre>
<p>The above configuration creates local branches called <code>local</code> and <code>dev</code> and checks out
the <code>local</code> branch when <code>garden grow example/branches</code> is run.</p>
<h3 id="git-configuration-values"><a class="header" href="#git-configuration-values">Git Configuration Values</a></h3>
<p>The <code>garden grow</code> command will apply git configuration values that are
specified using the <code>gitconfig</code> key.</p>
<pre><code class="language-yaml">trees:
  foo:
    gitconfig:
      # Override the submodule URL for &quot;thirdparty/repo&quot;.
      submodule.thirdparty/repo.url: &quot;git@private.example.com:thirdparty/repo.git&quot;
</code></pre>
<p>Multi-valued <code>git config --add</code> values are also supported, for example
the <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-remoteltnamegtpushurl">remote.$name.pushurl</a>
value can be set to multiple values.</p>
<p>Use a list as the value for the key and multiple values will be added using
<a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt---add">git config --add $name $value</a>.</p>
<pre><code class="language-yaml">trees:
  foo:
    url: &quot;git@github.com:example/foo.git&quot;
    gitconfig:
      remote.origin.pushurl:
        # Push to multiple remotes when using &quot;git push origin&quot;
        - &quot;git@github.com:example/foo.git&quot;
        - &quot;git@private.example.com:example/foo.git&quot;
</code></pre>
<h3 id="bare-repositories"><a class="header" href="#bare-repositories">Bare Repositories</a></h3>
<p>To clone bare repositories use <code>bare: true</code> in the tree configuration.</p>
<pre><code class="language-yaml">trees:
  example:
    bare: true
    url: url
</code></pre>
<p>Bare clones are created by default when the tree path ends in <code>.git</code>.
For example, a tree called <code>example.git</code> will be <code>bare: true</code> by default.</p>
<pre><code class="language-yaml">trees:
  example.git: url
</code></pre>
<p>Setting <code>bare: false</code> overrides the name-based detection of bare repositories.</p>
<pre><code class="language-yaml">trees:
  example.git:
    bare: false
    url: url
</code></pre>
<h2 id="garden-cmd"><a class="header" href="#garden-cmd">garden cmd</a></h2>
<pre><code class="language-bash">garden cmd &lt;tree-query&gt; &lt;command&gt; [&lt;command&gt;]... [-- &lt;arguments&gt;..]

# Example usage
garden cmd cola build test -- V=1
</code></pre>
<p>Run one or more user-defined commands over the gardens, groups or trees
that match the specified tree query.</p>
<p>The example above runs the <code>build</code> and <code>test</code> commands in all of the trees
that are part of the <code>cola</code> garden.</p>
<h3 id="commands-1"><a class="header" href="#commands-1">Commands</a></h3>
<p><code>garden cmd</code> and <code>garden &lt;command&gt;</code> interact with custom commands that are
configured in the <code>commands</code> section for templates, trees, gardens,
and the top-level scope.</p>
<pre><code class="language-bash"># Example usage

# Run the test&quot; command in the cola and vx trees
garden test git-cola vx

# Use &quot;--&quot; to forward arguments to the custom commands
garden test git-cola -- --verbose
</code></pre>
<p>Custom commands can be defined at either the tree or garden scope.
Commands defined at the garden scope extend commands defined on a tree.
If both a tree and the garden containing that tree defines a command called
<code>test</code> then <code>garden test</code> will first run the tree's <code>test</code> command followed
by the garden's <code>test</code> command.</p>
<p>Commands are executed in a shell so that shell expressions can be used in commands.
A POSIX-compatible shell must be installed in your <code>$PATH</code>.</p>
<p>Additional command-line <code>&lt;arguments&gt;</code> specified after a double-dash (<code>--</code>)
end-of-options marker are forwarded to each command.</p>
<p><code>&quot;$0&quot;</code> in a custom command points to the current garden executable and can be
used to rerun garden from within a garden command.</p>
<p>Additional arguments are available to command strings by using the traditional
<code>&quot;$@&quot;</code> shell syntax.  When additional arguments are present <code>&quot;$1&quot;</code>, <code>&quot;$2&quot;</code>, and
subsequent variables will be set according to each argument.</p>
<pre><code class="language-yaml"># Commands can be defined in multiple ways.
# Strings and lists of strings are both supported via &quot;String to List Promotion&quot;.
# The YAML reader accepts multi-line strings using the &quot;|&quot; pipe syntax.

commands:
  one-liner: echo hello &quot;$@&quot;
  multi-liner: |
    if test &quot;${debian}&quot; = &quot;yes&quot;
    then
        apt install rust-all
    else
  multi-statement-and-multi-liner:
    - echo a $1
    - |
      echo b $3
      echo c $4
variables:
  name: value
  debian: $ type apt-get &gt;/dev/null &amp;&amp; echo yes || echo no
# Commands can also be defined at tree and garden scope
trees:
  our-tree:
    commands:
      tree-cmd: echo ${TREE_NAME}
gardens:
  all:
    trees: &quot;*&quot;
    commands:
      print-pwd: pwd
</code></pre>
<h4 id="shebang--commands"><a class="header" href="#shebang--commands">Shebang (#!) Commands</a></h4>
<p>Custom command shells can be used on a per-command basis by using a <code>#!&lt;command&gt;</code>
shebang line as the start of a multi-line command.</p>
<p>The command specified in the <code>#!</code> shebang line <em>must</em> accept a command string as the
next argument to the specified command.</p>
<pre><code class="language-yaml">commands:
  python-cmd: |
    #!python3 -c
    import sys
    print(sys.implementation)
</code></pre>
<p>Using <code>#!python3 -c</code> as the shebang line, as demonstrated above in the <code>python-cmd</code>
command, will result in the remainder of the command getting passed as the next argument.</p>
<p>Concretely, <code>garden</code> will run <code>python3 -c &quot;import sys\nprint(sys.implementation)&quot;</code> when
the <code>garden python-cmd</code> command is run.</p>
<h3 id="garden-shell"><a class="header" href="#garden-shell">Garden Shell</a></h3>
<p>The <code>garden.shell</code> configuration value controls which shell interpreter
is used to interpret custom commands.</p>
<pre><code class="language-yaml">garden:
  shell: zsh  # zsh is used by default when available. Uses bash, dash or sh otherwise.
  shell-wordsplit: true  # Words are split by default in zsh using &quot;zsh -o shwordsplit&quot;
  shell-errexit: true  # Non-zero exit status stops execution using &quot;zsh -e&quot;.
</code></pre>
<p><code>garden.shell</code> defaults to <code>zsh</code> when <code>zsh</code> is installed but can be set to any shell
that accepts <code>-e</code> and <code>-c '&lt;string&gt;</code> options (for example <code>ksh</code>).
If <code>zsh</code> is not installed then <code>bash</code> or <code>dash</code> will be used instead.
If neither <code>zsh</code>, <code>bash</code> nor <code>dash</code> is installed then <code>sh</code> will be used.</p>
<p>Each command runs under <code>[&quot;zsh&quot;, &quot;-e&quot;, &quot;-c&quot;, &quot;&lt;command&gt;&quot;]</code> with the resolved
environment from the corresponding garden, group, or tree.</p>
<p>Multi-line and multi-statement command strings will stop executing as soon as the
first non-zero exit code is encountered due to the use of the <code>-e</code> shell option.
Use the <code>-n | --no-errexit</code> option to inhibit the use of the <code>-e</code> &quot;errexit&quot; option.</p>
<p>The <code>--no-errexit</code> option causes commands with multiple statements to run to completion
even when a non-zero exit code is encountered. This is akin to a regular shell script.</p>
<p>Configure <code>garden.shell-errexit</code> to <code>false</code> in <code>garden.yaml</code> to opt-out of this behavior.
You can also opt-out of the <code>errexit</code> behavior on a per-command basis by using
<code>set +e</code> as the first line of a multi-line command.</p>
<p>When <code>zsh</code> is used it is executed with the <code>-o shwordsplit</code> option so that zsh behaves
similarly to traditional shells by splitting words in unquoted <code>$variable</code> expressions
rather than treating <code>$variable</code> like a single argument.</p>
<p>Configure <code>garden.shell-wordsplit</code> to <code>false</code> to opt-out of this behavior.
You can also opt-out of the <code>shwordsplit</code> behavior on a per-command basis by using
<code>set +o shwordsplit</code> as the first line of a multi-line command.</p>
<h4 id="builtin-shells"><a class="header" href="#builtin-shells">Builtin Shells</a></h4>
<p>The following values for <code>garden.shell</code> are understood directly by <code>garden</code> and
the following commands are used when <code>garden</code> detects that these shells are
configured.</p>
<div class="table-wrapper"><table><thead><tr><th>garden.shell</th><th>Command used for running commands</th><th>errexit=false</th><th>wordsplit=false</th></tr></thead><tbody>
<tr><td><code>bun</code></td><td><code>bun -e</code></td><td>N/A</td><td>N/A</td></tr>
<tr><td><code>bash</code></td><td><code>bash -e -c</code></td><td>Omit <code>-e</code></td><td>N/A</td></tr>
<tr><td><code>dash</code></td><td><code>dash -e -c</code></td><td>Omit <code>-e</code></td><td>N/A</td></tr>
<tr><td><code>ksh</code></td><td><code>ksh -e -c</code></td><td>Omit <code>-e</code></td><td>N/A</td></tr>
<tr><td><code>node</code></td><td><code>node -e</code></td><td>N/A</td><td>N/A</td></tr>
<tr><td><code>nodejs</code></td><td><code>nodejs -e</code></td><td>N/A</td><td>N/A</td></tr>
<tr><td><code>perl</code></td><td><code>perl -e</code></td><td>N/A</td><td>N/A</td></tr>
<tr><td><code>ruby</code></td><td><code>ruby -e</code></td><td>N/A</td><td>N/A</td></tr>
<tr><td><code>sh</code></td><td><code>sh -e -c</code></td><td>Omit <code>-e</code></td><td>N/A</td></tr>
<tr><td><code>zsh</code></td><td><code>zsh -e -o shwordsplit -c</code></td><td>Omit <code>-e</code></td><td>Omit <code>-o shwordsplit</code></td></tr>
</tbody></table>
</div>
<p>The following shells are not builtin, but they work as expected because they accept
<code>-c &lt;string&gt;</code> arguments for running command strings.</p>
<div class="table-wrapper"><table><thead><tr><th>garden.shell</th><th>Command used for running commands</th></tr></thead><tbody>
<tr><td><code>fish</code></td><td><code>fish -c</code></td></tr>
<tr><td><code>python3</code></td><td><code>python3 -c</code></td></tr>
</tbody></table>
</div>
<h4 id="custom-command-interpreters"><a class="header" href="#custom-command-interpreters">Custom Command Interpreters</a></h4>
<p>The command used in <code>garden.shell</code> must specify a command that takes a string to
execute using the <code>-c &lt;string&gt;</code> option. Some commands take <code>-e &lt;string&gt;</code> instead,
namely <code>nodejs</code>, <code>perl</code> and <code>ruby</code>, which are all understood by <code>garden</code> and
are expanded into their corresponding command-line.</p>
<p>This allows you to specify <code>python3</code> as the shell because <code>garden</code> assumes that
it can call <code>python3 -c &lt;string&gt;</code> to execute commands.</p>
<pre><code class="language-yaml">garden:
  shell: python3  # Uses &quot;python -c &lt;string&gt;&quot; to run commands.
commands:
  greet: print('hello')  # Interpreted by python3.

# Builtin shorthand shell values are special-cased internally.
garden:
   shell: zsh  # Uses &quot;zsh -o shwordsplit -e -c &lt;string&gt;&quot; to run commands.

garden:
   shell: bash  # Uses &quot;bash -e -c &lt;string&gt;&quot; to run commands.
</code></pre>
<p><code>garden.shell</code> also allows you to completely override the command used for interpreting
custom commands. When you specify a command line with multiple arguments then <code>garden</code>
will no longer internally manage the command-line options passed to the shell command.
The options that you specify will be used instead. You must specify <code>-c</code> or similar
arguments yourself when <code>garden</code> is configured with a custom command.
The <code>garden.shell-wordsplit</code> and <code>garden.shell-errexit</code> options have no effect
when using custom shell commands.</p>
<pre><code class="language-yaml"># Use &quot;zsh -c&quot; directly without &quot;-o shwordsplit&quot; and &quot;-e&quot;.
garden:
  shell: zsh -c

# Additional examples.
garden:
  shell: python3 -s -u -c
</code></pre>
<h3 id="shell-syntax"><a class="header" href="#shell-syntax">Shell Syntax</a></h3>
<p>User-defined Commands and Exec Expressions are evaluated by the shell configured
in the <code>garden.shell</code> configuration value.</p>
<p>Garden and Shells share a key piece of common syntax: the interpolated braced
<code>${variable}</code> syntax.</p>
<p>Garden Variables that use the <code>${variable}</code> syntax are evaluated by
<code>garden</code> first before the shell has evaluated them.</p>
<p>This means that the shell syntax supported by Garden's Exec Expressions is
a subset of the full syntax because shell-only variables such as <code>${OSTYPE}</code> cannot
be accessed using the braced-variable syntax.</p>
<pre><code class="language-yaml">commands:
  example-command: |
    shell_variable=$(date +%s)
    echo hello $OSTYPE $shell_variable
</code></pre>
<p>The plain <code>$variable</code> syntax is reserved for use by the shell commands used in
user-defined Commands and Exec Expressions.</p>
<p>Environment Variables can be used in shell scriptlets through both the <code>$ENV</code> and
<code>${ENV}</code> braced variable syntax. Garden makes all environment variables available during
variable expansion.</p>
<p>The distinction between the <code>${garden}</code> and <code>$shell</code> syntax is only relevant when
using variables defined within shell command, such as <code>$shell_variable</code> above.</p>
<p>If the <code>${shell_variable}</code> syntax were to be used in the <code>example-command</code> then an
empty value would have been used instead of the output of <code>date +%s</code>.</p>
<p>Sometimes it is necessary to actually use the <code>${...}</code> braced literal syntax
in shell commands. The <code>$${...}</code> braced double-dollar syntax can be used to
escape a braced value and disable evaluation by <code>garden</code>.</p>
<p>Double-<code>$</code> can generally be used to escape literal <code>$</code> values in commands, but
escaping is handled automatically for regular <code>$shell</code> variables.</p>
<h3 id="depth-first-and-breadth-first-tree-traversal"><a class="header" href="#depth-first-and-breadth-first-tree-traversal">Depth-first and Breadth-first Tree Traversal</a></h3>
<p>The following two invocations run commands in a different order:</p>
<pre><code class="language-bash"># Depth-first (default)
garden cmd treesitters build test

# Breadth-first
garden cmd --breadth-first treesitters build test
</code></pre>
<p>The default traversal order for commands is depth-first. This means that <em>both</em> the
<code>build</code> and <code>test</code> commands are run on each tree in the <code>treesitters</code> group
<em>before</em> running any commands on the next tree.</p>
<p>The <code>-b | --breadth-first</code> option enables a breadth-first traversal. A breadth-first
traversal runs the <code>build</code> command over <em>all</em> of the trees in the <code>treesitters</code> group
<em>before</em> the <code>test</code> command is run over all of the trees in the same group.</p>
<h3 id="custom-commands"><a class="header" href="#custom-commands">Custom Commands</a></h3>
<pre><code class="language-bash">garden &lt;command&gt; &lt;query&gt; [&lt;query&gt;]* [-- &lt;arguments&gt;...]

# Example usage
garden status @git-cola .
garden build cola/next
</code></pre>
<p><code>garden &lt;command&gt;</code> is another way to execute a user-defined <code>&lt;command&gt;</code>.
This form allows you to specify multiple queries rather than multiple commands.</p>
<p>When no builtin command exists by the specified name then garden will
use custom commands defined in a <code>commands</code> block at the corresponding
garden or tree scope.</p>
<p><code>garden &lt;command&gt; &lt;query&gt;...</code> is complementary to <code>garden cmd &lt;query&gt; &lt;command&gt;...</code>.</p>
<p><code>garden cmd ...</code> runs multiple commands over a single query.</p>
<p><code>garden &lt;command&gt; ...</code> runs a command over multiple queries.</p>
<p>For example, <code>garden build treesitters catsitters</code> will run a user-defined <code>build</code>
command over both the <code>treesitters</code>  and <code>catsitters</code> groups.</p>
<p>Use the <code>garden -vv</code> extra-verbose option to display the commands being run.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern to filter trees by name
post-query. Commands will only be run inside trees whose names match the pattern.
This lets you activate a garden and its environment variables while only running
a commands against a subset of trees in that garden.</p>
<h3 id="pre-and-post-commands"><a class="header" href="#pre-and-post-commands">Pre and Post Commands</a></h3>
<p>Commands can specify references to other commands that should be run before and/or after
a command.</p>
<ul>
<li>
<p>Pre-commands are run before the command.</p>
</li>
<li>
<p>Pre-commands use a <code>&lt;</code> suffix with values that specify the names of other commands to
run before the command.</p>
</li>
<li>
<p>Post-commands are run after the command.</p>
</li>
<li>
<p>Post-commands use a <code>&gt;</code> suffix with values that specify the names of other commands to
run after the command.</p>
</li>
<li>
<p>Pre-commands and post-commands can only refer to other custom commands.</p>
</li>
</ul>
<pre><code class="language-yaml">commands:
  custom-cmd: echo custom-cmd
  custom-cmd&lt;: pre
  custom-cmd&gt;:
    - post1
    - post2
  pre: echo before
  post1: echo after1
  post1: echo after2
</code></pre>
<p>Running <code>garden custom-cmd</code> with the above configuration runs the following commands:</p>
<pre><code># pre
echo before

# custom-cmd
echo custom-cmd

# post1
echo after1

# post2
echo after2
</code></pre>
<h2 id="garden-exec"><a class="header" href="#garden-exec">garden exec</a></h2>
<pre><code class="language-bash">garden exec &lt;tree-query&gt; &lt;command&gt; [&lt;arguments&gt;]*

# example
garden exec cola git status -s
</code></pre>
<p>Run commands over the trees, groups or gardens matched by tree query.
When the <code>&lt;tree-query&gt;</code> resolves to a garden then the environment
is configured for the command using the environment variables and
custom commands from both the tree and the garden.</p>
<p>Use the <code>garden -vv</code> extra-verbose option to display the command being run.</p>
<p>Use the <code>--dry-run</code> / <code>-n</code> option to perform a trial run without running any commands.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern to filter trees by name
post-query. Commands will only be run inside trees whose names match the pattern.
This lets you activate a garden and its environment variables while only running
the <code>&lt;command&gt;</code> against a subset of trees in that garden.</p>
<h2 id="garden-eval"><a class="header" href="#garden-eval">garden eval</a></h2>
<pre><code class="language-bash">garden eval &lt;expression&gt; [&lt;tree&gt;] [&lt;garden&gt;]

# example
garden eval '${GARDEN_ROOT}'
garden eval '${TREE_PATH}' cola
</code></pre>
<p>Evaluate a Garden Expression in the specified tree context and output
the result to stdout.</p>
<p>Garden Expressions are <code>strings-with-${variables}</code> that get substituted
and resolved using garden's <code>variables</code> and <code>environment</code> blocks.</p>
<p>If no tree is given then the variable scope includes the top-level variables
block only.</p>
<p>When a tree is given then its variables are considered as well.</p>
<p>When a garden is specified then the garden's variables are also available for
evaluation.</p>
<h2 id="garden-shell-1"><a class="header" href="#garden-shell-1">garden shell</a></h2>
<pre><code>garden shell &lt;tree-query&gt; [&lt;tree&gt;]

# example
garden shell cola
</code></pre>
<p>Launch a shell inside the environment synthesized by the tree query.
If <code>&lt;tree&gt;</code> is specified then the current directory will be set to the
tree's directory.</p>
<p>If the resolved tree query contains a tree whose name exactly matches the
query string then that tree's directory will be used when opening the shell.
The optional tree argument is not needed for the case where a garden
and tree share a name -- garden will chdir into that same-named tree when
creating the shell.</p>
<p>If you would like to customize the command to use for <code>garden shell</code> then
you can configure <code>garden.interactive-shell</code>. This value overrides <code>garden.shell</code>
and is only used by the <code>garden shell</code> command.</p>
<pre><code class="language-yaml"># Launch a fish login shell for &quot;garden shell&quot;.
garden:
  interactive-shell: fish
</code></pre>
<p>Arbitrary command interpreters can be specified.</p>
<pre><code class="language-yaml"># Launch a python interpreter for &quot;garden shell&quot;.
garden:
  interactive-shell: python3 -B
</code></pre>
<h2 id="garden-ls"><a class="header" href="#garden-ls">garden ls</a></h2>
<pre><code>garden ls [options] [&lt;tree-query&gt;...]
</code></pre>
<p>Display configured information about trees and commands.
Tree details are not displayed for missing / ungrown trees.</p>
<p>Use the <code>-a | --all</code> option to display details for missing trees.</p>
<p>If no tree-queries are specified then <code>garden ls</code> behaves as if
<code>garden ls '@*'</code> were specified, which displays all trees.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern that can be used to
filter trees by name post-query. This is useful when you want to list details
about a group or garden while only listing details about a subset of the trees.</p>
<h2 id="garden-prune"><a class="header" href="#garden-prune">garden prune</a></h2>
<pre><code>garden prune [options] [&lt;subdirs&gt;...]
</code></pre>
<p>Traverse the filesystem and interactively delete any repositories that are
not referenced by the garden file.</p>
<p>This command is intended to cleanup a garden-managed directory. Its intended
usage is to delete repositories that were created (e.g. via <code>garden grow</code>) and
have since been removed from your version-controlled garden configuration.</p>
<p><strong>Warning</strong>: <code>garden prune</code> is a dangerous command and must be run with care.
<code>garden prune</code> deletes repositories and all of their files (including the <code>.git</code> storage)!</p>
<p>The following options are supported by <code>garden prune</code>.</p>
<h2 id="enable-deletions"><a class="header" href="#enable-deletions">Enable deletions</a></h2>
<pre><code>--rm
</code></pre>
<p>The <code>garden prune</code> command uses a no-op &quot;safe mode&quot; which does not actually
delete repositories by default. Deletions must be enabled by specifying the
<code>--rm</code> option.</p>
<p>Use the <code>--rm</code> option only after you have verified that <code>garden prune</code> is not
going to delete any unexpected repositories that you intended to keep.</p>
<h2 id="limit-concurrency"><a class="header" href="#limit-concurrency">Limit concurrency</a></h2>
<pre><code>--jobs &lt;jobs&gt;
</code></pre>
<p>The prune process runs in parallel across multiple cores. All cores are used by default.
The <code>--jobs</code> option limits the number of cores to the specified number of jobs.</p>
<h2 id="limit-filesystem-traversal-depth"><a class="header" href="#limit-filesystem-traversal-depth">Limit filesystem traversal depth</a></h2>
<pre><code>--min-depth &lt;minimum-depth&gt;
--max-depth &lt;maximum-depth&gt;
--exact-depth &lt;exact-depth&gt;
</code></pre>
<p>The cleanup process can be limited to specific traversal depths. The filesystem is
traversed with no limits by default.</p>
<p>Specifying a minimum depth will not remove repositories shallower than the specified
depth. For example, <code>--min-depth 1</code> will not remove repositories in the same directory
as the garden file.</p>
<p>Specifying a maximum depth will not remove repositories deeper than the specified
depth. For example, <code>--max-depth 0</code> will not remove repositories in subdirectories
below the directory containing the garden file.</p>
<h2 id="enable-scripted-usage-by-answering-yes-to-all-prompts"><a class="header" href="#enable-scripted-usage-by-answering-yes-to-all-prompts">Enable scripted usage by answering &quot;yes&quot; to all prompts</a></h2>
<pre><code>--no-prompt
</code></pre>
<p>The <code>garden prune</code> command interactively prompts before removing each repository.
The prompt looks like the following:</p>
<pre><code class="language-bash"># /home/user/src/example
Delete the &quot;example&quot; repository?
WARNING: &quot;all&quot; deletes &quot;example&quot; and ALL subsequent repositories!
Choices: yes, no, all, quit [y,n,all,q]?
</code></pre>
<p>Entering <code>y</code> (or <code>yes</code>) at the prompt will delete the repository and all of its files.</p>
<p>Entering <code>n</code> (or <code>no</code>) at the prompt will skip and not remove the repository.</p>
<p>Entering <code>q</code> (or <code>quit</code>) will exit <code>garden prune</code> without deleting the repository.</p>
<p>Entering <code>all</code> will remove the repository and all subsequent repositories.
<code>all</code> is equivalent to answering <code>yes</code> to all further prompts.</p>
<p>Entering <code>all</code> is dangerous and proceeds without further prompts. Be careful!</p>
<p><code>--no-prompt</code> is also equivalent to answering <code>yes</code> to all prompts.
<code>--no-prompt</code> is intended for use in scripts where user interaction is not desired.
Use with caution!</p>
<h2 id="garden-completion"><a class="header" href="#garden-completion">garden completion</a></h2>
<p>Shell completions for <code>garden</code> can be generated by running the <code>garden completion</code>
command.</p>
<p><code>garden completion</code> uses <a href="https://crates.io/crates/clap_complete">clap complete</a>
to generate its completions.</p>
<p>The <code>--commands</code> options will additionally generate completions for custom commands.</p>
<h3 id="zsh"><a class="header" href="#zsh">Zsh</a></h3>
<p>Ensure that your <code>~/.zshrc</code> file has completions enabled and that you have a
directory configured in your <code>$fpath</code> for <code>zsh</code> completion scripts.
Add the following snippet to your <code>~/.zshrc</code> to enable completions and
configure <code>~/.config/zsh/completion</code> for providing completion scripts.</p>
<pre><code class="language-bash">fpath=(~/.config/zsh/completion $fpath)
autoload -U +X compinit
compinit -i
</code></pre>
<p>These settings make <code>zsh</code> look for a script called <code>_garden</code> in the directory when
tab-completing for <code>garden</code>.</p>
<p>Lastly, create the directory and generate the <code>~/.config/zsh/completion/_garden</code>
zsh shell completion script.</p>
<pre><code class="language-bash">mkdir -p ~/.config/zsh/completion
garden completion zsh &gt;~/.config/zsh/completion/_garden
</code></pre>
<p>Use <code>garden completion --commands zsh</code> instead of <code>garden completion zsh</code>
to include completions for custom commands.</p>
<p><em>NOTE</em>: You should regenerate the <code>_garden</code> zsh completion script whenever <code>garden</code>
is upgraded to ensure that all of the options and commands have up to date completions.</p>
<h3 id="bash"><a class="header" href="#bash">Bash</a></h3>
<p>Add the following snippet to your <code>~/.bashrc</code> to enable <code>bash</code> tab completions.</p>
<pre><code class="language-bash">if test -n &quot;$PS1&quot; &amp;&amp; type garden &gt;/dev/null 2&gt;&amp;1
then
    eval &quot;$(garden completion bash)&quot; 2&gt;/dev/null
fi
</code></pre>
<p>Use <code>garden completion --commands bash</code> instead of <code>garden completion bash</code>
to include completions for custom commands.</p>
<h3 id="future-shell-completion-enhancements"><a class="header" href="#future-shell-completion-enhancements">Future shell completion enhancements</a></h3>
<p>Tab completion can only be made to include a static set of user-defined commands.
Custom commands cannot be defined dynamically, which means that the same completions
will be used irrespective of your current directory.</p>
<p>Improvements to the shell completions can be made once traction has been made on the
following upstream issues:</p>
<ul>
<li>
<p><a href="https://github.com/clap-rs/clap/issues/3022">clap #3022</a> - zsh broken with two multi length arguments</p>
</li>
<li>
<p><a href="https://github.com/clap-rs/clap/pull/4612">clap #4612</a> - candidate fix for the above issue</p>
</li>
<li>
<p><a href="https://github.com/epage/clapng/issues/92">clapng #92</a> - Dynamic completion support</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>Garden is configured through a YAML configuration file, typically called
&quot;garden.yaml&quot;.</p>
<p>Garden will find <code>garden.yaml</code> in current directory or in specific locations
on the filesystem when unspecified.  Garden searches for <code>garden.yaml</code> in the
following locations. The first one found is used.</p>
<pre><code class="language-sh"># Relative to the current directory
./garden.yaml
./garden/garden.yaml
./etc/garden/garden.yaml

# Relative to $HOME
~/.config/garden/garden.yaml
~/etc/garden/garden.yaml

# Global configuration
/etc/garden/garden.yaml
</code></pre>
<p>If <code>garden.yaml</code> is not found in these directories then <code>garden</code> will walk up the
file system searching for config files.</p>
<p>You can prevent <code>garden</code> from traversing into directories higher in the file system
tree by setting either the <code>GARDEN_CEILING_DIRS</code> or <code>GIT_CEILING_DIRS</code> environment
variables. Multiple directories can be specified by using a colon(<code>:</code>)-delimited
list of ceiling directories.</p>
<p><code>garden</code> uses the <a href="https://git-scm.com/book/en/v2/Git-Internals-Environment-Variables">GIT_CEILING_DIRS</a>
environment variable from core Git as a fallback when <code>GARDEN_CEILING_DIRS</code> it is not set.</p>
<p><code>GARDEN_CEILING_DIRS</code> has higher precedence and overrides values configured in
<code>GIT_CEILING_DIRS</code>.</p>
<p>Use <code>garden -c|--config &lt;filename&gt;</code> to specify a garden file and override
<code>garden</code>'s file discovery.</p>
<p>If a basename is specified, e.g. <code>garden --config custom.yaml</code>, then <code>garden</code> will search
these same locations for <code>custom.yaml</code> instead of <code>garden.yaml</code>.</p>
<p>The following example <code>garden.yaml</code> is referred to by the documentation
when showing examples.</p>
<pre><code class="language-yaml"># Create environments for developing Git Cola against development versions of Git.
#
# The following gardens are defined: &quot;cola&quot;, &quot;cola/main&quot; and &quot;cola/next&quot;.
#
# The &quot;cola&quot; garden runs git-cola using the &quot;git&quot; command from your $PATH.
# The &quot;cola/main&quot; garden runs git-cola using git.git's &quot;main&quot; branch.
# The &quot;cola/next&quot; garden runs git-cola using git.git's &quot;next&quot; branch.
#
# One-time Setup:
#
# * Clone repositories and create worktrees:
#
#   garden grow cola/main cola/next
#
# * Initialize git-cola's Python virtualenv environment.
#
#   garden setup cola
#
# Development workflows:
#
# * Build the &quot;cola/main&quot; garden using git.git's &quot;main&quot; branch:
#   garden build cola/main
#
# * Build the &quot;cola/next&quot; garden using git.git's &quot;next&quot; branch:
#   garden build cola/next
#
# * Run Git Cola
#   garden run
#
# * Run Git Cola on the git/next and git-cola trees using the cola/next garden environment:
#   garden run --trees git/next cola/next
#   garden run -t git-cola cola/next
#
# * Open a shell for running Git Cola in different enviornments
#   garden shell cola/main
#   garden shell cola/next
#
# * Run just Git Cola's tests in each environment.
#   garden test/cola cola
#   garden test/cola cola/main
#   garden test/cola cola/next
#
# * Run tests for all projects in each environment. Also runs Git's testsuite.
#   garden test cola
#   garden test cola/main
#   garden test cola/next

# The following variables are used in the custom commands below.
variables:
    # A virtualenv is created in the ./dist/git-cola/env3 directory.
    prefix: ${GARDEN_ROOT}/git-cola/env3
    jobs: $ nproc 2&gt;/dev/null || sysctl -n hw.ncpu 2&gt;/dev/null || echo 8

commands:
    add-all: git add --update
    diff: GIT_PAGER= git diff --patience --color-words &quot;$@&quot;
    lol: git log --decorate --graph --oneline &quot;$@&quot; &amp;&amp; echo
    run: vx ${prefix} git cola &quot;$@&quot;
    status:
        - git status --short
        - git branch

templates:
    bin:
        environment:
            PATH: ${TREE_PATH}/bin
    python:
        environment:
            PYTHONPATH: ${TREE_PATH}
    makefile:
        commands:
            build: make -j ${jobs} prefix=&quot;${prefix}&quot; all &quot;$@&quot;
            install: make -j ${jobs} prefix=&quot;${prefix}&quot; install &quot;$@&quot;
            test: make -j ${jobs} prefix=&quot;${prefix}&quot; test &quot;$@&quot;
            doc: make -j ${jobs} prefix=&quot;${prefix}&quot; doc &quot;$@&quot;

trees:
    # git/main is the parent worktree that shares its .git storage with the child
    # git/next worktrees using &quot;git worktree&quot; -- https://git-scm.com/docs/git-worktree
    git/main:
        url: https://github.com/git/git.git
        templates: makefile
        environment:
            PATH: ${TREE_PATH}/bin-wrappers
            # git/next is a &quot;git worktree&quot; for git.git's &quot;next&quot; branch.
    git/next:
        worktree: git/main
        branch: next

        # git-cola's worktree can be reused alongside any of the git/* trees defined above.
    git-cola:
        url: https://gitlab.com/git-cola/git-cola.git
        templates: [bin, python]
        commands:
            setup: garden dev
            test/cola: garden test &quot;$@&quot;
            install: garden -D prefix=&quot;${prefix}&quot; install &quot;$@&quot;
            test: garden test &quot;$@&quot;
            doc: garden doc &quot;$@&quot;

    qtpy:
        description: Qt abstraction library used by git-cola
        url: https://github.com/spyder-ide/qtpy.git
        templates: python
        setup: vx ${prefix} pip install pytest-qt

    vx:
        description: Utility for activating Python virtualenvs
        url: https://gitlab.com/davvid/vx.git
        depth: 1  # Create a shallow clone using &quot;git clone --depth=1&quot;
        environment:
            PATH: ${TREE_PATH}
        commands:
            test: make test

    # This tree allows the &quot;run&quot; command to be run from any directory.
    cwd:
        path: ${PWD}

groups:
    cola-repos-grp:
        - git-cola
        - qtpy
        - vx

gardens:
    cola:
        groups: cola-repos-grp
        environment:
            PATH: ${prefix}/bin
    cola/main:
        groups: cola-repos-grp
        trees: git/main
        environment:
            PATH: ${prefix}/bin
    cola/next:
        groups: cola-repos-grp
        trees: git/next
        environment:
            PATH: ${prefix}/bin
</code></pre>
<h2 id="garden-root"><a class="header" href="#garden-root">Garden Root</a></h2>
<p>The garden root directory is configured in the <code>garden.root</code> field.
This directory is the parent directory in which all trees will be cloned.</p>
<p><code>garden.root</code> defaults to <code>${GARDEN_CONFIG_DIR}</code> when unspecified.
<code>{GARDEN_CONFIG_DIR}</code> is the directory that contains the current <code>garden.yaml</code> .</p>
<p>The default <code>${GARDEN_CONFIG_DIR}</code> value lets you create relocatable setups
with trees that are located relative to the <code>garden.yaml</code> config file.</p>
<p>Slashes in tree paths will create new directories on disk as needed.</p>
<pre><code class="language-yaml"># By default, &quot;garden init&quot; generates a &quot;garden.yaml&quot; that uses the
# ${GARDEN_CONFIG_DIR} for its &quot;garden.root&quot; location.
garden:
  root: ${GARDEN_CONFIG_DIR}
</code></pre>
<p>Omitting <code>garden.root</code> is equivalent to the configuration above.</p>
<p>To place all trees in a <code>src</code> directory sibling to the <code>garden.yaml</code> file, the
following configuration can be used:</p>
<pre><code class="language-yaml">garden:
  root: ${GARDEN_CONFIG_DIR}/src
</code></pre>
<p>To place all trees in a <code>src</code> directory in your <code>$HOME</code> directory, the
following configuration can be used:</p>
<pre><code class="language-yaml">garden:
  root: ~/src
</code></pre>
<p>Configure <code>garden.root</code> to <code>&quot;&quot;</code> (an empty string) to use a dynamic
<code>garden.root</code> that follows your current directory. This lets you use
<code>garden --config &lt;path&gt;</code> to create and interact with trees in your
current directory instead of a fixed configuration-defined location.</p>
<pre><code class="language-yaml">garden:
  root: &quot;&quot;
</code></pre>
<h2 id="garden-shell-2"><a class="header" href="#garden-shell-2">Garden Shell</a></h2>
<p>The shell used by <code>garden</code> when running Commands is configured by the <code>garden.shell</code> field.</p>
<pre><code class="language-yaml">garden:
  shell: zsh
</code></pre>
<p>The <code>$PATH</code> environment variable is probed for available shells in the following order
when <code>garden.shell</code> is omitted. The first one found is the one that's used.</p>
<ul>
<li><code>zsh</code></li>
<li><code>bash</code></li>
<li><code>dash</code></li>
<li><code>sh</code></li>
</ul>
<p>The following shell interpreters can also be configured in <code>garden.shell</code>
for running custom commands.</p>
<ul>
<li><code>bun</code></li>
<li><code>fish</code></li>
<li><code>node</code></li>
<li><code>perl</code></li>
<li><code>python3</code></li>
</ul>
<p>Any command that can run command strings using <code>-c</code> can be used as a
<code>garden.shell</code> interpreter.</p>
<p>Exec expressions are always run using the default <code>/bin/sh</code> system shell
irrespective of <code>garden.shell</code>.</p>
<h2 id="tree-display"><a class="header" href="#tree-display">Tree Display</a></h2>
<p>Garden will display the tree's current branch when running commands.
While this has a marginal performance impact, this feature can be disabled by either
passing the <code>garden -D garden.tree-branches=0</code> option or by configuring the
<code>garden.tree-branches</code> option to <code>false</code> in the <code>garden.yaml</code> configuration.</p>
<pre><code class="language-yaml">garden:
  tree-branches: false
</code></pre>
<h2 id="includes"><a class="header" href="#includes">Includes</a></h2>
<p>Garden files can be split apart into several files for modularity and reuse.
You can use the <code>garden.includes</code> list to specify other garden files to include
into the current garden file.</p>
<pre><code class="language-yaml">garden:
  includes:
    # Includes are relative to the GARDEN_CONFIG_DIR by default.
    - variables.yaml
    # Includes can reference custom and built-in ${variables}.
    - ${include_dir}/commands.yaml

variables:
  include_dir: ${GARDEN_ROOT}
</code></pre>
<p>Absolute paths in the <code>garden.includes</code> list are included as-is.
Relative paths in the <code>garden.includes</code> list are resolved.</p>
<p>Relative paths are first resolved relative to the file in which they are defined.
This allows nested include files to use relative paths for their nested includes.</p>
<p>If an include file is not found relative to the current garden file then a path relative
to the root configuration directory will be checked for the existence of the file.</p>
<p>Includes files are treated like &quot;optional&quot; includes -- include files that cannot be
found are silently ignored.</p>
<p>Enable the <code>garden -d config ...</code> debug flag to display warnings about missing include
files.</p>
<h3 id="the-last-one-wins-rule"><a class="header" href="#the-last-one-wins-rule">The &quot;Last One Wins&quot; Rule</a></h3>
<p>Entities in garden files such as <code>trees</code>, <code>gardens</code>, <code>groups</code>, <code>commands</code> and
<code>variables</code> can be sparsely defined across multiple files by using <code>includes</code>.</p>
<p>When the same entry is found in multiple included files then the only last definition
will be used. This is referred to as the &quot;Last One Wins&quot; rule.</p>
<p>Entities defined in the root <code>garden.yaml</code> have the highest precedence and override
entries provided via <code>garden.includes</code>.</p>
<p><code>variables</code>, <code>commands</code>, <code>groups</code> and <code>gardens</code> are completely replaced when multiple
definitions are found.</p>
<p><code>trees</code> are sparsely overridden. If an override definition in the top-level
<code>garden.yaml</code> replaces just the <code>url</code> field, for example, then all of the <code>commands</code>,
<code>variables</code> and <code>environment</code> values from the earlier definition are retained
and only the <code>url</code> for the <code>origin</code> remote is replaced.</p>
<p>If a tree needs to completely override a base definition then a tree can use
<code>replace: true</code> to indicate that the tree definition is replacement for the
earlier tree definition.</p>
<pre><code class="language-yaml"># garden.yaml
---
garden:
  includes: trees.yaml

trees:
  example:
    replace: true
    url: https://custom.example.com/custom/tree
...
</code></pre>
<p>The <code>garden.yaml</code> above includes <code>trees.yaml</code>. The <code>example</code> tree is originally
defined here, but it is completely replaced by the same entry above.</p>
<pre><code class="language-yaml"># trees.yaml
---
trees:
  example: https://example.com/original/tree
  commands:
    echo: Hello, ${TREE_NAME}
...
</code></pre>
<p>In the example above, the <code>example</code> tree completely replaces the
same tree from the included <code>trees.yaml</code>. None of the commands, variables or other
settings from the replaced tree are retained.</p>
<h2 id="variables"><a class="header" href="#variables">Variables</a></h2>
<p>Garden configuration contains a &quot;variables&quot; block that allows defining
variables that are can be referenced by other garden values.</p>
<pre><code class="language-yaml">variables:
  flavor: debug
  user: $ whoami
  libdir: $ test -e /usr/lib64 &amp;&amp; echo lib64 || echo lib
  nproc: $ nproc
  prefix: ~/.local
  py_ver_code: from sys import version_info as v; print(&quot;%s.%s&quot; % v[:2])
  py_ver: $ python3 -c '${py_ver_code}'
  py_site: ${libdir}/python${py_ver}/site-packages
</code></pre>
<p>Variables definitions can reference environment variables and other garden
variables.</p>
<p>Variable references use shell <code>${variable}</code> syntax.</p>
<p>Values that start with dollar-sign+space (<code>$ </code>) are called &quot;exec expressions&quot;.
Exec expressions are run through a shell after evaluation and replaced with
the output of the evaluated command.</p>
<p>When resolving values, variables defined in a tree scope override/replace
variables defined at the global scope.  Variables defined in garden scope
override/replace variables defined in a tree scope.</p>
<h2 id="built-in-variables"><a class="header" href="#built-in-variables">Built-in variables</a></h2>
<p>Garden automatically defines some built-in variables that can be useful
when constructing values for variables, commands, and paths.</p>
<ul>
<li><strong>GARDEN_CONFIG_DIR</strong> -- Directory containing the <code>garden.yaml</code> file.</li>
<li><strong>GARDEN_ROOT</strong> -- Root directory for trees.</li>
<li><strong>TREE_NAME</strong> -- Current tree name.</li>
<li><strong>TREE_PATH</strong> -- Current tree path.</li>
</ul>
<h3 id="variables-for-custom-commands"><a class="header" href="#variables-for-custom-commands">Variables for Custom Commands</a></h3>
<p>The following built-in variables are provided to make it easier to write custom commands
that re-execute <code>garden</code>. These variables allow you to forward the user-specified
<code>-vv</code> or <code>--quiet</code> options to child commands.</p>
<ul>
<li><strong>GARDEN_CMD_QUIET</strong> -- <code>--quiet</code> when <code>--quiet</code> is specified, empty otherwise.</li>
<li><strong>GARDEN_CMD_VERBOSE</strong> -- <code>-v</code>, <code>-vv</code> etc. when verbosity is increased, empty otherwise.</li>
</ul>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h2>
<p>The &quot;environment&quot; block defines variables that are stored in the environment.</p>
<p>Environment variables are resolved in the same order as garden variables:
global scope, tree scope, and garden scope.  This allows gardens to
prepend/append variables after a tree, thus allowing for customization
of behavior from the garden scope.</p>
<p>Values in environment blocks prepend to the environment variable by default.
The <code>:</code> UNIX path separator is used when prepending and appending values.</p>
<pre><code class="language-yaml">trees:
  foo:
    environment:
      PATH: ${TREE_PATH}/bin
</code></pre>
<p>The example above prepends the <code>foo/bin</code> directory to the colon (<code>:</code>)-delimited <code>PATH</code>
environment variable.</p>
<p>Names with an equals sign (<code>=</code>) suffix are treated as &quot;store&quot; operations and are
stored into the environment, fully replacing any pre-existing values.</p>
<pre><code class="language-yaml">trees:
  foo:
    environment:
      ${TREE_NAME}_LOCATION=: ${TREE_PATH}
</code></pre>
<p>Environment variable entries can use garden <code>${variable}</code> syntax when defining
both their name and values. The example above exports a variable called <code>foo_LOCATION</code>
with the location of the tree. If <code>foo_LOCATION</code> is already defined then its value is
replaced.</p>
<p>A plus sign (<code>+</code>) suffix in the name append to a variable instead of prepending.</p>
<pre><code class="language-yaml">trees:
  foo:
    environment:
      PATH+: ${TREE_PATH}/bin
</code></pre>
<p>The example above appends to the <code>PATH</code> environment variable.
Note the <code>+</code> suffix after <code>PATH</code>.</p>
<h3 id="os-environment-variables"><a class="header" href="#os-environment-variables">OS Environment Variables</a></h3>
<p>OS-level environment variables that are present in garden's runtime
environment can be referenced using garden <code>${variable}</code> expression syntax.
Garden variables have higher precedence than environment variables when
resolving <code>${variable}</code> references -- the environment is checked only when
no garden variables exist by that name.</p>
<h3 id="variable-expression-evaluation-order"><a class="header" href="#variable-expression-evaluation-order">Variable Expression Evaluation Order</a></h3>
<p>Garden <code>${variables}</code> expressions can reference other variables and they can also
reference variables from <code>environment</code> entries.</p>
<p>Referencing variables defined in an <code>environment</code> section from a <code>variables</code>
entry is generally discouraged for simplicity, but it is supported and valid.
It is recommended that a <code>variables</code> entry should only reference other
<code>variables</code> and avoid referencing entries from <code>environment</code> blocks.</p>
<p>Following this rule of thumb results in configurations where entries from
<code>environment</code> sections depend on entries from <code>variables</code> and not the other way around.
This minimizes the chance of introducing cyclical dependencies across variables.</p>
<p><code>environment</code> entries are only used during variable resolution when the expression
evaluation engine is unable to find the variable in any of the higher-precedence scopes.</p>
<p>The precedence order when expanding variables, from strongest to weakest, is as follows:</p>
<ul>
<li>
<p>The <code>variables</code> block in a garden's scope.</p>
</li>
<li>
<p>The <code>variables</code> block in a tree's scope.</p>
</li>
<li>
<p>The <code>variables</code> block in the global configuration scope.</p>
</li>
<li>
<p>The <code>environments</code> block in a garden's scope.</p>
</li>
<li>
<p>The <code>environments</code> block in a tree's scope.</p>
</li>
<li>
<p>The <code>environments</code> block in the global configuration scope.</p>
</li>
<li>
<p>OS environment variables.</p>
</li>
</ul>
<p>The first entry found is used when expanding <code>${variable}</code> expressions.</p>
<h2 id="gardens-groups-and-trees"><a class="header" href="#gardens-groups-and-trees">Gardens, Groups and Trees</a></h2>
<p>Trees are Git repositories with configuration that allows for the
specification of arbitrary commands and workflows.  Groups are a simple
named grouping mechanism.</p>
<p>Gardens aggregate groups and trees.  Define a group and reuse the group in
different gardens to share tree lists between gardens.  Defining gardens
and groups make those names available when querying and performing operations
over trees.</p>
<p>Gardens can also include environment, gitconfig, and custom group-level
commands in addition to the commands provided by each tree.</p>
<h2 id="trees"><a class="header" href="#trees">Trees</a></h2>
<p>The <code>trees</code> block in a <code>garden.yaml</code> Garden file defines the trees that
are available for running commands against.</p>
<p>Trees represent Git worktrees and can be aggregated into groups and gardens.
The <code>tree</code> block defines properties about a tree such as its Git URL,
custom variables, environment variables, Git remotes, Git configuration variables,
and custom commands.</p>
<pre><code class="language-yaml">trees:
  git-scm:
    description: Fast, scalable, distributed version control
    path: git
    url: git://git.kernel.org/pub/scm/git/git.git
    remotes:
      gitlab: https://gitlab.com/gitlab-org/git.git
      github: https://github.com/git/git.git
      gitster: https://github.com/gitster/git.git
    commands:
      build: make all -j ${num_procs} &quot;$@&quot;
      test: make test &quot;$@&quot;
    variables:
      num_procs: $ nproc 2&gt;/dev/null || sysctl -n hw.activecpu 2&gt;/dev/null || echo 4
</code></pre>
<p>All fields are more or less optional. The <code>path</code> field defaults to the same
name as the tree, so the <code>path: git</code> setting above can be omitted without
any differences in behavior.</p>
<p>The <code>path</code> field can be used to name trees independently of directory on disk.
The <code>path</code> value defaults to the same name as the tree, for example <code>git-scm</code>
would be used as the directory without the <code>path: git</code> setting above.</p>
<p>The <code>path: git</code> setting causes <code>garden grow git</code> to clone into a directory called
<code>git</code> instead of <code>git-scm</code>.</p>
<p>Relative paths are assumed to be relative to the <code>${GARDEN_ROOT}</code>, typically the
same directory as the <code>garden.yaml</code>.</p>
<p>If the only field you want to configure is the <code>url</code> field then you can also
use a <code>string</code> rather than a <code>dictionary</code> / <code>table</code> to represent a tree
by providing just the URL. This configures a tree with a single <code>origin</code>
remote pointing to the configured URL.</p>
<pre><code class="language-yaml">trees:
  git-scm: git://git.kernel.org/pub/scm/git/git.git
</code></pre>
<h3 id="default-tree"><a class="header" href="#default-tree">Default Tree</a></h3>
<p>The <code>trees</code> block is optional when a <code>commands</code> block exists.</p>
<p>An implicit default tree called <code>.</code> will be synthesized into existence when the <code>trees</code>
block is empty.</p>
<p>The default tree's <code>path</code> is set to the <code>${GARDEN_CONFIG_DIR}</code>.
Omitting the <code>trees</code> block lets you use <code>garden</code> as a simple command runner.</p>
<h3 id="remotes"><a class="header" href="#remotes">Remotes</a></h3>
<p>The <code>remotes</code> field defines named
<a href="https://git-scm.com/book/en/v2/Git-Basics-Working-with-Remotes">Git remotes</a>
that will be configured when growing the repository.</p>
<p>If you edit your <code>garden.yaml</code> then you can always re-run <code>garden grow</code> to add remotes
that were added to <code>garden.yaml</code>.</p>
<p>Likewise, you can always rerun <code>garden plant</code> to record new remotes that
you may have added using the <code>git remote add</code>
<a href="https://git-scm.com/docs/git-remote">command-line interface</a>.</p>
<h3 id="default-remote-name"><a class="header" href="#default-remote-name">Default Remote Name</a></h3>
<p>The default <code>origin</code> remote name used by Git can be overridden by setting the
<code>default-remote</code> field in the tree's configuration.</p>
<pre><code class="language-yaml">trees:
  git:
    url: git://git.kernel.org/pub/scm/git/git.git
    default-remote: kernel.org
</code></pre>
<p>This will create a remote called <code>kernel.org</code> instead or <code>origin</code> when growing trees.
This feature can also be used when multiple named remotes are configured.</p>
<pre><code class="language-yaml">trees:
  git:
    default-remote: kernel.org
    remotes:
      kernel.org: git://git.kernel.org/pub/scm/git/git.git
      gitster: https://github.com/gitster/git.git
</code></pre>
<h2 id="templates"><a class="header" href="#templates">Templates</a></h2>
<p>Templates allow sharing of command, variable, gitconfig, and environment
definitions across trees. Adding an entry to the <code>templates</code> configuration block
makes a template available when defining trees.</p>
<p>Specify <code>templates: &lt;template-name&gt;</code> to inherit the specified template's
settings when defining trees. The <code>templates</code> field also accepts a list of
template names.</p>
<p>Trees can also reuse another tree definition by specifying the &quot;extend&quot;
keyword with the name of another tree.  Only the first remote is used when
extending a tree.</p>
<pre><code class="language-yaml">templates:
  hello:
    variables:
      message: Hello ${TREE_NAME}.
    commands:
      echo: echo ${message}

trees:
  hello-tree:
    templates: hello

  hello-tree-extended:
    extend: hello-tree
    variables:
      message: The time is now: $(date)
</code></pre>
<p>When a tree specifies multiple templates then all of the templates are merged into
the tree's definitions. If variables are multiply-defined across multiple templates
then the variable's value from the last specified template will be used.</p>
<h2 id="string-to-list-promotion"><a class="header" href="#string-to-list-promotion">String to List Promotion</a></h2>
<p>Fields that expect Lists can also be specified using a String value.
Strings will be promoted to a List containing a single String.
This is useful when defining <code>commands</code> and <code>groups</code>.</p>
<p>The <code>commands</code> block defines commands that are specified using Lists of Strings.
<em>String to List Promotion</em> makes it easier to define commands by specifying a single
String that can either be a simple value or a multi-line YAML String.</p>
<p>The following commands show the various ways that <code>commands</code> can be specified
due to the automatic promotion of Strings into Lists.</p>
<pre><code class="language-yaml">commands:
  # commands are a list of command strings.
  cmd1:
    - echo ${TREE_NAME}
    - pwd

  # strings are promoted to a list with a single item.
  cmd2: echo ${TREE_NAME} &amp;&amp; pwd

  # cmd2 is promoted into
  cmd2:
    - echo ${TREE_NAME} &amp;&amp; pwd

  # multi-line command strings are supported using &quot;|&quot; YAML syntax.
  cmd4: |
    echo ${TREE_NAME}
    pwd

  # cmd4 is promoted into
  cmd4:
    - &quot;echo ${TREE_NAME}\npwd&quot;
</code></pre>
<h2 id="wildcards-2"><a class="header" href="#wildcards-2">Wildcards</a></h2>
<p>The names in garden <code>tree</code> and <code>group</code> lists, and group member names accept glob
wildcard patterns.</p>
<p>The &quot;annex&quot; group definition is: <code>annex/*</code>.   This matches all trees that
start with &quot;annex/&quot;.  The &quot;git-all&quot; group has two entries -- <code>git*</code> and
<code>cola</code>.  The first matches all trees that start with &quot;git&quot;, and the second one
matches &quot;cola&quot; only.</p>
<h2 id="symlinks"><a class="header" href="#symlinks">Symlinks</a></h2>
<p>Symlink trees create a symlink on the filesystem during <code>garden init</code>.
<code>garden exec</code>, and custom <code>garden cmd</code> commands ignore symlink trees.</p>
<pre><code class="language-yaml">trees:
  media:
    path: ~/media
    symlink: /media/${USER}
</code></pre>
<p>The &quot;path&quot; entry behaves like the tree &quot;path&quot; entry -- when unspecified it
defaults to a path named after the tree relative to the garden root.</p>
<h2 id="grafts"><a class="header" href="#grafts">Grafts</a></h2>
<p>A more advanced modularity feature allow you to stitch additional <code>garden.yaml</code>
files underneath a custom &quot;graft namespace&quot;.</p>
<p>The example below demonstrates how to define trees and variables in separate
&quot;graft&quot; files and refer to them using a <code>graft::</code> namespace qualifier.</p>
<pre><code class="language-yaml"># Top-level garden.yaml
grafts:
  graft: graft.yaml
  graft-repos:
    config: repos.yaml
    root: repos

trees:
  local-tree:
    url: https://git.example.com/repo.git
    variables:
      value: &quot;local ${graft::value}&quot;

variables:
    value: &quot;global ${graft::value}&quot;

gardens:
  example:
    trees:
      - local-tree
      - graft::tree
      - graft-repos::example
</code></pre>
<p>The <code>graft-repos</code> graft entry demonstrates how to use a custom root directory for
the trees provided by the grafted configuration.</p>
<p>The <code>grafts.yaml</code> file provides a tree called <code>tree</code> and a variable called <code>value</code>.
We refer to them as <code>graft::tree</code> when specifying trees and <code>${graft::value}</code> when
using variables.</p>
<p><code>graft.yaml</code> contains the following:</p>
<pre><code class="language-yaml"># The grafted &quot;graft.yaml&quot; file.
trees:
  tree: https://git.example.com/tree.git

variables:
  value: &quot;grafted value&quot;
</code></pre>
<p>Running <code>garden eval '${graft::value}'</code> will output <code>grafted value</code>.</p>
<p>Running <code>garden eval '${value}'</code> will output <code>global grafted value</code>, as it evaluates at
global scope.</p>
<p>Running <code>garden eval '${value}' local-tree</code> will output <code>local grafted value</code>, as it
evaluates from <code>local-tree</code>'s scope.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<p>These examples demonstrate how to use <code>garden</code> using runnable examples.</p>
<h2 id="photo-restoration"><a class="header" href="#photo-restoration">Photo Restoration</a></h2>
<p>The &quot;Photo Restoration&quot; example sets up the
<a href="https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life">Bringing Old Photos Back to Life</a>
software for restoring old photos that suffer from severe degradation using
machine-learning techniques.</p>
<h2 id="git-cola"><a class="header" href="#git-cola">Git Cola</a></h2>
<p>The &quot;Git Cola&quot; example sets up a development environment for
<a href="https://git-cola.github.io/">Git Cola</a>, a PyQt-based graphical user interface for Git.</p>
<p><a href="https://github.com/git-cola/git-cola/blob/main/garden.yaml">Git Cola's garden.yaml</a>
uses garden as a command runner, to keep track of development forks, and to gather
associated trees without the overhead of using submodules.</p>
<h2 id="command-interpreters"><a class="header" href="#command-interpreters">Command Interpreters</a></h2>
<p>The &quot;Command Interpreters&quot; example demonstrates how to use a custom interpreter
on a per-command basis.</p>
<h2 id="python"><a class="header" href="#python">Python</a></h2>
<p>The &quot;Python&quot; example demonstrates how to use <code>python3</code> to interpret all custom commands.</p>
<h2 id="node"><a class="header" href="#node">Node</a></h2>
<p>The &quot;Node&quot; example demonstrates how to use <code>node</code> to interpret all custom commands.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="photo-restoration-1"><a class="header" href="#photo-restoration-1">Photo Restoration</a></h1>
<p>This example demonstrates how to run the
<a href="https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life">Bringing Old Photo Back to Life</a>
photo restoration project.</p>
<h2 id="setup-1"><a class="header" href="#setup-1">Setup</a></h2>
<p>Run the following commands to clone the repository, download pre-trained deep-learning
model data files used by the software and configure a Python virtualenv used to
run the tools.</p>
<p><em>NOTE</em>: this example uses almost 7GB of disk space.</p>
<pre><code class="language-bash"># Create a directory we'll clone and build a few repositories.
mkdir -p photo-restoration &amp;&amp; cd photo-restoration

# Download and audit the garden file we're going to run.
wget https://gitlab.com/garden-rs/garden/-/raw/main/doc/src/examples/photo-restoration/garden.yaml
cat garden.yaml

# One-time setup: Clone all of the trees. This will clone an &quot;old-photos&quot; repo.
garden grow old-photos

# One-time setup: Download resources.
garden setup old-photos
</code></pre>
<h2 id="run-the-software"><a class="header" href="#run-the-software">Run the Software</a></h2>
<p>Now that everything is setup we can run the tools using the custom <code>run</code> command
provided by the <code>garden.yaml</code> file. The <code>run.py</code> script takes several options.</p>
<pre><code class="language-bash">garden run old-photos -- --help
</code></pre>
<p>Arguments can be passed directly to <code>run.py</code> by passing additional arguments
after the special double-dash <code>--</code> &quot;end of options&quot; marker.</p>
<p>The example above pases the <code>--help</code> option for demonstration purposes.
You will have to specify the <code>--input_folder &lt;folder&gt;</code> and <code>--output_folder &lt;folder&gt;</code>
in order to use the photo restoration tool. See the <code>--help</code> output for more details.</p>
<h2 id="gardenyaml"><a class="header" href="#gardenyaml">garden.yaml</a></h2>
<p>The following is the contents of the <code>garden.yaml</code> file used in this example.</p>
<p>The <code>setup</code> command defines what happens during <code>garden setup old-photos</code>.</p>
<p>The <code>run</code> command defines when happens during <code>garden run old-photos</code>.</p>
<p>Additional command-line arguments specified after the double-dash <code>--</code> marker are
available to commands via conventional <code>$1</code>, <code>$2</code>, <code>$N</code>, ... <code>&quot;$@&quot;</code> shell variables.</p>
<pre><code class="language-yaml">trees:
    old-photos:
        description: |
          Restore old photos using machine-learning.
          $ garden grow old-photos
          $ garden setup old-photos
          $ garden run old-photos -- --help

        url: &quot;https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life.git&quot;
        links:
            - &quot;https://colab.research.google.com/drive/1NEm6AsybIiC5TwTU_4DqDkQO0nFRB-uA?usp=sharing&amp;authuser=2#scrollTo=32jCofdSr8AW&quot;
            - &quot;http://raywzy.com/Old_Photo/&quot;
            - &quot;https://news.ycombinator.com/item?id=25148253&quot;

        commands:
            # &quot;setup&quot; uses &quot;&gt;&quot; post-commands to run &quot;setup/virtualenv&quot; and &quot;setup/download&quot;.
            setup&gt;:
                - setup/virtualenv
                - setup/download

            setup/virtualenv: |
                test -d ${env3} || (
                    python3 -m venv ${env3}
                    ${env3}/bin/pip install -r requirements.txt
                )

            setup/download: |
                (
                    cd ./Face_Detection
                    test -f shape_predictor_68_face_landmarks.dat || (
                        curl -L http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2 \
                            -o shape_predictor_68_face_landmarks.dat.bz2
                        bzip2 -v -d shape_predictor_68_face_landmarks.dat.bz2
                    )
                )
                (
                    cd ./Face_Enhancement
                    test -f checkpoints.zip ||
                    curl -L https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life/releases/download/v1.0/face_checkpoints.zip \
                        -o checkpoints.zip
                    test -d checkpoints || unzip checkpoints.zip
                )
                (
                    cd ./Global
                    test -f checkpoints.zip ||
                    curl -L https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life/releases/download/v1.0/global_checkpoints.zip \
                        -o checkpoints.zip
                    test -d checkpoints || unzip checkpoints.zip
                )

            run: ${env3}/bin/python3 run.py &quot;$@&quot;

        environment:
            PATH: &quot;${TREE_PATH}/${env3}/bin&quot;

variables:
    env3: $ python3 -c 'import sys; print(&quot;env%s%s&quot; % sys.version_info[:2])'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git-cola-development"><a class="header" href="#git-cola-development">Git Cola Development</a></h1>
<p>This garden file sets up a development garden with the latest version of Git, Git Cola,
qtpy and vx.</p>
<p>Run the following commands to see this in action.</p>
<pre><code class="language-bash"># Create a directory we'll clone and build a few repositories.
mkdir -p cola &amp;&amp; cd cola

# Download and audit the garden file we're going to run.
wget https://gitlab.com/garden-rs/garden/-/raw/main/doc/src/examples/git-cola/garden.yaml
cat garden.yaml

# One-time setup: Clone all of the repos in the &quot;cola&quot; garden and use a custom
# &quot;garden grow&quot; is a garden built-in command that clones.
garden grow cola

# &quot;garden setup&quot; command defined in &quot;garden.yaml&quot; to initializes the environment.
garden setup cola

# All set! Now we can run Git Cola from the development environment.
garden run

# Daily development workflow: run tests in each repository in-place.
garden test cola

# Commands can be passed to the underlying &quot;run&quot; command to run Git Cola
# against any Git repository.
garden run -- --repo path/to/any/git/tree

# These projects don't need to be &quot;built&quot;, so this is technically a no-op.
# A Rust or C++ Rust project could use something like this to run &quot;make&quot;
# in each repository.
garden build cola
</code></pre>
<p>The development repositories are now in your current directory and a
development virtualenv is present in the <code>./dist</code> directory.</p>
<h2 id="gardenyaml-1"><a class="header" href="#gardenyaml-1">garden.yaml</a></h2>
<p>The following is the contents of the <code>garden.yaml</code> file used in this example.</p>
<pre><code class="language-yaml"># Create environments for developing Git Cola against development versions of Git.
#
# The following gardens are defined: &quot;cola&quot;, &quot;cola/main&quot; and &quot;cola/next&quot;.
#
# The &quot;cola&quot; garden runs git-cola using the &quot;git&quot; command from your $PATH.
# The &quot;cola/main&quot; garden runs git-cola using git.git's &quot;main&quot; branch.
# The &quot;cola/next&quot; garden runs git-cola using git.git's &quot;next&quot; branch.
#
# One-time Setup:
#
# * Clone repositories and create worktrees:
#
#   garden grow cola/main cola/next
#
# * Initialize git-cola's Python virtualenv environment.
#
#   garden setup cola
#
# Development workflows:
#
# * Build the &quot;cola/main&quot; garden using git.git's &quot;main&quot; branch:
#   garden build cola/main
#
# * Build the &quot;cola/next&quot; garden using git.git's &quot;next&quot; branch:
#   garden build cola/next
#
# * Run Git Cola
#   garden run
#
# * Run Git Cola on the git/next and git-cola trees using the cola/next garden environment:
#   garden run --trees git/next cola/next
#   garden run -t git-cola cola/next
#
# * Open a shell for running Git Cola in different enviornments
#   garden shell cola/main
#   garden shell cola/next
#
# * Run just Git Cola's tests in each environment.
#   garden test/cola cola
#   garden test/cola cola/main
#   garden test/cola cola/next
#
# * Run tests for all projects in each environment. Also runs Git's testsuite.
#   garden test cola
#   garden test cola/main
#   garden test cola/next

# The following variables are used in the custom commands below.
variables:
    # A virtualenv is created in the ./dist/git-cola/env3 directory.
    prefix: ${GARDEN_ROOT}/git-cola/env3
    jobs: $ nproc 2&gt;/dev/null || sysctl -n hw.ncpu 2&gt;/dev/null || echo 8

commands:
    add-all: git add --update
    diff: GIT_PAGER= git diff --patience --color-words &quot;$@&quot;
    lol: git log --decorate --graph --oneline &quot;$@&quot; &amp;&amp; echo
    run: vx ${prefix} git cola &quot;$@&quot;
    status:
        - git status --short
        - git branch

templates:
    bin:
        environment:
            PATH: ${TREE_PATH}/bin
    python:
        environment:
            PYTHONPATH: ${TREE_PATH}
    makefile:
        commands:
            build: make -j ${jobs} prefix=&quot;${prefix}&quot; all &quot;$@&quot;
            install: make -j ${jobs} prefix=&quot;${prefix}&quot; install &quot;$@&quot;
            test: make -j ${jobs} prefix=&quot;${prefix}&quot; test &quot;$@&quot;
            doc: make -j ${jobs} prefix=&quot;${prefix}&quot; doc &quot;$@&quot;

trees:
    # git/main is the parent worktree that shares its .git storage with the child
    # git/next worktrees using &quot;git worktree&quot; -- https://git-scm.com/docs/git-worktree
    git/main:
        url: https://github.com/git/git.git
        templates: makefile
        environment:
            PATH: ${TREE_PATH}/bin-wrappers
            # git/next is a &quot;git worktree&quot; for git.git's &quot;next&quot; branch.
    git/next:
        worktree: git/main
        branch: next

        # git-cola's worktree can be reused alongside any of the git/* trees defined above.
    git-cola:
        url: https://gitlab.com/git-cola/git-cola.git
        templates: [bin, python]
        commands:
            setup: garden dev
            test/cola: garden test &quot;$@&quot;
            install: garden -D prefix=&quot;${prefix}&quot; install &quot;$@&quot;
            test: garden test &quot;$@&quot;
            doc: garden doc &quot;$@&quot;

    qtpy:
        description: Qt abstraction library used by git-cola
        url: https://github.com/spyder-ide/qtpy.git
        templates: python
        setup: vx ${prefix} pip install pytest-qt

    vx:
        description: Utility for activating Python virtualenvs
        url: https://gitlab.com/davvid/vx.git
        depth: 1  # Create a shallow clone using &quot;git clone --depth=1&quot;
        environment:
            PATH: ${TREE_PATH}
        commands:
            test: make test

    # This tree allows the &quot;run&quot; command to be run from any directory.
    cwd:
        path: ${PWD}

groups:
    cola-repos-grp:
        - git-cola
        - qtpy
        - vx

gardens:
    cola:
        groups: cola-repos-grp
        environment:
            PATH: ${prefix}/bin
    cola/main:
        groups: cola-repos-grp
        trees: git/main
        environment:
            PATH: ${prefix}/bin
    cola/next:
        groups: cola-repos-grp
        trees: git/next
        environment:
            PATH: ${prefix}/bin
</code></pre>
<h2 id="pre-defined-custom-commands-and-ad-hoc-commands"><a class="header" href="#pre-defined-custom-commands-and-ad-hoc-commands">Pre-defined Custom Commands and Ad-Hoc Commands</a></h2>
<p>Included in <code>garden.yaml</code> are a few few helpful commands that give us a quick
view of what's going on in each tree:</p>
<pre><code class="language-bash">garden diff cola
garden status cola
garden lol cola
</code></pre>
<p>If we want to perform git stuff (like fetch the latest changes), we can
always use <code>garden exec</code> to run arbitrary commands:</p>
<pre><code class="language-bash">garden exec cola git fetch --verbose

# When needed, we can hop into a shell with all of the environment variables set
garden shell cola
</code></pre>
<h2 id="self-contained-installation-demo"><a class="header" href="#self-contained-installation-demo">Self-contained installation demo</a></h2>
<p>The <code>garden run</code> example runs <code>git</code> and <code>git cola</code> in-place in their
respective trees. The <code>git-cola</code> project is not installed into the <code>./dist</code> directory.
It contains just the virtualenv created needed to run it.</p>
<p>In order to create a self-contained installation to run the tools
independently of their source repositories we have to install them into the
<code>./dist</code> directory.</p>
<p>The following example installs Git and Git Cola into the <code>./dist</code> directory
by running the &quot;make install&quot; targets in each repo:</p>
<pre><code class="language-bash">garden install cola
</code></pre>
<p>Now we can test the installed tools directly by adding <code>./dist/bin</code> to our
<code>$PATH</code>, or just invoke the script directly:</p>
<pre><code class="language-bash">./dist/bin/git-cola
</code></pre>
<p>Voila, we now have a fully functional development environment with PyQt5, qtpy
and Git Cola ready to go for development.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-interpreters-1"><a class="header" href="#command-interpreters-1">Command Interpreters</a></h1>
<p>This example demonstrates how to use custom interpreters on a per-command basis.</p>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<pre><code class="language-bash">garden hello
garden info
# Pass additional arguments after the double-dash `--` end-of-options marker.
garden hello -- cat
</code></pre>
<h2 id="gardenyaml-2"><a class="header" href="#gardenyaml-2">garden.yaml</a></h2>
<pre><code class="language-yaml"># Demo using custom interpreters on a per-command basis.
commands:
    # The &quot;#!&quot; shebang line specifies the interpreter to use.
    hello: |
        #!python3 -c
        import sys
        # dash_c = sys.argv[0]  # sys.argv[0] contains '-c'
        args = sys.argv[1:]  # additional arguments specified after '--'
        if args:
            world = ' '.join(args)
        else:
            world = 'world'
        print(f'hello {world}')

    # The default `garden.shell` is used when no shebang line is present.
    info: echo ${uname}

# NOTE: exec expressions are always run using the system's default #!/bin/sh shell.
variables:
    uname: $ uname -a
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="python-commands"><a class="header" href="#python-commands">Python Commands</a></h1>
<p>This example demonstrates how to configure <code>garden.shell</code> to use <code>python3</code>
when running custom commands.</p>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<pre><code class="language-bash">garden hello
garden info
# Pass additional arguments after the double-dash `--` end-of-options marker.
garden hello -- cat
</code></pre>
<h2 id="gardenyaml-3"><a class="header" href="#gardenyaml-3">garden.yaml</a></h2>
<pre><code class="language-yaml"># Demo using &quot;python3&quot; as the interpreter for custom commands.
garden:
    shell: python3

commands:
    hello: |
        import sys
        # dash_c = sys.argv[0]  # sys.argv[0] contains '-c'
        args = sys.argv[1:]  # additional arguments specified after '--'
        if args:
            world = ' '.join(args)
        else:
            world = 'world'
        print(f'hello {world}')

    info: |
        import os
        import sys
        print(f'os.name = {os.name}')
        print(f'sys.platform = {sys.platform}')
        print(r'sys.int_info = {sys.int_info}')
        print('uname = ${uname}')

variables:
    # NOTE: exec expressions are always run using the system's default #!/bin/sh shell.
    uname: $ uname -a
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nodejs-commands"><a class="header" href="#nodejs-commands">Node.js Commands</a></h1>
<p>This example demonstrates how to configure <code>garden.shell</code> to use <code>node</code>
when running custom commands.</p>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<pre><code class="language-bash">garden hello
garden info
# Pass additional arguments after the double-dash `--` end-of-options marker.
garden hello -- cat
</code></pre>
<h2 id="gardenyaml-4"><a class="header" href="#gardenyaml-4">garden.yaml</a></h2>
<pre><code class="language-yaml"># Demo using &quot;node&quot; as the interpreter for custom commands.
garden:
    shell: node

commands:
    hello: |
        if (process.argv.length &gt; 1) {
            console.log('hello ' + process.argv.slice(1).join(' '));
        } else {
            console.log('hello world')
        }

    info: |
        console.log(process)
        console.log('${uname}')

# NOTE: exec expressions are always run using the system's default #!/bin/sh shell.
variables:
    uname: $ uname -a
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<h2 id="v140"><a class="header" href="#v140">v1.4.0</a></h2>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>Custom commands can now specify an interpreter to use on a per-command basis.
If a command uses a shebang <code>#!</code> line then the command's text will be passed as the
next argument to the specified command. For example, using <code>#!python3 -c</code> as the
first line in a custom command will cause <code>python3 -c &lt;command&gt;</code> to be executed.</p>
</li>
<li>
<p>Trees can now use branches defined in separate remotes when configuring the
default branch to checkout. <code>garden grow</code> will now fetch the remote associated with the
configured branch switching branches in order to make this possible.</p>
</li>
<li>
<p>Trees can now use any upstream branch from any configured remote in the <code>branches</code> section.
Previously, branches associated with non-default remotes could not be created unless
they were fetched beforehand. <code>garden grow</code> will now fetch the associated remote
before creating the local branch.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li><code>garden</code> can now be built on Windows. Symlink trees and the XDG base directory support
is UNIX-only and disabled on Windows.
(<a href="https://gitlab.com/garden-rs/garden/-/issues/17">#17</a>)</li>
</ul>
<h2 id="v130"><a class="header" href="#v130">v1.3.0</a></h2>
<p><em>Released 2024-02-19</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden eval</code> and garden expressions in general will now resolve variables defined
within <code>environment</code> blocks. Environment blocks were previously not considered when
resolving variables. Environment blocks are now resolved and checked for variables
when <code>${variable}</code> expressions do not find the variable in scopes with higher
precedence. The precedence order, from strongest to weakest, is the <code>variables</code>
block in a garden's scope, the <code>variables</code> block in a tree's scope, the
<code>variables</code> block in global configuration scope, the <code>environments</code> block in
a garden's scope, the <code>environments</code> block in a tree's scope, the
<code>environments</code> block in global configuration scope and, lastly, OS environment
variables. The first entry found is used when expanding variable expressions.
(<a href="https://github.com/davvid/garden/pull/23">#23</a>)</p>
</li>
<li>
<p>Evaluation cycles (i.e. circular variable dependencies) are now prevented when
evaluating garden variables. The evaluation engine will now return empty strings
when a variable with a cyclical expression is evaluated.
(<a href="https://github.com/davvid/garden/pull/24">#24</a>)</p>
</li>
<li>
<p>When <code>zsh</code> is used as the <code>garden.shell</code>, which happens automatically when <code>zsh</code>
is installed, <code>garden</code> will now use <code>zsh -o shwordsplit</code> in order to enable
word-splitting of <code>$variable</code> expressions by default. This makes <code>zsh</code> behave
just like other shells by default, which improves the portability of commands.
Configure <code>garden.shell-wordsplit</code> to <code>false</code> or use the
<code>garden &lt;cmd&gt; -z | --no-wordsplit</code> option to opt-out of this behavior.
(<a href="https://github.com/davvid/garden/pull/25">#25</a>)</p>
</li>
<li>
<p><code>garden.shell</code> can now be configured to use arbitrary commands for executing
command strings. Garden uses the configured <code>garden.shell</code> as-is and does
not augment its options (e.g. <code>-e</code>  or <code>-o shwordsplit</code>) when a custom command
is used. Custom commands are identified as commands that expand to 2 or more
command-line arguments. Thus, <code>python3</code> is not considered a custom command
and <code>garden</code> will run <code>python3 -c &lt;string&gt;</code> to run commands. On the other
hand, specifying <code>ruby -e</code> <em>is</em> considered a custom command because it
expands to <code>[&quot;ruby&quot;, &quot;-e&quot;]</code> under the hood. If you need to use a custom
command  that takes no additional command-line arguments then you can
use <code>env</code> as an extra argument to have it be considered as a custom shell.
For example, <code>env custom-shell</code> will cause <code>garden</code> to run
<code>env custom-shell &lt;string&gt;</code>, which is equivalent to <code>custom-shell &lt;string&gt;</code>.
Using just <code>custom-shell</code> would have resulted in <code>garden</code> running
<code>custom-shell -c &lt;string&gt;</code> instead, which may not be desired.
(<a href="https://github.com/davvid/garden/pull/26">#26</a>)</p>
</li>
<li>
<p>The <code>garden shell</code> command can now be configured to use an interactive command shell
that is distinct from the command specified in the <code>garden.shell</code> configuration by
configuring the <code>garden.interactive-shell</code> value.
(<a href="https://github.com/davvid/garden/pull/26">#26</a>)</p>
</li>
<li>
<p><code>garden shell</code> can now be run without any arguments. The tree query now defaults to
<code>.</code> so that the tree in the current directory is used when nothing is specified.
(<a href="https://github.com/davvid/garden/pull/26">#26</a>)</p>
</li>
<li>
<p>Custom commands now have access to a <code>${GARDEN_CMD_VERBOSE}</code> and <code>${GARDEN_CMD_QUIET}</code>
variables which can be used to forward the <code>--verbose</code> and <code>--quiet</code> arguments
down into child <code>garden</code> invocations. <code>${GARDEN_CMD_VERBOSE}</code> uses the short <code>-v</code>
flag in the value to support the case where the verbose option is specified
multiples times to increase the verbosity level (e.g. <code>-vv</code>).
(<a href="https://github.com/davvid/garden/pull/27">#27</a>)</p>
</li>
</ul>
<h2 id="v121"><a class="header" href="#v121">v1.2.1</a></h2>
<p><em>Released 2024-02-05</em></p>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>The <code>yaml-rust-davvid</code> dependency was upgraded to <code>v0.6.0</code>.</p>
</li>
<li>
<p>Documentation and code maintenance.</p>
</li>
</ul>
<h2 id="v120"><a class="header" href="#v120">v1.2.0</a></h2>
<p><em>Released 2024-01-27</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>If a garden file has no trees defined at all then an implicit tree called
<code>.</code> will now be synthesized into existence. The presence of this implicit tree
allows garden files that define just the current directory as a tree to omit
the entire <code>trees</code> section altogether. This consequently makes it easier
to use garden as a simple command runner because the <code>commands</code> section
is the only section required in order to run <code>garden</code> commands.</p>
</li>
<li>
<p>When <code>garden.root</code> is not configured <code>garden</code> will behave as if
<code>garden.root</code> is configured to <code>${GARDEN_CONFIG_DIR}</code>. This allows garden files to
omit <code>garden.root</code> from their configuration in typical scenarios.</p>
</li>
<li>
<p>Configuring <code>garden.root</code> to an empty string (<code>&quot;&quot;</code>) will behave as if <code>garden.root</code>
is configured to the current directory from which <code>garden</code> was run.</p>
</li>
<li>
<p>When a <code>garden.yaml</code> file does not exist in the current directory then garden
will walk up the file system searching for <code>garden.yaml</code> or the name specified using
<code>garden -c &lt;name&gt;</code>. Garden will behave as if it were launched from the directory
containing the garden file when a configuration file is found.</p>
</li>
<li>
<p>The <code>GARDEN_CEILING_DIRS</code> and <code>GIT_CEILING_DIRS</code> environment variables can be
used to limit the <code>garden.yaml</code> discovery by preventing <code>garden</code> from traversing
into and beyond the specified directories when discovering garden files.</p>
</li>
<li>
<p><code>garden exec</code>, <code>garden cmd</code> <code>garden grow</code>, <code>garden ls</code> and custom garden commands
can now filter the trees they operate over by passing a glob pattern using
<code>-t | --trees</code> option. These commands will only operate on the trees whose names
match the pattern. This allows you to specify a garden as the tree query and use
the full set of environment variables from all trees in the query while
executing commands over a subset of the trees in that garden.</p>
</li>
<li>
<p><code>garden init</code> will now add the current directory to the <code>trees</code> block
when the current directory contains a Git repository. Use <code>garden init --empty</code>
to disable this behavior.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>The <code>shlex</code> dependency was upgraded to <code>1.3.0</code>, which includes fixes for
<a href="https://rustsec.org/advisories/RUSTSEC-2024-0006.html">RUSTSEC-2024-0006</a> a.k.a.
<a href="https://github.com/comex/rust-shlex/security/advisories/GHSA-r7qv-8r2h-pg27">GHSA-r7qv-8r2h-pg27</a>.</li>
</ul>
<h2 id="v110"><a class="header" href="#v110">v1.1.0</a></h2>
<p><em>Released 2024-01-15</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden ls</code> now displays information about trees, groups, gardens and commands.</p>
</li>
<li>
<p><code>garden ls -c</code> (i.e. <code>--no-commands</code>) hides command details from the output.</p>
</li>
<li>
<p><code>garden plant -s</code> (i.e. <code>--sort</code>) sorts all of the configured <code>trees</code> entries
after planting the specified trees.</p>
</li>
<li>
<p><code>garden exec -n</code> (i.e. <code>--dry-run</code>) performs a trial run without executing
any commands.</p>
</li>
<li>
<p><code>garden.shell-errexit</code> can now be configured to <code>false</code> in <code>garden.yaml</code> to
opt-out of using the <code>-e</code> exit-on-error shell option when running custom commands.</p>
</li>
<li>
<p><code>garden.shell</code> can now be configured to <code>bun</code>, <code>fish</code>, <code>node</code>, <code>perl</code> and <code>python3</code>
in addition to the traditional <code>bash</code>, <code>zsh</code>, <code>dash</code>, <code>ksh</code> and <code>sh</code> shells.
This allows you to use these interpreters to run custom commands.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>Garden is now using
<a href="https://gitlab.com/ijackson/rust-shellexpand#version-300-2022-12-01">shellexpand v3</a>.</li>
</ul>
<h2 id="v100"><a class="header" href="#v100">v1.0.0</a></h2>
<p><em>Released 2023-12-23</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>Commands can now specify pre-commands and post-commands that are run before/after
the specified command.
(<a href="https://github.com/davvid/garden/issues/3">#3</a>)
(<a href="https://garden-rs.gitlab.io/commands.html#pre-and-post-commands">documentation</a>)</p>
</li>
<li>
<p>The default <code>origin</code> remote name can now be configured using <code>tree.&lt;tree&gt;.default-remote</code>.
(<a href="https://gitlab.com/garden-rs/garden/-/issues/16">#16</a>)</p>
</li>
<li>
<p>Commands now display the tree's current branch alongside the tree name.
(<a href="https://github.com/davvid/garden/issues/18">#18</a>)</p>
</li>
<li>
<p><code>garden -vv exec</code> and <code>garden -vv shell</code> now display the command being run.</p>
</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li><code>garden</code> can now be installed as a <code>nix flake</code> package.
A <code>flake.nix</code> file is now provided.
(<a href="https://github.com/davvid/garden/issues/16">#16</a>)</li>
</ul>
<h2 id="v091"><a class="header" href="#v091">v0.9.1</a></h2>
<p><em>Released 2023-11-19</em></p>
<p><strong>Fixes</strong>:</p>
<ul>
<li><code>garden -D name=value</code> now overrides variables in all scopes.
Variables defined in tree scope were not subject to overrides and
will now get properly overridden by the <code>--define</code> / <code>-D</code>
command-line options.</li>
</ul>
<h2 id="v090"><a class="header" href="#v090">v0.9.0</a></h2>
<p><em>Released 2023-11-02</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li><code>garden grow</code> now sets <code>git config remote.$name.tagopt --no-tags</code>
when adding additional remotes. This prevents accidentally fetching tags
when interacting with remotes.</li>
</ul>
<h2 id="v081"><a class="header" href="#v081">v0.8.1</a></h2>
<p><em>Released 2023-07-18</em></p>
<p><strong>Fixes</strong>:</p>
<ul>
<li><code>garden grow</code> was fixed to detect existing branches when growing
<code>git worktree</code>-created child worktrees.</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p><code>strum</code> is now used to implement <code>FromStr</code> for <code>enum ColorMode</code>.</p>
</li>
<li>
<p><a href="https://crates.io/crates/is-terminal">is-terminal</a> is now used instead of
the unmaintained <code>atty</code> crate.</p>
</li>
</ul>
<h2 id="v080"><a class="header" href="#v080">v0.8.0</a></h2>
<p><em>Released 2023-07-16</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden</code> now supports a <code>grafts</code> feature that allows you to
<a href="https://garden-rs.gitlab.io/configuration.html#grafts">stitch configuration entities from separate garden files</a>
into a graft-specific namespace. Trees and variables from grafted configurations can be
referenced using <code>graft::</code> namespace qualifiers.</p>
</li>
<li>
<p><code>garden grow</code> can now configure <a href="https://garden-rs.gitlab.io/commands.html#upstream-branches">upstream branches</a>.</p>
</li>
<li>
<p><code>garden grow</code> can now configure <a href="https://garden-rs.gitlab.io/commands.html#upstream-branches#git-configuration-values">gitconfig settings with multiple values</a>
using <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt---add"><code>git config --add &lt;name&gt; &lt;value&gt;</code></a>.</p>
</li>
</ul>
<h2 id="v070"><a class="header" href="#v070">v0.7.0</a></h2>
<p><em>Released 2023-02-12</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>Trees, Groups, Gardens and Commands defined in the top-level <code>garden.yaml</code> can now
override entries defined via <code>garden.includes</code>. Configuration entities now follow
&quot;last one wins&quot; semantics -- if the same entity is defined in multiple includes files
then only the final definition will be used.
(<a href="https://github.com/davvid/garden/issues/14">#14</a>)
(<a href="https://github.com/davvid/garden/pull/15">#15</a>)</p>
</li>
<li>
<p><a href="https://garden-rs.gitlab.io/configuration.html#l#the-last-one-wins-rule">Trees now sparsely override existing entries</a>.
This behavior allows a tree definition to replace just the <code>url</code> field, or to replace
individual tree commands while retaining the rest. Use <code>replace: true</code> in a Tree
definition in order to completely replace the existing entry instead of sparsely
overriding it.</p>
</li>
<li>
<p>Improved shell completions for <code>garden</code>, <code>garden init</code> and <code>garden plant</code>.</p>
</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li><a href="https://github.com/0323">0323pin</a> packaged <code>garden</code> for pkgsrc/NetBSD and
<a href="http://mail-index.netbsd.org/pkgsrc-changes/2023/01/22/msg267560.html">merged the package into the main branch!</a>
(<a href="https://github.com/davvid/garden/issues/13">#13</a>)</li>
</ul>
<h2 id="v060"><a class="header" href="#v060">v0.6.0</a></h2>
<p><em>Released 2023-01-20</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>Both names and values in <code>gitconfig</code> can now use <code>${var}</code> expressions.
Previously only values were evaluated. Names are evaluated now as well.</li>
</ul>
<p><strong>Fixes</strong>:</p>
<ul>
<li>The <code>zsh</code> workaround for <code>garden completion zsh</code> is no longer needed.
The <a href="https://garden-rs.gitlab.io/commands.html#zsh">documentation for generating zsh completions</a>
has been updated.
(<a href="https://github.com/davvid/garden/issues/10">#10</a>)</li>
</ul>
<h2 id="v051"><a class="header" href="#v051">v0.5.1</a></h2>
<p><em>Released 2023-01-15</em></p>
<p><strong>Fixes</strong>:</p>
<ul>
<li>Exec expressions were previously run with the current directory set to the
directory from which garden was run. Exec expressions are now run in the
tree's current directory.</li>
</ul>
<h2 id="v050"><a class="header" href="#v050">v0.5.0</a></h2>
<p><em>Released 2023-01-12</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><a href="https://garden-rs.gitlab.io/configuration.html#includes">Garden configuration files can now include other configuration files
</a> by specifying
the additional files to include in the <code>garden.includes</code> field.
The <code>includes</code> feature makes it possible to create modular and reusable garden files.
The <code>trees</code>, <code>variables</code>, <code>commands</code>, <code>groups</code> and <code>gardens</code> defined in the included
files are added to the current configuration.
(<a href="https://github.com/davvid/garden/pull/7">#7</a>)</p>
</li>
<li>
<p><a href="https://garden-rs.gitlab.io/commands.html#shell-syntax">Garden commands can now use shell variables</a>
using the standard (brace-less) shell <code>$variable</code> syntax. The braced <code>${garden}</code>
variable syntax remains reserved for resolving Garden Variables.
Double-<code>$</code> braces (ex: <code>$${...}</code>) can be used to escape a <code>$${variable}</code> from
evaluation so that a literal <code>${variable}</code> value is used in the garden command.
(<a href="https://github.com/davvid/garden/issues/11">#11</a>)
(<a href="https://github.com/davvid/garden/pull/12">#12</a>)</p>
</li>
<li>
<p>A new <code>garden completion</code> subcommand was added for providing shell command-line
completion using the <a href="https://crates.io/crates/clap_complete">clap_complete</a> crate.
(<a href="https://github.com/davvid/garden/pull/9">#9</a>)</p>
</li>
<li>
<p><code>garden -V | --version</code> was added alongside the <code>clap</code> rewrite for displaying
the <code>garden</code> command version.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>The <code>Makefile</code> has been replaced by a <code>garden.yaml</code> Garden file.
We can now use <code>garden {build, test, check, fmt, clippy, ...}</code> instead of <code>make ...</code>.
See <a href="https://gitlab.com/garden-rs/garden/-/raw/5ef8d0ab16a64660fef2bfc551e69cc782dfd4a3/garden.yaml">garden.yaml @ 5ef8d0ab16 for more details</a>.
Packagers can use <code>cargo install</code> to install <code>garden</code> and invoke <code>mdbook</code> directly
to install the user manual. We also provide
<code>garden -D DESTDIR=/tmp/stage -D prefix=/usr/local install-doc</code> if distros
want to install the user manual using our recipe.
(<a href="https://github.com/davvid/garden/pull/8">#8</a>)</p>
</li>
<li>
<p>Garden's command-line parsing has been rewritten to leverage the
<a href="https://crates.io/crates/clap">clap</a> crate and ecosystem.</p>
</li>
</ul>
<h2 id="v041"><a class="header" href="#v041">v0.4.1</a></h2>
<p><em>Released 2022-12-26</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>The <code>garden cmd --no-errexit</code> option was extended to work with commands that are
configured using a YAML list of strings. Commands that are specified using lists
are now indistinguishable from commands specified using multi-line strings.</li>
</ul>
<h2 id="v040"><a class="header" href="#v040">v0.4.0</a></h2>
<p><em>Released 2022-12-23</em></p>
<p><strong>Breaking Changes</strong>:</p>
<ul>
<li>
<p><code>garden cmd</code> now runs custom commands using <code>&lt;shell&gt; -e -c '&lt;command&gt;'</code> by default.
The use of <code>-e</code> is a change in behavior and causes multi-line / multi-statement
commands to halt execution when the first non-zero exit code is encountered.
Use <code>set +e</code> at the top of of a multi-line command to opt-out of this behavior
on a per-command basis, or specify the <code>-n | --no-errexit</code> option.</p>
</li>
<li>
<p><code>garden</code> will now fallback to <code>bash</code> (and <code>sh</code>) as the default <code>garden.shell</code> value
when <code>zsh</code> (and <code>bash</code>) are not installed. As before, the <code>garden.shell</code>
configuration variable can be used to override the default shell.</p>
</li>
</ul>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden prune</code> was added for removing orphaned Git repositories.
(<a href="https://github.com/davvid/garden/issues/4">#4</a>)</p>
</li>
<li>
<p><code>garden cmd</code> can now run commands in breadth-first order when the
<code>-b/--breadth-first</code> option is used. Depth-first tree traversal is the default.
The <code>garden cmd --breadth-first</code> traversal runs all commands on a tree before
continuing on to the next tree. The default <code>garden cmd</code> depth-first traversal
runs a command across all trees before continuing on to the next command.
(<a href="https://github.com/davvid/garden/issues/3">#3</a>)</p>
</li>
</ul>
<h2 id="v030"><a class="header" href="#v030">v0.3.0</a></h2>
<p><em>Released 2022-08-20</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li><code>garden plant</code> can now detect <code>git worktree</code> repositories.
(<a href="https://github.com/davvid/garden/issues/1">#1</a>)</li>
</ul>
<h2 id="v020"><a class="header" href="#v020">v0.2.0</a></h2>
<p><em>Released 2022-07-29</em></p>
<p><strong>Breaking Changes</strong>:</p>
<ul>
<li><code>garden add</code> was renamed to <code>garden plant</code>.</li>
</ul>
<p><strong>Features</strong>:</p>
<ul>
<li><code>garden grow</code> can now grow trees using &quot;git worktree&quot; (#1).</li>
<li><code>garden grow</code> learned to clone specific branches.</li>
<li><code>garden grow</code> and <code>garden plant</code> can now handle bare repositories.</li>
</ul>
<h2 id="v010"><a class="header" href="#v010">v0.1.0</a></h2>
<p><em>Released 2022-06-13</em></p>
<p><strong>Features</strong>:</p>
<p>This is the initial garden release.</p>
<ul>
<li><code>garden grow</code> grows worktrees.</li>
<li><code>garden init</code> initializes configuration.</li>
<li><code>garden plant</code> (formerly <code>garden add</code>) adds existing trees.</li>
<li><code>garden cmd</code> and <code>garden &lt;custom-command&gt;</code> can run custom commands.</li>
<li>Templates, variables, and environment variables are all supported.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
