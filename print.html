<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Garden User Guide</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="Garden grows and cultivates Git trees">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Garden User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://gitlab.com/garden-rs/garden/tree/main/doc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-gitlab"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="garden-user-guide"><a class="header" href="#garden-user-guide">Garden User Guide</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Garden streamlines development workflows that involve a loosely-coupled set of
multiple, independent Git trees.</p>
<p>Garden allows you to define dynamic relationships and workflows between these
repositories using a YAML configuration file that can be shared and used as
a bootstrapping mechanism for getting an audit-able, from-source project cloned,
built, installed and running with minimal effort for consumers of a Garden file.</p>
<p>Garden sits above any individual project's build scripts and conventions.
Garden is all about making it easy to remix and reuse libraries maintained
in separate Git repositories.</p>
<h3 id="project-links"><a class="header" href="#project-links">Project Links</a></h3>
<ul>
<li>
<p><a href="https://gitlab.com/garden-rs/garden">Garden source code repository</a></p>
</li>
<li>
<p><a href="https://crates.io/crates/garden-tools">Garden crates.io package</a></p>
</li>
<li>
<p><a href="https://gitlab.com/garden-rs/homebrew-garden">Garden Homebrew formula</a></p>
</li>
<li>
<p><a href="https://cdn.netbsd.org/pub/pkgsrc/current/pkgsrc/devel/garden/index.html">Garden NetBSD pkgsrc</a></p>
</li>
<li>
<p><a href="https://docs.rs/garden-tools">Garden API Documentation</a></p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<ul>
<li>
<p><em><strong>garden.yaml</strong></em> -- also known as a "Garden file", a YAML file named
<code>garden.yaml</code> defines trees, groups gardens, variables, commands and
environment variables. <code>garden</code> looks for a file named <code>garden.yaml</code>
by default, but other filenames can be specified using the
<code>garden -c | --config &lt;path&gt;</code> option.</p>
</li>
<li>
<p><em><strong>trees</strong></em> -- trees represent Git worktrees and repository clones.
A tree represents a single repository and its configuration.
Trees provide <em>garden variables</em>, <em>commands</em> and <em>environment variables</em>
that are defined when commands are run on a tree. Environment variables
are defined when a tree is operated on by itself and when combined alongside
other trees in a group or garden context.</p>
</li>
<li>
<p><em><strong>groups</strong></em> -- a named collection of trees. The <code>groups</code> block in the
garden file defines groups of trees that are available for use by
commands and gardens. Groups are lighter-weight than a garden and group
trees together into named collections that can be referenced by gardens
and commands. In contrast to gardens, groups <em>do not</em> provide a scope
in which variables, commands environment variables can be defined.</p>
</li>
<li>
<p><em><strong>garden</strong></em> -- a composite of trees and groups for defining project-level
variables, commands and environment variables. Gardens help create
environments for working on projects composed of multiple Git repositories.
The <code>gardens</code> YAML key/value block defines named gardens with a scope
in which garden-specific variables, commands and environment variables
can be defined.</p>
</li>
<li>
<p><strong>variables</strong>
A YAML key/value table defines named variables that can be used in
YAML strings by using braced <code>shell ${expressions}</code> to provide dynamic
values that can be used to provide modularity and configurability to a garden
file. Variables defined in a garden file are overridden on the
command-line by using the <code>-D / --define key=value</code> option.</p>
</li>
<li>
<p><strong>commands</strong>
The <code>commands</code> YAML key/value table defines named commands that can be run
against trees. The <code>commands</code> block extends <code>garden</code> with user-defined
functionality. The <code>commands</code> block can be defined at global scope, within a
<code>tree</code> block, and within a <code>garden</code> block. The scope in which a command is
defined limits the scope in which it is visible. This means that a command
defined in tree scope will only execute when <code>garden &lt;command&gt; &lt;query&gt;</code>
uses a query that ends up including that tree, and will only run when garden
visits that specific tree.</p>
</li>
<li>
<p><strong>environment variables</strong>
Not to be confused with the <code>variables</code> block, the <code>environment</code> block
is a YAML key/value table that defines environment variables that will
be set when executing <em>commands</em>.</p>
</li>
<li>
<p><em><strong>tree query</strong></em> -- a <a href="https://github.com/netvl/shellexpand">shellexpand</a> glob expression that matches against
garden names, group names and tree names. Several <code>garden</code> builtin commands
take tree queries as arguments as a mechanism for selecting one or more
trees to operate on. The default behavior is to match the tree query pattern
against gardens, groups and trees, in that order, and return the first
matching set of trees. If searching for gardens finds matches then groups and
trees are not searched. If searching for groups finds matches then trees are
not searched. Prefix the tree query pattern with a percent-sign (<code>%</code>),
e.g. <code>%group*</code>, to only query for groups matching the pattern.
Prefix the pattern with an at-sign (<code>@</code>), e.g. <code>@tree</code>, to only query for trees.
Prefix the pattern with colon (<code>:</code>), e.g. <code>:garden</code>, to only query for gardens.
The <code>:garden</code> syntax is not typically used because gardens are already
searched first. <code>%group</code> and <code>@tree</code> can be used to disambiguate queries for
groups and trees that share the same name as a garden.</p>
</li>
<li>
<p><strong>string expressions</strong>
String values can use shell <code>${variables}</code> expressions to interpolate
and expand values in the string. <code>~</code> is expanded to <code>$HOME</code>.
These expressions can be used in most fields where strings are accepted,
e.g. when defining variables, commands and environment variables.</p>
</li>
<li>
<p><strong>exec expressions</strong>
When a <em>string expression</em> starts with <code>$ </code> (dollar-sign then space) then the
variable's value is computed by expanding the string's <code>${garden}</code> variables
and then executing the result and capturing stdout. The captured stdout
output from the command becomes the variable's value. For example, if a
variable called <code>my-pwd</code> is defined using an exec expression such as
<code>my-pwd: $ pwd</code> then the <code>${my_pwd}</code> variable will contain a path.
The <code>my_pwd</code> variable can be used to define other variables, environment
variables, and commands. For example, a command called <code>example-cmd</code> can be
defined using: <code>example-cmd: ls -l ${my-pwd} &amp;&amp; echo my_pwd is ${my_pwd}</code>,</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>There are multiple ways to install <code>garden</code>.</p>
<p>These instructions assume that you have <code>cargo</code> installed for Rust development.</p>
<p><a href="installation.html#install-using-homebrew">Skip ahead to the Homebrew section</a> if you're on macOS
and prefer to install <code>garden</code> using Homebrew.</p>
<p><a href="installation.html#install-on-netbsd">Skip ahead to the NetBSD section</a> if you're on NetBSD
and prefer to install <code>garden</code> using <code>pkgin</code> or the pkgsrc/NetBSD sources.</p>
<h2 id="prebuilt-binaries"><a class="header" href="#prebuilt-binaries">Prebuilt Binaries</a></h2>
<p><a href="https://github.com/garden-rs/garden/releases">Pre-built Binaries are available</a>
for Linux, macOS and Windows.</p>
<p><a href="https://gitlab.com/garden-rs/garden/-/artifacts">Nightly Builds for x86_64 Linux</a>
are also available from the <code>build:amd64</code> jobs.</p>
<h2 id="rust-and-cargo"><a class="header" href="#rust-and-cargo">Rust and Cargo</a></h2>
<p>If you already have <code>cargo</code> installed then you can skip this section.</p>
<p>You may be able to install <code>cargo</code> on macOS and Linux using standard package
managers, e.g. <code>brew install rust</code> or <code>apt install rust-all</code>.</p>
<p>Other platforms and older distributions can get a Rust development toolchain
by going to <a href="https://rustup.rs">rustup.rs and following the installation instructions</a>.</p>
<h2 id="cratesio"><a class="header" href="#cratesio">Crates.io</a></h2>
<p>This requires at least Rust 1.74 and Cargo to be installed. Once you have
installed Rust, type the following in the terminal:</p>
<pre><code>cargo install garden-tools
</code></pre>
<p>This will download and compile <code>garden</code> for you. The only thing left to do is
to add the Cargo <code>$HOME/.cargo/bin</code> directory to your <code>$PATH</code>.</p>
<p>The Garden graphical user interface is provided in a separate crate called <code>garden-gui</code>.
You can install Garden GUI using <code>cargo</code> using Rust 1.81.0 or newer.</p>
<pre><code>cargo install garden-gui
</code></pre>
<h2 id="latest-using-cargo"><a class="header" href="#latest-using-cargo">Latest using Cargo</a></h2>
<p>The version published to crates.io will sometimes be behind the source
code repository. If you want to install the latest pre-release version then you can
build the Git version of Garden yourself using <code>cargo</code>.</p>
<pre><code>cargo install --git https://gitlab.com/garden-rs/garden.git garden-tools
cargo install --git https://gitlab.com/garden-rs/garden.git garden-gui
</code></pre>
<h2 id="install-using-homebrew"><a class="header" href="#install-using-homebrew">Install using Homebrew</a></h2>
<p>You can install <code>garden</code> on macOS using <a href="https://brew.sh/">Homebrew</a>.</p>
<h3 id="add-the-homebrew-garden-tap"><a class="header" href="#add-the-homebrew-garden-tap">Add the homebrew-garden tap</a></h3>
<p><em>NOTE</em>: The custom <code>brew tap</code> will not be needed in the future once the
<a href="https://github.com/Homebrew/homebrew-core/pull/119195">Garden repository gets enough stars, forks or watchers</a>
to allow <code>garden</code> to be added to the main homebrew-core repository.</p>
<p>You will need to enable the <code>homebrew-garden</code> tap until then.</p>
<pre><code class="language-bash">brew tap garden-rs/garden https://gitlab.com/garden-rs/homebrew-garden
</code></pre>
<h3 id="stable-release"><a class="header" href="#stable-release">Stable Release</a></h3>
<p>To install the latest stable release from the <code>homebrew-garden</code> tap:</p>
<pre><code class="language-bash">brew install garden
</code></pre>
<p>Upgrade <code>garden</code> in the future by using <code>brew upgrade garden</code>.</p>
<h3 id="development-version"><a class="header" href="#development-version">Development Version</a></h3>
<p>To install the latest development version from Git:</p>
<pre><code class="language-bash">brew install --head garden
</code></pre>
<p><em>NOTE</em>: If you install the latest development version with <code>--head</code> then you will need to use
<code>brew upgrade --fetch-HEAD garden</code>  to upgrade it.</p>
<p>If you don't specify <code>--fetch-HEAD</code> when upgrading then <code>brew upgrade garden</code> will
actually downgrade <code>garden</code> to the latest stable release.</p>
<h3 id="cleanup"><a class="header" href="#cleanup">Cleanup</a></h3>
<p>Installing <code>garden</code> with Homebrew may leave behind the Rust development tools.</p>
<p>Use <code>brew remove rust</code> after <code>garden</code> is installed to save on disk space.</p>
<p>Read on for how to build garden from source.</p>
<h2 id="install-on-netbsd"><a class="header" href="#install-on-netbsd">Install on NetBSD</a></h2>
<p>Garden has been packaged for
<a href="http://mail-index.netbsd.org/pkgsrc-changes/2023/01/22/msg267560.html">pkgsrc/NetBSD</a>
as described in <a href="https://github.com/garden-rs/garden/issues/13">#13</a>.</p>
<p>To install from the official repository, run:</p>
<pre><code class="language-bash">pkgin install garden
</code></pre>
<p>If you prefer to build from the pkgsrc sources, run:</p>
<pre><code class="language-bash">cd /usr/pkgsrc/devel/garden
make install
</code></pre>
<h2 id="build-and-install-from-source-for-development"><a class="header" href="#build-and-install-from-source-for-development">Build and Install from Source for Development</a></h2>
<p>If you would like to develop features and contribute to Garden then you will
have to clone the repository on your local machine.</p>
<pre><code class="language-bash">git clone https://gitlab.com/garden-rs/garden.git
cd garden

# Build garden only
cargo build

# Build garden and garden-gui
cargo build --workspace

# Install $HOME/.cargo/bin/garden
cargo install --path .

# Install $HOME/.cargo/bin/garden-gui
cargo install --path gui
</code></pre>
<p>This will install <code>garden</code> to <code>~/.cargo/bin/garden</code> by default.</p>
<p>Once you have <code>garden</code> installed then you can use Garden's <code>garden.yaml</code> to run
Garden's custom workflow commands.</p>
<ul>
<li><code>garden test</code> runs the test suite using <code>cargo test</code>.</li>
<li><code>garden check</code> runs checks and lints.</li>
<li><code>garden doc</code> builds the documentation.</li>
<li><code>garden fmt</code> formats the source code.</li>
<li><code>garden install-doc</code> installs the documentation.</li>
</ul>
<p>See Garden's <a href="https://gitlab.com/garden-rs/garden/-/blob/main/garden.yaml"><code>garden.yaml</code></a> for more details.</p>
<h2 id="nix"><a class="header" href="#nix">Nix</a></h2>
<h3 id="nix-flakes"><a class="header" href="#nix-flakes">Nix Flakes</a></h3>
<p><a href="https://nixos.wiki/wiki/Flakes">Nix Flakes</a> can be used to build, test and install <code>garden</code>.
A <code>flake.nix</code> file is provided in the source tree.</p>
<p><a href="https://nixos.wiki/wiki/Flakes#Enable_flakes_permanently_in_NixOS">Enabling flakes permanently</a>
is recommended by either adding <code>experimental-features = nix-command flakes</code> to your
<code>~/.config/nix/nix.conf</code> or <code>/etc/nix/nix.conf</code>, or by using
<a href="https://nixos.wiki/wiki/Flakes#Other_Distros.2C_with_Home-Manager">Home Manager</a>
to install flakes.</p>
<p>The following commands are available once installed.</p>
<ul>
<li><code>nix build</code> builds the <code>garden</code> package.</li>
<li><code>nix shell</code> opens a shell with <code>garden</code> installed.</li>
<li><code>nix run</code> directly run <code>garden</code>.</li>
<li><code>nix develop</code> opens a development shell with <code>garden</code> and <code>cargo</code> installed.</li>
<li><code>nix flake check</code> builds <code>garden</code> and runs the test suite.</li>
</ul>
<h3 id="activating-gardens-nix-package"><a class="header" href="#activating-gardens-nix-package">Activating Garden's Nix Package</a></h3>
<p>You can open a nix shell with garden installed by issuing the following command
from any directory:</p>
<pre><code class="language-bash">nix shell github:garden-rs/garden
</code></pre>
<p>Alternatively, you can also run garden directly by issuing <code>nix run</code> as follows:</p>
<pre><code class="language-bash">nix run github:garden-rs/garden -- --help
</code></pre>
<p>Inside Garden's git repository, you can inspect its derivation by issuing <code>nix derivation show</code>.
The <code>output.path</code> field contains the Nix Store location of the <code>nix</code> package.
For example, <code>nix derivation show</code> will contain output that looks like the following:</p>
<pre><code class="language-yaml">{
  "/nix/store/n92qrx1j889bl2ippabpghsr4kyqbknh-garden-tools-1.0.0-beta2.drv": {
    # ...
    "outputs": {
      "out": {
        "path": "/nix/store/8i7pgb529lq8id1z4xfmcyh8xsc4w6q0-garden-tools-1.0.0-beta2"
      }
    },
    # ...
  }
}
</code></pre>
<p>You can use these details to open a shell with your previously-built <code>garden</code> package.</p>
<pre><code class="language-bash">nix-shell -p /nix/store/8i7pgb529lq8id1z4xfmcyh8xsc4w6q0-garden-tools-1.0.0-beta2
</code></pre>
<h3 id="nix-home-manager-integration"><a class="header" href="#nix-home-manager-integration">Nix home-manager integration</a></h3>
<p>One may also use <a href="https://github.com/nix-community/home-manager">home-manager</a>
to have a permanent environment with <code>garden</code> available across all shells. This
can be done by setting up a derivation in your home-manager configuration.</p>
<p>Example:</p>
<p>File <code>/path/to/home-manager/derivations/garden.nix</code>:</p>
<pre><code class="language-nix">{ lib, fetchFromGitHub, rustPlatform }:

rustPlatform.buildRustPackage rec {
  pname = "garden";
  version = "v1.8.0";

  src = fetchFromGitHub {
    owner = "garden-rs";
    repo = "garden";
    rev = version;
    hash = "sha256-+hcjHuJvqxkp+5FikVb8+mpU6rObC4xkMj/NBZDYTrQ=";
  };
  cargoHash = "sha256-12X4bMDAQTLZfiPSbY9cPXB8cW1L0zYrts5F5CXzV7Y=";
}
</code></pre>
<blockquote>
<p><strong>Note 1:</strong> hashes hash and cargoHash above are for v1.8.0 specifically. One could set them to <code>lib.fakeHash;</code> let the build fail with the error specifying the right hash, paste the correct hash and rebuild.</p>
</blockquote>
<blockquote>
<p><strong>Note 2:</strong> If tests fail due to missing git in your build environment, one can set this up with doCheck = false.</p>
</blockquote>
<p>you can activate the derivation above in your <code>home.nix</code> with</p>
<p><code>home.nix</code></p>
<pre><code class="language-nix">{ config, pkgs, ... }:
    let garden =  pkgs.callPackage ./derivations/garden.nix {};
in
{
   home.packages = [
       garden
  ]
}
</code></pre>
<p>then run <code>home-manager switch</code> to activate the changes.</p>
<h2 id="windows"><a class="header" href="#windows">Windows</a></h2>
<p>Garden is developed on Linux and supported on macOS and BSDs where Rust is available.
Garden started supporting Windows in <code>v1.10.1</code>.</p>
<p>Garden works on Windows if you install a shell (e.g. <code>bash.exe</code> or <code>zsh.exe</code>) in
your <code>$PATH</code>. Installing <a href="https://gitforwindows.org/">Git for Windows</a> and enabling
the option that adds <code>git.exe</code> and related tools to your <code>$PATH</code> during installation
is the easiest way to satisfy these requirements.</p>
<p>Please note that Garden's support for <code>$PATH</code>-like environment variables may need
attention to improve its behavior on Windows.</p>
<p>Garden currently uses colon (<code>:</code>) delimiters for environment variables whereas Windows
may require semicolon (<code>;</code>) delimiters to be used instead. This behavior has not been
tested so if you are able to test it out then please open an issue so that you can
help sort out this last detail.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-and-usage"><a class="header" href="#setup-and-usage">Setup and Usage</a></h1>
<h2 id="setup"><a class="header" href="#setup">Setup</a></h2>
<p>A garden can be created in any directory. Run <code>garden init</code> to create
an empty "garden.yaml" file for defining trees, groups and gardens.</p>
<pre><code class="language-bash"># Create an empty "garden.yaml" in the current directory.
garden init
</code></pre>
<p>By default, the garden.yaml is configured to operate on trees in the
current directory relative to the garden file. The <code>garden</code> command
searches the current directory for a "garden.yaml" config file.</p>
<p>If no "garden.yaml" could be found in the current directory then <code>garden</code>
will attempt to load a "global" configuration file, typically located in
<code>~/.config/garden/garden.yaml</code>.</p>
<p>The following <code>garden init</code> invocation creates an empty <code>garden.yaml</code> with a
root directory of <code>~/src</code> in the user's home configuration directory. This is
typically <code>~/.config/garden/garden.yaml</code>.</p>
<pre><code class="language-bash">garden init --global --root '~/src'
</code></pre>
<p>This allows you to access the config irrespective of the current directory and
perform garden operations without needing to <code>cd</code> into <code>~/src/</code> to do so.</p>
<p>If multiple configuration files are made available in <code>~/.config/garden</code>, then
using <code>garden -c alt.yaml ...</code> from <em><strong>any</strong></em> directory (without specifying an
absolute path) will use the <code>alt.yaml</code> garden file.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Now that we know how to create a <code>garden.yaml</code> we can start using garden to
track our development repositories.</p>
<p>When we have a <code>~/src/garden.yaml</code> file with Git worktrees alongside it in the
<code>~/src</code> directory then we can start adding those trees to the garden file.
Existing trees are added to a garden file using <code>garden plant &lt;tree&gt;</code>.</p>
<p>Once we have a garden file with trees in it then we can use the garden file to
recreate our setup using <code>garden grow</code>. The <code>garden grow</code> command brings trees
into existence by cloning trees that have been configured in a garden file.</p>
<p>Garden commands are used to operate over sets of trees once a configuration
has been defined. See the <a href="commands.html">Garden Commands Documentation</a> for
detailed information about the built-in garden commands.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tree-queries"><a class="header" href="#tree-queries">Tree Queries</a></h1>
<p>Garden commands use "Tree Query" arguments that specify which groups, gardens or trees
to operate on. Tree Queries are strings that resolve to a set of trees.</p>
<p>Strings with garden, group or tree names, <code>@tree</code> references, <code>%group</code> references,
<code>:garden</code> references and wildcards are all Tree Queries.</p>
<p>When a query is specified, garden will use the first matching garden, group or
tree, in that order, when determining which trees to operate on.  When a
garden or group is matched, all of its associated trees are used.</p>
<h2 id="tree-queries-resolve-to-multiple-trees"><a class="header" href="#tree-queries-resolve-to-multiple-trees">Tree Queries Resolve to Multiple Trees</a></h2>
<p>The "cola" garden in the configuration section contains multiple trees that can be
operated on together by specifying "cola" as the tree query.</p>
<pre><code class="language-bash"># Run "git status -s" over each tree in the "cola" garden.
garden exec cola git status -s
# Run the custom "status" command over each tree in the "cola" garden.
garden status cola
# Run the "status" and "build" commands over each tree in the "cola" garden.
garden cmd cola status build
</code></pre>
<h2 id="wildcards"><a class="header" href="#wildcards">Wildcards</a></h2>
<p>Garden understands shell wildcards in tree queries. Glob wildcards allow commands to
operate on multiple sets of gardens, groups or trees.</p>
<pre><code class="language-bash"># Clone trees whose name starts with "git" and run "pwd" in each tree.
garden grow '@git*'
garden exec '@git*' pwd
</code></pre>
<h2 id="paths"><a class="header" href="#paths">Paths</a></h2>
<p>Paths can be used as a tree query as long as the specified directory refers to a tree
known to Garden. If the path does not correspond to a tree known to garden then no
commands will be run.</p>
<pre><code class="language-bash"># Run "build" on the tree in the current directory and pass "--verbose" to the command.
garden build . -- --verbose
</code></pre>
<p>The file system has the lowest priority relative to gardens, groups, and trees when
expanding a tree query. If an argument is ambiguous and can, for example, refer to both
a "group" name and a single tree's path on the file system, garden will interpret the
argument as a "group".</p>
<p>Please note that <code>garden</code> will use <code>.</code> (dot, the current directory in file system jargon)
as the default tree query for custom commands when no tree query is specified.</p>
<pre><code class="language-bash"># This...
garden build
# is equivalent to specifying "." as the tree query.
garden build .
</code></pre>
<h2 id="resolving-trees-groups-or-gardens-only"><a class="header" href="#resolving-trees-groups-or-gardens-only">Resolving Trees, Groups or Gardens Only</a></h2>
<p>If you have groups, gardens, and trees with the same name then you can use the
<code>@tree</code>, <code>%group</code>, and <code>:garden</code> prefixes to disambiguate the query.</p>
<ul>
<li><em><strong>@tree</strong></em> - values prefixed with <code>@</code> resolve trees only</li>
<li><em><strong>%group</strong></em> - values prefixed with <code>%</code> resolve groups only</li>
<li><em><strong>:garden</strong></em> - values prefixed with <code>:</code> resolve gardens only</li>
</ul>
<pre><code class="language-bash">garden grow @tree      # grow the tree called "tree"
garden grow %group     # grow the group called "group"
garden grow :garden    # grow the garden called "garden"
</code></pre>
<p>When no prefixes are used then the names are resolved in a specific order.
Gardens have the highest priority, followed by groups, trees and lastly paths.</p>
<p>If your trees, groups and gardens are named uniquely then you will rarely need to
use prefixes in your tree queries.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="commands"><a class="header" href="#commands">Commands</a></h1>
<p>Garden includes a set of built-in commands and can be flexibly extended
with user-defined commands. User-defined commands are one Garden's most
useful features.</p>
<h2 id="command-line-conventions"><a class="header" href="#command-line-conventions">Command-Line Conventions</a></h2>
<p>Run <code>garden help</code> to display usage information for garden commands.
The usage information is where the command-line options are documented.</p>
<pre><code class="language-bash">garden help
garden help &lt;command&gt;
garden &lt;command&gt; --help
</code></pre>
<p>Built-in commands use this basic syntax:</p>
<pre><code>garden [options] &lt;command&gt; [command-options] [command-arguments]*
</code></pre>
<p>The following options come before <code>&lt;command&gt;</code> and are common to all commands.</p>
<pre><code>-C | --chdir &lt;directory&gt;
</code></pre>
<p>Navigate to the specified directory before searching for configuration.
This is modeled after <code>make -C &lt;path&gt; ...</code> or <code>git -C &lt;path&gt; ...</code>.</p>
<pre><code>-c | --config &lt;filename&gt;
</code></pre>
<p>Specify a garden file to use instead of searching for <code>garden.yaml</code>.
The filename can be either the path to a file or the basename of a file in the
configuration search path.</p>
<pre><code>-v | --verbose
</code></pre>
<p>Enable verbose debugging output.</p>
<pre><code>-D | --define name=value
</code></pre>
<p>Override a configured variable by passing a <code>name=value</code> string to
the <code>-D | --define</code> option.  The variable named <code>name</code> will be updated with the
garden expression <code>value</code>.  Multiple variables can be set by specifying the
flag multiple times.</p>
<h2 id="garden-init"><a class="header" href="#garden-init">garden init</a></h2>
<pre><code class="language-bash">garden init [options] [&lt;filename&gt;]

# create a local garden config rooted at the current directory
garden init

# create a global garden config rooted at ~/src
garden init --global --root '~/src'
</code></pre>
<p>The init command will create an empty Garden YAML file with the minimal
boilerplate to start using garden. If no <code>&lt;filename&gt;</code> is specified,
<code>garden.yaml</code> in the current directory will be written.</p>
<p>The Garden file is written to the user's <code>~/.config/garden/</code> global configuration
directory when <code>--global</code> is specified.</p>
<p>This command is typically run without specifying a filename.
<code>garden init</code> typically creates a <code>garden.yaml</code> in the current directory:</p>
<pre><code>current-directory/
└── garden.yaml
</code></pre>
<p>If the current directory contains a Git repository then it will be added to
the <code>trees</code> block automatically. Use <code>garden init --empty</code> to disable this behavior.</p>
<h2 id="garden-plant"><a class="header" href="#garden-plant">garden plant</a></h2>
<pre><code class="language-bash">garden plant &lt;tree&gt;
</code></pre>
<p>Add a pre-existing Git worktree to <code>garden.yaml</code>.</p>
<p>The <code>trees</code> section in the <code>garden.yaml</code> file will be updated with details
about the new tree.</p>
<p><code>garden plant</code> records the Git remotes associated with a repository.
It is safe to re-run <code>garden plant</code> in order to add new remotes to
an existing configuration.</p>
<p>Repositories created using <code>git worktree</code> are supported by <code>garden plant</code>.
Parent trees must be planted first before planting a child tree.</p>
<p>Use the <code>--sort</code> option to sort all of the <code>trees</code> entries after planting.</p>
<h2 id="garden--tree-query"><a class="header" href="#garden--tree-query">garden ... [tree-query]</a></h2>
<p>Garden commands accept <a href="tree-queries.html">tree query</a> strings that are used to
refer to sets of trees.</p>
<p>Tree queries are glob string patterns that can be used to match the gardens,
groups or trees defined in "garden.yaml".</p>
<h2 id="garden-grow"><a class="header" href="#garden-grow">garden grow</a></h2>
<pre><code class="language-bash">garden grow &lt;tree-query&gt;

# Example usage
garden grow cola
</code></pre>
<p>If you have a <code>garden.yaml</code> file, either one that you authored yourself or
one that was provided to you, then you will need to grow the Git trees
into existence.</p>
<p>The <code>grow</code> sub-command updates or creates the trees matched by the <code>&lt;tree-query&gt;</code>
and places them into the paths defined by the garden file.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern for filtering trees by
name post-query. This lets you filter a tree query so that only a subset of the
trees in the query are grown.</p>
<p>It is safe to re-run the <code>grow</code> command and re-grow a tree.  Existing trees will
have their git configuration updated to match the configured remotes.  Missing
repositories are created by cloning the configured tree URL.</p>
<h3 id="branches"><a class="header" href="#branches">Branches</a></h3>
<p>The <code>branch: &lt;branch-name&gt;</code> tree variable is used to specify which branch should be
cloned and checked out when the tree is grown.</p>
<pre><code class="language-yaml">trees:
  example:
    branch: dev
    url: git@example.org:trees/example.git
</code></pre>
<p><code>garden grow example</code> clones the repository using <code>git clone --branch=dev</code>.
The <code>branch</code> setting is a tree variable and supports <code>${variable}</code> expressions.</p>
<h3 id="shallow-clones"><a class="header" href="#shallow-clones">Shallow Clones</a></h3>
<p>The <code>depth: &lt;integer&gt;</code> tree parameter is used to create shallow clones.</p>
<pre><code class="language-yaml">trees:
  example:
    depth: 42
    url: git@example.org:trees/example.git
</code></pre>
<p><code>garden grow example</code> clones the repository using:</p>
<pre><code class="language-bash">git clone --depth=42 --no-single-branch
</code></pre>
<p>Even though a shallow clone is created, all of the remote tracking branches
(e.g. <code>origin/*</code>) are available because we clone the repository using
the <code>--no-single-branch</code> option.</p>
<p>The <code>single-branch: true</code> tree parameter is used to create clones that contain
a single branch only. This is useful if you want to limit the on-disk footprint
of repositories by only having a single branch available.</p>
<p>This par mater is typically used in conjunction with <code>branch: &lt;branch-name&gt;</code> and
<code>depth: 1</code> to create a 1-commit shallow clone with a single branch.</p>
<pre><code class="language-yaml">trees:
  example:
    branch: dev
    depth: 1
    single-branch: true
    url: git@example.org:trees/example.git
</code></pre>
<h3 id="wildcards-1"><a class="header" href="#wildcards-1">Wildcards</a></h3>
<p>Wildcards are supported in the trees queries supported by <code>garden grow</code>.
<code>garden grow 'glob*'</code> grows the gardens, groups or trees that start with "glob".</p>
<p>If <code>garden.yaml</code> contains <code>gardens</code> whose name matches the query then the trees
associated with each garden are grown.</p>
<p>If no gardens are found then garden will search for "groups" that match
the query. If groups are found then the trees within each group will be grown.</p>
<p>If no gardens and no groups are found then will garden search for trees and grow
those whose names match the query string.</p>
<h3 id="worktrees"><a class="header" href="#worktrees">Worktrees</a></h3>
<p><code>garden grow</code> can be used to create worktrees that share their <code>.git</code> storage
using <a href="https://git-scm.com/docs/git-worktree">git worktree</a>.</p>
<p>To create shared storage, define the primary worktree where the <code>.git</code>
storage will reside and then define additional trees that reference the
worktrees.</p>
<pre><code class="language-yaml">trees:
  example/main: git@example.org:trees/example.git

  example/dev:
    worktree: example/main
    branch: dev

  example/v2:
    worktree: example/main
    branch: v2
</code></pre>
<p>This example uses <code>example/main</code> tree for the shared storage and two additional worktrees.
<code>example/dev</code> uses the <code>dev</code> branch and <code>example/v2</code> uses the <code>v2</code> branch.</p>
<h3 id="upstream-branches"><a class="header" href="#upstream-branches">Upstream Branches</a></h3>
<p>Remote tracking branches can be configured by defining a <code>branches</code> block that maps
local branch names (the <code>key</code>) to a remote branch name expression (the <code>value</code>).</p>
<pre><code class="language-yaml">trees:
  example/branches:
    branch: local
    branches:
      local: origin/dev
      dev: origin/dev
</code></pre>
<p>The above configuration creates local branches called <code>local</code> and <code>dev</code> and checks out
the <code>local</code> branch when <code>garden grow example/branches</code> is run.</p>
<h3 id="git-configuration-values"><a class="header" href="#git-configuration-values">Git Configuration Values</a></h3>
<p>The <code>garden grow</code> command will apply git configuration values that are
specified using the <code>gitconfig</code> key.</p>
<pre><code class="language-yaml">trees:
  foo:
    gitconfig:
      # Override the submodule URL for "thirdparty/repo".
      submodule.thirdparty/repo.url: "git@private.example.com:thirdparty/repo.git"
</code></pre>
<p>Multi-valued <code>git config --add</code> values are also supported, for example
the <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-remoteltnamegtpushurl">remote.$name.pushurl</a>
value can be set to multiple values.</p>
<p>Use a list as the value for the key and multiple values will be added using
<a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt---add">git config --add $name $value</a>.</p>
<pre><code class="language-yaml">trees:
  foo:
    url: "git@example.org:trees/foo.git"
    gitconfig:
      remote.origin.pushurl:
        # Push to multiple remotes when using "git push origin"
        - "git@jupiter.example.org:trees/foo.git"
        - "git@saturn.example.org:trees/foo.git"
</code></pre>
<h3 id="bare-repositories"><a class="header" href="#bare-repositories">Bare Repositories</a></h3>
<p>To clone bare repositories use <code>bare: true</code> in the tree configuration.</p>
<pre><code class="language-yaml">trees:
  example:
    bare: true
    url: url
</code></pre>
<p>Bare clones are created by default when the tree path ends in <code>.git</code>.
For example, a tree called <code>example.git</code> will be <code>bare: true</code> by default.</p>
<pre><code class="language-yaml">trees:
  example.git: git@example.org:trees/example.git
</code></pre>
<p>Setting <code>bare: false</code> overrides the name-based detection of bare repositories.</p>
<pre><code class="language-yaml">trees:
  example.git:
    bare: false
    url: git@example.org:tree/example.git
</code></pre>
<h2 id="garden-cmd"><a class="header" href="#garden-cmd">garden cmd</a></h2>
<pre><code class="language-bash">garden cmd &lt;tree-query&gt; &lt;command&gt; [&lt;command&gt;]... [-- &lt;arguments&gt;..]

# Example usage
garden cmd cola build test -- V=1
</code></pre>
<p>Run one or more user-defined commands over the gardens, groups or trees
that match the specified tree query.</p>
<p>The example above runs the <code>build</code> and <code>test</code> commands in all of the trees
that are part of the <code>cola</code> garden.</p>
<h3 id="commands-1"><a class="header" href="#commands-1">Commands</a></h3>
<p><code>garden cmd</code> and <code>garden &lt;command&gt;</code> interact with custom commands that are
configured in the <code>commands</code> section for templates, trees, gardens,
and the top-level scope.</p>
<pre><code class="language-bash"># Example usage

# Run the test" command in the cola and vx trees
garden test git-cola vx

# Use "--" to forward arguments to the custom commands
garden test git-cola -- --verbose

# Print what would get run without running anything
garden test --dry-run -vv git-cola
</code></pre>
<p>Custom commands can be defined at either the tree or garden scope.
Commands defined at the garden scope extend commands defined on a tree.
If both a tree and the garden containing that tree defines a command called
<code>test</code> then <code>garden test</code> will first run the tree's <code>test</code> command followed
by the garden's <code>test</code> command.</p>
<p>Commands are executed in a shell so that shell expressions can be used in commands.
A POSIX-compatible shell must be installed in your <code>$PATH</code>.</p>
<p>Additional command-line <code>&lt;arguments&gt;</code> specified after a double-dash (<code>--</code>)
end-of-options marker are forwarded to each command.</p>
<p><code>"$0"</code> in a custom command points to the current garden executable and can be
used to rerun garden from within a garden command.</p>
<p>Additional arguments are available to command strings by using the traditional
<code>"$@"</code> shell syntax.  When additional arguments are present <code>"$1"</code>, <code>"$2"</code>, and
subsequent variables will be set according to each argument.</p>
<p>The <code>-N | --dry-run</code> option performs a trial run without running any commands.
Combine this option with the <code>-vv</code> extra-verbose mode to print the commands that
would be run without running them.</p>
<pre><code class="language-yaml"># Commands can be defined in multiple ways.
# Strings and lists of strings are both supported via "String to List Promotion".
# The YAML reader accepts multi-line strings using the "|" pipe syntax.

commands:
  one-line: echo hello "$@"
  multi-line: |
    if test "${debian}" = "yes"
    then
        sudo apt install rust-all
    fi
  multiple-commands:
    - echo a $1 ${name}
    - |
        echo b $3
        echo c $4

variables:
  debian: $ type apt-get &gt;/dev/null &amp;&amp; echo yes || echo no
  name: value

# Commands can also be defined at tree and garden scope
trees:
  our-tree:
    commands:
      tree-cmd: echo ${TREE_NAME}

gardens:
  all:
    trees: "*"
    commands:
      print-pwd: pwd
</code></pre>
<h4 id="forwarding-arguments-using-the-double-dash----end-of-options-marker"><a class="header" href="#forwarding-arguments-using-the-double-dash----end-of-options-marker">Forwarding arguments using the double-dash <code>--</code> end-of-options marker</a></h4>
<p>Use <code>--</code> (double-dash) to forward arguments to custom commands.
Everything specified after <code>--</code> on the command-line will be present in the <code>"$@"</code> array.</p>
<pre><code class="language-yaml">commands:
  test: cargo test -v "$@"
</code></pre>
<p>If the wrapped command also uses <code>--</code> then you have to specify <code>--</code> twice in order for
the inner command to see a <code>--</code> marker.</p>
<p>The <code>cargo test</code> command uses <code>--</code> in order to pass options to the inner test commands.
To pass options to the inner test command we'd have to use <code>--</code> twice.</p>
<pre><code class="language-bash">garden test -- -- --list
# Runs "cargo test -v -- --list". The first "--" is consumed by "garden".
</code></pre>
<p>If you always pass arguments to inner commands after their <code>--</code> marker then
you can simplify the command's usage by embedding <code>--</code> into the command definition.</p>
<pre><code class="language-yaml">commands:
  test: cargo test -v -- "$@"
</code></pre>
<p>Using <code>--</code> in the command lets us use a single <code>--</code> to pass arguments to the innermost
tests instead of two.</p>
<pre><code class="language-bash">garden test -- --list
# Runs "cargo test -v -- --list".
</code></pre>
<h4 id="shebang--commands"><a class="header" href="#shebang--commands">Shebang (#!) Commands</a></h4>
<p>Custom command shells can be used on a per-command basis by using a <code>#!&lt;command&gt;</code>
shebang line as the start of a multi-line command.</p>
<p>The command specified in the <code>#!</code> shebang line <em>must</em> accept a command string as the
next argument to the specified command.</p>
<pre><code class="language-yaml">commands:
  python-cmd: |
    #!python3 -c
    import sys
    print(sys.implementation)
</code></pre>
<p>Using <code>#!python3 -c</code> as the shebang line, as demonstrated above in the <code>python-cmd</code>
command, will result in the remainder of the command getting passed as the next argument.</p>
<p>Concretely, <code>garden</code> will run <code>python3 -c "import sys\nprint(sys.implementation)"</code> when
the <code>garden python-cmd</code> command is run.</p>
<h4 id="parallel-execution"><a class="header" href="#parallel-execution">Parallel Execution</a></h4>
<p>By default, <code>garden</code> runs commands sequentially, one command and tree after another.</p>
<p><code>garden cmd &lt;tree-query&gt; &lt;command&gt;...</code> and <code>garden &lt;command&gt; [&lt;tree-query&gt;...]</code>
are able execute commands in parallel by using the <code>-j# | --jobs #</code> option.</p>
<p>Using the <code>-j# | --jobs=#</code> option makes <code>garden</code> use the specified number of cores when
running commands in parallel.</p>
<p>Passing the value zero (<code>-j0 | --jobs 0</code>) to this option tells <code>garden</code> to detect and
use all available cores. When <code>-j | --jobs</code> is the last option on the command line you
can omit the numeric value and <code>garden</code> will treat it as if <code>0</code> was specified and use
all cores.</p>
<pre><code class="language-bash">garden test '@*' -j
garden test --jobs=0 '@*'
</code></pre>
<p>The commands above run the custom <code>test</code> command over all trees, in parallel, using all
cores as detected at runtime.</p>
<p>Similarly, <code>garden cmd '@*' test -j</code> has the same behavior -- all trees are visited
and operated on concurrently.</p>
<p>When multiple commands are specified, e.g. <code>garden cmd '@*' a b c -j</code>, then <code>garden</code>
will run commands <code>a</code>, <code>b</code> and <code>c</code> in order, one after another, over all trees in parallel.</p>
<p><code>garden</code> can also be made to visit each tree sequentially while running the <code>a</code>, <code>b</code> and <code>c</code>
commands in parallel as each tree is visited.</p>
<p>The <code>-b | --breadth-first</code> option enables this behavior.</p>
<pre><code class="language-bash">garden cmd -b '@*' a b c -j
</code></pre>
<p>The command above visits each tree sequentially and executes <code>a</code>, <code>b</code>, and <code>c</code>
in parallel on each tree. The next tree is visited as soon as all three <code>a</code>, <code>b</code>,
and <code>c</code> commands complete.</p>
<p>Parallel execution does not effect the ordering of pre and post-commands.
Pre and post-commands run sequentially, in-order, relative to their associated
command irrespective of the parallel execution mode.</p>
<h3 id="garden-shell"><a class="header" href="#garden-shell">Garden Shell</a></h3>
<p>The <code>garden.shell</code> configuration value controls which shell interpreter
is used to interpret custom commands.</p>
<pre><code class="language-yaml">garden:
  shell: zsh  # zsh is used by default when available. Uses bash, dash or sh otherwise.
  shell-wordsplit: true  # Words are split by default in zsh using "zsh -o shwordsplit"
  shell-errexit: true  # Non-zero exit status stops execution using "zsh -e".
</code></pre>
<p><code>garden.shell</code> defaults to <code>zsh</code> when <code>zsh</code> is installed but can be set to any shell
that accepts <code>-e</code> and <code>-c &lt;string&gt;</code> options (for example <code>ksh</code>).
If <code>zsh</code> is not installed then <code>bash</code> or <code>dash</code> will be used instead.
If neither <code>zsh</code>, <code>bash</code> nor <code>dash</code> is installed then <code>sh</code> will be used.</p>
<p>Each command runs under <code>["zsh", "-e", "-c", "&lt;command&gt;"]</code> with the resolved
environment from the corresponding garden, group, or tree.</p>
<p>Multi-line and multi-statement command strings will stop executing as soon as the
first non-zero exit code is encountered due to the use of the <code>-e</code> shell option.
Use the <code>-n | --no-errexit</code> option to inhibit the use of the <code>-e</code> "errexit" option.</p>
<p>The <code>--no-errexit</code> option causes commands with multiple statements to run to completion
even when a non-zero exit code is encountered. This is akin to a regular shell script.</p>
<p>Configure <code>garden.shell-errexit</code> to <code>false</code> in <code>garden.yaml</code> to opt-out of this behavior.
You can also opt-out of the <code>errexit</code> behavior on a per-command basis by using
<code>set +e</code> as the first line of a multi-line command.</p>
<p>When <code>zsh</code> is used it is executed with the <code>-o shwordsplit</code> option so that zsh behaves
similarly to traditional shells by splitting words in unquoted <code>$variable</code> expressions
rather than treating <code>$variable</code> like a single argument.</p>
<p>Configure <code>garden.shell-wordsplit</code> to <code>false</code> to opt-out of this behavior.
You can also opt-out of the <code>shwordsplit</code> behavior on a per-command basis by using
<code>set +o shwordsplit</code> as the first line of a multi-line command.</p>
<h4 id="builtin-shells"><a class="header" href="#builtin-shells">Builtin Shells</a></h4>
<p>The following values for <code>garden.shell</code> are understood directly by <code>garden</code> and
the following commands are used when <code>garden</code> detects that these shells are
configured. Not applicable (N/A) is denoted by <code>-</code>.</p>
<div class="table-wrapper"><table><thead><tr><th>garden.shell</th><th>Command used for running commands</th><th>errexit=false</th><th>wordsplit=false</th></tr></thead><tbody>
<tr><td><code>bun</code></td><td><code>bun -e</code></td><td>-</td><td>-</td></tr>
<tr><td><code>bash</code></td><td><code>bash -e -c</code></td><td>Omit <code>-e</code></td><td>-</td></tr>
<tr><td><code>dash</code></td><td><code>dash -e -c</code></td><td>Omit <code>-e</code></td><td>-</td></tr>
<tr><td><code>ksh</code></td><td><code>ksh -e -c</code></td><td>Omit <code>-e</code></td><td>-</td></tr>
<tr><td><code>node</code></td><td><code>node -e</code></td><td>-</td><td>-</td></tr>
<tr><td><code>nodejs</code></td><td><code>nodejs -e</code></td><td>-</td><td>-</td></tr>
<tr><td><code>perl</code></td><td><code>perl -e</code></td><td>-</td><td>-</td></tr>
<tr><td><code>ruby</code></td><td><code>ruby -e</code></td><td>-</td><td>-</td></tr>
<tr><td><code>sh</code></td><td><code>sh -e -c</code></td><td>Omit <code>-e</code></td><td>-</td></tr>
<tr><td><code>zsh</code></td><td><code>zsh -o shwordsplit +o nomatch -e -c</code></td><td>Omit <code>-e</code></td><td>Omit <code>-o shwordsplit</code></td></tr>
</tbody></table>
</div>
<p>The following shells are not builtin, but they work as expected because they accept
<code>-c &lt;string&gt;</code> arguments for running command strings.</p>
<div class="table-wrapper"><table><thead><tr><th>garden.shell</th><th>Command used for running commands</th></tr></thead><tbody>
<tr><td><code>fish</code></td><td><code>fish -c</code></td></tr>
<tr><td><code>python3</code></td><td><code>python3 -c</code></td></tr>
</tbody></table>
</div>
<h4 id="custom-command-interpreters"><a class="header" href="#custom-command-interpreters">Custom Command Interpreters</a></h4>
<p>The command used in <code>garden.shell</code> must specify a command that takes a string to
execute using the <code>-c &lt;string&gt;</code> option. Some commands take <code>-e &lt;string&gt;</code> instead,
namely <code>nodejs</code>, <code>perl</code> and <code>ruby</code>, which are all understood by <code>garden</code> and
are expanded into their corresponding command-line.</p>
<p>This allows you to specify <code>python3</code> as the shell because <code>garden</code> assumes that
it can call <code>python3 -c &lt;string&gt;</code> to execute commands.</p>
<pre><code class="language-yaml"># This uses "python -c &lt;string&gt;" to run commands.
garden:
  shell: python3
commands:
  hello: print('hello world')
  info: |
    import platform
    print(platform.platform())

# Builtin shorthand shell values are special-cased internally.
# This uses "zsh -o shwordsplit -e -c &lt;string&gt;" to run commands.
garden:
  shell: zsh

# This uses "bash -e -c &lt;string&gt;" to run commands.
garden:
  shell: bash

# Use "#!" shebang lines to use a custom interpreters for a command.
commands:
  info: |
    #!python3 -c
    import platform
    print(platform.platform())
</code></pre>
<p><code>garden.shell</code> also allows you to completely override the command used for interpreting
custom commands. When you specify a command line with multiple arguments then <code>garden</code>
will no longer internally manage the command-line options passed to the shell command.
The options that you specify will be used instead. You must specify <code>-c</code> or similar
arguments yourself when <code>garden</code> is configured with a custom command.
The <code>garden.shell-wordsplit</code> and <code>garden.shell-errexit</code> options have no effect
when using custom shell commands.</p>
<pre><code class="language-yaml"># Use "zsh -c" directly without "-o shwordsplit" and "-e".
garden:
  shell: zsh -c

# Additional examples.
garden:
  shell: python3 -s -u -c
</code></pre>
<h3 id="shell-syntax"><a class="header" href="#shell-syntax">Shell Syntax</a></h3>
<p>User-defined Commands and Exec Expressions are evaluated by the shell configured
in the <code>garden.shell</code> configuration value.</p>
<p>Garden and Shells share a key piece of common syntax: the interpolated braced
<code>${variable}</code> syntax.</p>
<p>Garden Variables that use the <code>${variable}</code> syntax are evaluated by
<code>garden</code> first before the shell has evaluated them.</p>
<p>This means that the shell syntax supported by Garden's Exec Expressions is
a subset of the full syntax because shell-only variables such as <code>${OSTYPE}</code> cannot
be accessed using the braced-variable syntax.</p>
<pre><code class="language-yaml">commands:
  example-command: |
    shell_variable=$(date +%s)
    echo hello $OSTYPE $shell_variable
</code></pre>
<p>The plain <code>$variable</code> syntax is reserved for use by the shell commands used in
user-defined Commands and Exec Expressions.</p>
<p>Environment Variables can be used in shell scriptlets through both the <code>$ENV</code> and
<code>${ENV}</code> braced variable syntax. Garden makes all environment variables available during
variable expansion.</p>
<p>The distinction between the <code>${garden}</code> and <code>$shell</code> syntax is only relevant when
using variables defined within shell command, such as <code>$shell_variable</code> above.</p>
<p>If the <code>${shell_variable}</code> syntax were to be used in the <code>example-command</code> then an
empty value would have been used instead of the output of <code>date +%s</code>.</p>
<p>Sometimes it is necessary to actually use the <code>${...}</code> braced literal syntax
in shell commands. The <code>$${...}</code> braced double-dollar syntax can be used to
escape a braced value and disable evaluation by <code>garden</code>.</p>
<p>Double-<code>$</code> can generally be used to escape literal <code>$</code> values in commands, but
escaping is handled automatically for regular <code>$shell</code> variables.</p>
<h3 id="tree-traversal-order"><a class="header" href="#tree-traversal-order">Tree Traversal Order</a></h3>
<p>Garden traverses trees in the same order that appear in the <code>gardens</code>, <code>groups</code>,
and <code>trees</code> blocks in your <code>garden.yaml</code> files. You can affect the order that trees and
commands are traversed by ordering the entries in the Garden file accordingly.</p>
<h3 id="depth-first-and-breadth-first-tree-traversal"><a class="header" href="#depth-first-and-breadth-first-tree-traversal">Depth-first and Breadth-first Tree Traversal</a></h3>
<p>The following two invocations run commands in a different order:</p>
<pre><code class="language-bash"># Depth-first (default)
garden cmd treesitters build test

# Breadth-first
garden cmd --breadth-first treesitters build test
</code></pre>
<p>The default traversal order for commands is depth-first. This means that <em>both</em> the
<code>build</code> and <code>test</code> commands are run on each tree in the <code>treesitters</code> group
<em>before</em> running any commands on the next tree.</p>
<p>The <code>-b | --breadth-first</code> option enables a breadth-first traversal. A breadth-first
traversal runs the <code>build</code> command over <em>all</em> of the trees in the <code>treesitters</code> group
<em>before</em> the <code>test</code> command is run over all of the trees in the same group.</p>
<h3 id="custom-commands"><a class="header" href="#custom-commands">Custom Commands</a></h3>
<pre><code class="language-bash">garden &lt;command&gt; &lt;query&gt; [&lt;query&gt;]* [-- &lt;arguments&gt;...]

# Example usage
garden status @git-cola .
garden build cola/next
</code></pre>
<p><code>garden &lt;command&gt;</code> is another way to execute a user-defined <code>&lt;command&gt;</code>.
This form allows you to specify multiple queries rather than multiple commands.</p>
<p>When no builtin command exists by the specified name then garden will
use custom commands defined in a <code>commands</code> block at the corresponding
garden or tree scope.</p>
<p><code>garden &lt;command&gt; [&lt;query&gt;...]</code> is complementary to <code>garden cmd &lt;query&gt; &lt;command&gt;...</code>.</p>
<p><code>garden cmd &lt;query&gt; &lt;command&gt;...</code> runs multiple commands over a single query.</p>
<p><code>garden &lt;command&gt; [&lt;query&gt;...]</code> runs a single command over multiple queries.</p>
<p>For example, <code>garden build treesitters catsitters</code> will run a user-defined <code>build</code>
command over both the <code>treesitters</code>  and <code>catsitters</code> groups.</p>
<p>Use the <code>garden -vv</code> extra-verbose option to display the commands being run.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern to filter trees by name
post-query. Commands will only be run inside trees whose names match the pattern.
This lets you activate a garden and its environment variables while only running
a commands against a subset of trees in that garden.</p>
<h3 id="pre-and-post-commands"><a class="header" href="#pre-and-post-commands">Pre and Post Commands</a></h3>
<p>Commands can specify references to other commands that should be run before and/or after
a command.</p>
<ul>
<li>
<p>Pre-commands are run before the command.</p>
</li>
<li>
<p>Pre-commands use a <code>&lt;</code> suffix with values that specify the names of other commands to
run before the command.</p>
</li>
<li>
<p>Post-commands are run after the command.</p>
</li>
<li>
<p>Post-commands use a <code>&gt;</code> suffix with values that specify the names of other commands to
run after the command.</p>
</li>
<li>
<p>Pre-commands and post-commands can only refer to other custom commands.</p>
</li>
</ul>
<pre><code class="language-yaml">commands:
  custom-cmd: echo custom-cmd
  custom-cmd&lt;: pre
  custom-cmd&gt;:
    - post1
    - post2
  pre: echo before
  post1: echo after1
  post2: echo after2
</code></pre>
<p>Running <code>garden custom-cmd</code> with the above configuration runs the following commands:</p>
<pre><code># pre
echo before

# custom-cmd
echo custom-cmd

# post1
echo after1

# post2
echo after2
</code></pre>
<h3 id="missing-trees"><a class="header" href="#missing-trees">Missing Trees</a></h3>
<p><code>garden</code> skips missing trees when running custom commands by default.</p>
<p>This means that if a tree has not yet been grown then <code>garden</code> will not visit it when
running custom commands. Missing trees are silently ignored and skipped.</p>
<p>Use <code>garden --verbose &lt;command&gt; ...</code> to instruct <code>garden</code> to print information about
missing trees when it skips them. Missing trees are annotated with a <code>(skipped)</code> message.</p>
<p>Using <code>mkdir</code> to create the tree's directory is all that's needed to get <code>garden</code> to run
commands in those trees.</p>
<p>Alternatively, use the <code>-f | --force</code> option when running custom commands to get
<code>garden</code> to run custom commands on missing trees. The <code>--force</code> option only affects the
behavior of custom commands when they operate on missing trees.</p>
<p>Since the tree's directory does not exist the current working directory when running
commands on missing trees using <code>--force</code> will be different.</p>
<p>Using <code>garden &lt;command&gt; --force &lt;query&gt;</code> to run commands on missing trees will use the
<code>${GARDEN_ROOT}</code> directory (<code>garden.root</code>) instead of the tree's <code>${TREE_PATH}</code>
directory as the current working directory when commands are run.</p>
<h2 id="garden-exec"><a class="header" href="#garden-exec">garden exec</a></h2>
<pre><code class="language-bash">garden exec &lt;tree-query&gt; &lt;command&gt; [&lt;arguments&gt;]*

# example
garden exec cola git status -s
garden exec -j0 cola git status -s
</code></pre>
<p>Run commands over the trees, groups or gardens matched by tree query.
When the <code>&lt;tree-query&gt;</code> resolves to a garden then the environment
is configured for the command using the environment variables and
custom commands from both the tree and the garden.</p>
<p>Use the <code>garden -vv</code> extra-verbose option to display the command being run.</p>
<p>Use the <code>-N | --dry-run</code> option to perform a trial run without running any commands.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern to filter trees by name
post-query. Commands will only be run inside trees whose names match the pattern.
This lets you activate a garden and its environment variables while only running
the <code>&lt;command&gt;</code> against a subset of trees in that garden.</p>
<p>Use the <code>-j# | --jobs=#</code> option to enable parallel execution of commands limited to
the specified number of cores. Trees will be visited in parallel and the command will be
executed concurrently in each tree.</p>
<p>Set the jobs value to zero <code>-j0 | --jobs=0</code> to use all available cores.</p>
<h2 id="garden-eval"><a class="header" href="#garden-eval">garden eval</a></h2>
<pre><code class="language-bash">garden eval &lt;expression&gt; [&lt;tree&gt;] [&lt;garden&gt;]

# example
garden eval '${GARDEN_ROOT}'
garden eval '${TREE_PATH}' cola
</code></pre>
<p>Evaluate a Garden Expression in the specified tree context and output
the result to stdout.</p>
<p>Garden Expressions are <code>strings-with-${variables}</code> that get substituted
and resolved using garden's <code>variables</code> and <code>environment</code> blocks.</p>
<p>If no tree is given then the variable scope includes the top-level variables
block only.</p>
<p>When a tree is given then its variables are considered as well.</p>
<p>When a garden is specified then the garden's variables are also available for
evaluation.</p>
<h2 id="garden-gui"><a class="header" href="#garden-gui">garden gui</a></h2>
<pre><code>garden gui [&lt;query&gt;...]

# example
garden gui
</code></pre>
<p>Garden has a graphical user interface for running command and queries.
<code>garden-gui</code> is provided by a separate crate:</p>
<pre><code class="language-bash">cargo install garden-gui
</code></pre>
<p>The top-most search bar allows you to input Tree Queries and see the set of trees that
the query would find.</p>
<p>Custom commands are displayed in a grid of buttons. The contents of each command can be
seen by right-clicking a command button.</p>
<p>Clicking on a command button will run that command against the current query.</p>
<h2 id="garden-shell-1"><a class="header" href="#garden-shell-1">garden shell</a></h2>
<pre><code>garden shell &lt;tree-query&gt; [&lt;tree&gt;]

# example
garden shell cola
</code></pre>
<p>Launch a shell inside the environment synthesized by the tree query.
If <code>&lt;tree&gt;</code> is specified then the current directory will be set to the
tree's directory.</p>
<p>If the resolved tree query contains a tree whose name exactly matches the
query string then that tree's directory will be used when opening the shell.
The optional tree argument is not needed for the case where a garden
and tree share a name -- garden will chdir into that same-named tree when
creating the shell.</p>
<p>If you would like to customize the command to use for <code>garden shell</code> then
you can configure <code>garden.interactive-shell</code>. This value overrides <code>garden.shell</code>
and is only used by the <code>garden shell</code> command.</p>
<pre><code class="language-yaml"># Launch a fish login shell for "garden shell".
garden:
  interactive-shell: fish
</code></pre>
<p>Arbitrary command interpreters can be specified.</p>
<pre><code class="language-yaml"># Launch a python interpreter for "garden shell".
garden:
  interactive-shell: python3 -B
</code></pre>
<h2 id="garden-ls"><a class="header" href="#garden-ls">garden ls</a></h2>
<pre><code>garden ls [options] [&lt;tree-query&gt;...]
</code></pre>
<p>Display configured information about trees and commands.
Tree details are not displayed for missing / ungrown trees.</p>
<p>Use the <code>-a | --all</code> option to display details for missing trees.</p>
<p>If no tree-queries are specified then <code>garden ls</code> behaves as if
<code>garden ls '@*'</code> were specified, which displays all trees.</p>
<p>Use the <code>-t | --trees</code> option to specify a glob pattern that can be used to
filter trees by name post-query. This is useful when you want to list details
about a group or garden while only listing details about a subset of the trees.</p>
<h2 id="garden-prune"><a class="header" href="#garden-prune">garden prune</a></h2>
<pre><code>garden prune [options] [&lt;subdirs&gt;...]
</code></pre>
<p>Traverse the filesystem and interactively delete any repositories that are
not referenced by the garden file.</p>
<p>This command is intended to cleanup a garden-managed directory. Its intended
usage is to delete repositories that were created (e.g. via <code>garden grow</code>) and
have since been removed from your version-controlled garden configuration.</p>
<p><strong>Warning</strong>: <code>garden prune</code> is a dangerous command and must be run with care.
<code>garden prune</code> deletes repositories and all of their files (including the <code>.git</code> storage)!</p>
<p>The following options are supported by <code>garden prune</code>.</p>
<h2 id="enable-deletions"><a class="header" href="#enable-deletions">Enable deletions</a></h2>
<pre><code>--rm
</code></pre>
<p>The <code>garden prune</code> command uses a no-op "safe mode" which does not actually
delete repositories by default. Deletions must be enabled by specifying the
<code>--rm</code> option.</p>
<p>Use the <code>--rm</code> option only after you have verified that <code>garden prune</code> is not
going to delete any unexpected repositories that you intended to keep.</p>
<h2 id="limit-concurrency"><a class="header" href="#limit-concurrency">Limit concurrency</a></h2>
<pre><code>--jobs &lt;jobs&gt;
</code></pre>
<p>The prune process runs in parallel across multiple cores. All cores are used by default.
The <code>--jobs</code> option limits the number of cores to the specified number of jobs.</p>
<h2 id="limit-filesystem-traversal-depth"><a class="header" href="#limit-filesystem-traversal-depth">Limit filesystem traversal depth</a></h2>
<pre><code>--min-depth &lt;minimum-depth&gt;
--max-depth &lt;maximum-depth&gt;
--exact-depth &lt;exact-depth&gt;
</code></pre>
<p>The cleanup process can be limited to specific traversal depths. The filesystem is
traversed with no limits by default.</p>
<p>Specifying a minimum depth will not remove repositories shallower than the specified
depth. For example, <code>--min-depth 1</code> will not remove repositories in the same directory
as the garden file.</p>
<p>Specifying a maximum depth will not remove repositories deeper than the specified
depth. For example, <code>--max-depth 0</code> will not remove repositories in subdirectories
below the directory containing the garden file.</p>
<h2 id="enable-scripted-usage-by-answering-yes-to-all-prompts"><a class="header" href="#enable-scripted-usage-by-answering-yes-to-all-prompts">Enable scripted usage by answering "yes" to all prompts</a></h2>
<pre><code>--no-prompt
</code></pre>
<p>The <code>garden prune</code> command interactively prompts before removing each repository.
The prompt looks like the following:</p>
<pre><code class="language-bash"># /home/user/src/example
Delete the "example" repository?
WARNING: "all" deletes "example" and ALL subsequent repositories!
Choices: yes, no, all, quit [y,n,all,q]?
</code></pre>
<p>Entering <code>y</code> (or <code>yes</code>) at the prompt will delete the repository and all of its files.</p>
<p>Entering <code>n</code> (or <code>no</code>) at the prompt will skip and not remove the repository.</p>
<p>Entering <code>q</code> (or <code>quit</code>) will exit <code>garden prune</code> without deleting the repository.</p>
<p>Entering <code>all</code> will remove the repository and all subsequent repositories.
<code>all</code> is equivalent to answering <code>yes</code> to all further prompts.</p>
<p>Entering <code>all</code> is dangerous and proceeds without further prompts. Be careful!</p>
<p><code>--no-prompt</code> is also equivalent to answering <code>yes</code> to all prompts.
<code>--no-prompt</code> is intended for use in scripts where user interaction is not desired.
Use with caution!</p>
<h2 id="garden-completion"><a class="header" href="#garden-completion">garden completion</a></h2>
<p>Shell completions for <code>garden</code> can be generated by running the <code>garden completion</code>
command.</p>
<p><code>garden completion</code> uses <a href="https://crates.io/crates/clap_complete">clap complete</a>
to generate its completions.</p>
<p>The <code>--commands</code> options will additionally generate completions for custom commands.</p>
<h3 id="zsh"><a class="header" href="#zsh">Zsh</a></h3>
<p>Ensure that your <code>~/.zshrc</code> file has completions enabled and that you have a
directory configured in your <code>$fpath</code> for <code>zsh</code> completion scripts.
Add the following snippet to your <code>~/.zshrc</code> to enable completions and
configure <code>~/.config/zsh/completion</code> for providing completion scripts.</p>
<pre><code class="language-bash">fpath=(~/.config/zsh/completion $fpath)
autoload -U +X compinit
compinit -i
</code></pre>
<p>These settings make <code>zsh</code> look for a script called <code>_garden</code> in the directory when
tab-completing for <code>garden</code>.</p>
<p>Lastly, create the directory and generate the <code>~/.config/zsh/completion/_garden</code>
zsh shell completion script.</p>
<pre><code class="language-bash">mkdir -p ~/.config/zsh/completion
garden completion zsh &gt;~/.config/zsh/completion/_garden
</code></pre>
<p>Use <code>garden completion --commands zsh</code> instead of <code>garden completion zsh</code>
to include completions for custom commands.</p>
<p><em>NOTE</em>: You should regenerate the <code>_garden</code> zsh completion script whenever <code>garden</code>
is upgraded to ensure that all of the options and commands have up to date completions.</p>
<h3 id="bash"><a class="header" href="#bash">Bash</a></h3>
<p>Add the following snippet to your <code>~/.bashrc</code> to enable <code>bash</code> tab completions.</p>
<pre><code class="language-bash">if test -n "$PS1" &amp;&amp; type garden &gt;/dev/null 2&gt;&amp;1
then
    eval "$(garden completion bash)" 2&gt;/dev/null
fi
</code></pre>
<p>Use <code>garden completion --commands bash</code> instead of <code>garden completion bash</code>
to include completions for custom commands.</p>
<h3 id="future-shell-completion-enhancements"><a class="header" href="#future-shell-completion-enhancements">Future shell completion enhancements</a></h3>
<p>Tab completion can only be made to include a static set of user-defined commands.
Custom commands cannot be defined dynamically, which means that the same completions
will be used irrespective of your current directory.</p>
<p>Improvements to the shell completions can be made once traction has been made on the
following upstream issues:</p>
<ul>
<li>
<p><a href="https://github.com/clap-rs/clap/issues/3022">clap #3022</a> - zsh broken with two multi length arguments</p>
</li>
<li>
<p><a href="https://github.com/clap-rs/clap/pull/4612">clap #4612</a> - candidate fix for the above issue</p>
</li>
<li>
<p><a href="https://github.com/epage/clapng/issues/92">clapng #92</a> - Dynamic completion support</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>Garden is configured through a YAML configuration file, typically called
"garden.yaml".</p>
<p>Garden will find <code>garden.yaml</code> in current directory or in specific locations
on the filesystem when unspecified.  Garden searches for <code>garden.yaml</code> in the
following locations. The first one found is used.</p>
<pre><code class="language-sh"># Relative to the current directory
./garden.yaml
./garden/garden.yaml
./etc/garden/garden.yaml

# Relative to $HOME
~/.config/garden/garden.yaml
~/etc/garden/garden.yaml

# Global configuration
/etc/garden/garden.yaml
</code></pre>
<p>If <code>garden.yaml</code> is not found in these directories then <code>garden</code> will walk up the
file system searching for config files.</p>
<p>You can prevent <code>garden</code> from traversing into directories higher in the file system
tree by setting either the <code>GARDEN_CEILING_DIRS</code> or <code>GIT_CEILING_DIRS</code> environment
variables. Multiple directories can be specified by using a colon(<code>:</code>)-delimited
list of ceiling directories.</p>
<p><code>garden</code> uses the <a href="https://git-scm.com/book/en/v2/Git-Internals-Environment-Variables">GIT_CEILING_DIRS</a>
environment variable from core Git as a fallback when <code>GARDEN_CEILING_DIRS</code> it is not set.</p>
<p><code>GARDEN_CEILING_DIRS</code> has higher precedence and overrides values configured in
<code>GIT_CEILING_DIRS</code>.</p>
<p>Use <code>garden -c|--config &lt;filename&gt;</code> to specify a garden file and override
<code>garden</code>'s file discovery.</p>
<p>If a basename is specified, e.g. <code>garden --config custom.yaml</code>, then <code>garden</code> will search
these same locations for <code>custom.yaml</code> instead of <code>garden.yaml</code>.</p>
<p>The following example <code>garden.yaml</code> is referred to by the documentation
when showing examples.</p>
<pre><code class="language-yaml"># Create environments for developing Git Cola against development versions of Git.
#
# The following gardens are defined: "cola", "cola/main" and "cola/next".
#
# The "cola" garden runs git-cola using the "git" command from your $PATH.
# The "cola/main" garden runs git-cola using git.git's "main" branch.
# The "cola/next" garden runs git-cola using git.git's "next" branch.
#
# One-time Setup:
#
# * Clone repositories and create worktrees:
#
#   garden grow cola/main cola/next
#
# * Initialize git-cola's Python virtualenv environment.
#
#   garden setup cola
#
# Development workflows:
#
# * Build the "cola/main" garden using git.git's "main" branch:
#   garden build cola/main
#
# * Build the "cola/next" garden using git.git's "next" branch:
#   garden build cola/next
#
# * Run Git Cola
#   garden run
#
# * Run Git Cola on the git/next and git-cola trees using the cola/next garden environment:
#   garden run --trees git/next cola/next
#   garden run -t git-cola cola/next
#
# * Open a shell for running Git Cola in different enviornments
#   garden shell cola/main
#   garden shell cola/next
#
# * Run just Git Cola's tests in each environment.
#   garden test/cola cola
#   garden test/cola cola/main
#   garden test/cola cola/next
#
# * Run tests for all projects in each environment. Also runs Git's testsuite.
#   garden test cola
#   garden test cola/main
#   garden test cola/next

# The following variables are used in the custom commands below.
variables:
  # A virtualenv is created in the ./dist/git-cola/env3 directory.
  prefix: ${GARDEN_ROOT}/git-cola/env3
  jobs: $ nproc 2&gt;/dev/null || sysctl -n hw.ncpu 2&gt;/dev/null || echo 8

commands:
  add-all: git add --update
  diff: GIT_PAGER= git diff --patience --color-words "$@"
  lol: git log --decorate --graph --oneline "$@" &amp;&amp; echo
  run: vx ${prefix} git cola "$@"
  status:
    - git status --short
    - git branch

templates:
  bin:
    environment:
      PATH: ${TREE_PATH}/bin
  python:
    environment:
      PYTHONPATH: ${TREE_PATH}
  makefile:
    commands:
      build: make -j ${jobs} prefix="${prefix}" all "$@"
      install: make -j ${jobs} prefix="${prefix}" install "$@"
      test: make -j ${jobs} prefix="${prefix}" test "$@"
      doc: make -j ${jobs} prefix="${prefix}" doc "$@"

trees:
  # git/main is the parent worktree that shares its .git storage with the child
  # git/next worktrees using "git worktree" -- https://git-scm.com/docs/git-worktree
  git/main:
    url: https://github.com/git/git.git
    templates: makefile
    environment:
      PATH: ${TREE_PATH}/bin-wrappers
      # git/next is a "git worktree" for git.git's "next" branch.
  git/next:
    worktree: git/main
    branch: next

  # git-cola's worktree can be reused alongside any of the git/* trees defined above.
  git-cola:
    url: https://gitlab.com/git-cola/git-cola.git
    templates: [bin, python]
    commands:
      setup: garden dev
      test/cola: garden test "$@"
      install: garden -D prefix="${prefix}" install "$@"
      test: garden test "$@"
      doc: garden doc "$@"

  qtpy:
    description: Qt abstraction library used by git-cola
    url: https://github.com/spyder-ide/qtpy.git
    templates: python
    setup: vx ${prefix} pip install pytest-qt

  vx:
    description: Utility for activating Python virtualenvs
    url: https://gitlab.com/davvid/vx.git
    depth: 1  # Create a shallow clone using "git clone --depth=1"
    environment:
      PATH: ${TREE_PATH}
    commands:
      test: make test

  # This tree allows the "run" command to be run from any directory.
  cwd:
    path: ${PWD}

groups:
  cola-repos-grp:
    - git-cola
    - qtpy
    - vx

gardens:
  cola:
    groups: cola-repos-grp
    environment:
      PATH: ${prefix}/bin
  cola/main:
    groups: cola-repos-grp
    trees: git/main
    environment:
      PATH: ${prefix}/bin
  cola/next:
    groups: cola-repos-grp
    trees: git/next
    environment:
      PATH: ${prefix}/bin
</code></pre>
<h2 id="garden-root"><a class="header" href="#garden-root">Garden Root</a></h2>
<p>The garden root directory is configured in the <code>garden.root</code> field.
This directory is the parent directory in which all trees will be cloned.</p>
<p><code>garden.root</code> defaults to <code>${GARDEN_CONFIG_DIR}</code> when unspecified.
<code>{GARDEN_CONFIG_DIR}</code> is the directory that contains the current <code>garden.yaml</code> .</p>
<p>The default <code>${GARDEN_CONFIG_DIR}</code> value lets you create relocatable setups
with trees that are located relative to the <code>garden.yaml</code> config file.</p>
<p>Slashes in tree paths will create new directories on disk as needed.</p>
<pre><code class="language-yaml"># By default, "garden init" generates a "garden.yaml" that uses the
# ${GARDEN_CONFIG_DIR} for its "garden.root" location.
garden:
  root: ${GARDEN_CONFIG_DIR}
</code></pre>
<p>Omitting <code>garden.root</code> is equivalent to the configuration above.</p>
<p>To place all trees in a <code>src</code> directory sibling to the <code>garden.yaml</code> file, the
following configuration can be used:</p>
<pre><code class="language-yaml">garden:
  root: ${GARDEN_CONFIG_DIR}/src
</code></pre>
<p>To place all trees in a <code>src</code> directory in your <code>$HOME</code> directory, the
following configuration can be used:</p>
<pre><code class="language-yaml">garden:
  root: ~/src
</code></pre>
<p>Configure <code>garden.root</code> to <code>""</code> (an empty string) to use a dynamic
<code>garden.root</code> that follows your current directory. This lets you use
<code>garden --config &lt;path&gt;</code> to create and interact with trees in your
current directory instead of a fixed configuration-defined location.</p>
<pre><code class="language-yaml">garden:
  root: ""
</code></pre>
<h2 id="garden-shell-2"><a class="header" href="#garden-shell-2">Garden Shell</a></h2>
<p>The shell used by <code>garden</code> when running Commands is configured by the <code>garden.shell</code> field.</p>
<pre><code class="language-yaml">garden:
  shell: zsh
</code></pre>
<p>The <code>$PATH</code> environment variable is probed for available shells in the following order
when <code>garden.shell</code> is omitted. The first one found is the one that's used.</p>
<ul>
<li><code>zsh</code></li>
<li><code>bash</code></li>
<li><code>dash</code></li>
<li><code>sh</code></li>
</ul>
<p>The following shell interpreters can also be configured in <code>garden.shell</code>
for running custom commands.</p>
<ul>
<li><code>bun</code></li>
<li><code>fish</code></li>
<li><code>node</code></li>
<li><code>perl</code></li>
<li><code>python3</code></li>
</ul>
<p>Any command that can run command strings using <code>-c</code> can be used as a
<code>garden.shell</code> interpreter.</p>
<p>Exec expressions are always run using the default <code>/bin/sh</code> system shell
irrespective of <code>garden.shell</code>.</p>
<h2 id="tree-display"><a class="header" href="#tree-display">Tree Display</a></h2>
<p>Garden will display the tree's current branch when running commands.
While this has a marginal performance impact, this feature can be disabled by either
passing the <code>garden -D garden.tree-branches=0</code> option or by configuring the
<code>garden.tree-branches</code> option to <code>false</code> in the <code>garden.yaml</code> configuration.</p>
<pre><code class="language-yaml">garden:
  tree-branches: false
</code></pre>
<h2 id="includes"><a class="header" href="#includes">Includes</a></h2>
<p>Garden files can be split apart into several files for modularity and reuse.
You can use the <code>garden.includes</code> list to specify other garden files to include
into the current garden file.</p>
<pre><code class="language-yaml">garden:
  includes:
    # Includes are relative to the GARDEN_CONFIG_DIR by default.
    - variables.yaml
    # Includes can reference custom and built-in ${variables}.
    - ${include_dir}/commands.yaml

variables:
  include_dir: ${GARDEN_ROOT}
</code></pre>
<p>Absolute paths in the <code>garden.includes</code> list are included as-is.
Relative paths in the <code>garden.includes</code> list are resolved.</p>
<p>Relative paths are first resolved relative to the file in which they are defined.
This allows nested include files to use relative paths for their nested includes.</p>
<p>If an include file is not found relative to the current garden file then a path relative
to the root configuration directory will be checked for the existence of the file.</p>
<p>Includes files are treated like "optional" includes -- include files that cannot be
found are silently ignored.</p>
<p>Enable the <code>garden -d config ...</code> debug flag to display warnings about missing include
files.</p>
<h3 id="the-last-one-wins-rule"><a class="header" href="#the-last-one-wins-rule">The "Last One Wins" Rule</a></h3>
<p>Entities in garden files such as <code>trees</code>, <code>gardens</code>, <code>groups</code>, <code>commands</code> and
<code>variables</code> can be sparsely defined across multiple files by using <code>includes</code>.</p>
<p>When the same entry is found in multiple included files then the only last definition
will be used. This is referred to as the "Last One Wins" rule.</p>
<p>Entities defined in the root <code>garden.yaml</code> have the highest precedence and override
entries provided via <code>garden.includes</code>.</p>
<p><code>variables</code>, <code>commands</code>, <code>groups</code> and <code>gardens</code> are completely replaced when multiple
definitions are found.</p>
<p><code>trees</code> are sparsely overridden. If an override definition in the top-level
<code>garden.yaml</code> replaces just the <code>url</code> field, for example, then all of the <code>commands</code>,
<code>variables</code> and <code>environment</code> values from the earlier definition are retained
and only the <code>url</code> for the <code>origin</code> remote is replaced.</p>
<p>If a tree needs to completely override a base definition then a tree can use
<code>replace: true</code> to indicate that the tree definition is replacement for the
earlier tree definition.</p>
<pre><code class="language-yaml"># garden.yaml
garden:
  includes: trees.yaml

trees:
  example:
    replace: true
    url: https://custom.example.org/custom/example.git
</code></pre>
<p>The <code>garden.yaml</code> above includes <code>trees.yaml</code>. The <code>example</code> tree is originally
defined here, but it is completely replaced by the same entry above.</p>
<pre><code class="language-yaml"># trees.yaml
trees:
  example: https://example.com/original/tree.git
  commands:
    echo: Hello, ${TREE_NAME}
</code></pre>
<p>In the example above, the <code>example</code> tree completely replaces the
same tree from the included <code>trees.yaml</code>. None of the commands, variables or other
settings from the replaced tree are retained.</p>
<h2 id="variables"><a class="header" href="#variables">Variables</a></h2>
<p>Garden configuration contains a "variables" block that allows defining
variables that are can be referenced by other garden values.</p>
<pre><code class="language-yaml">variables:
  flavor: debug
  user: $ whoami
  libdir: $ test -e /usr/lib64 &amp;&amp; echo lib64 || echo lib
  nproc: $ nproc
  prefix: ~/.local
  py_ver_code: from sys import version_info as v; print("%s.%s" % v[:2])
  py_ver: $ python3 -c '${py_ver_code}'
  py_site: ${libdir}/python${py_ver}/site-packages
</code></pre>
<p>Variables definitions can reference environment variables and other garden
variables.</p>
<p>Variable references use shell <code>${variable}</code> syntax.</p>
<p>Values that start with dollar-sign+space (<code>$ </code>) are called "exec expressions".
Exec expressions are run through a shell after evaluation and replaced with
the output of the evaluated command.</p>
<p>When resolving values, variables defined in a tree scope override/replace
variables defined at the global scope.  Variables defined in garden scope
override/replace variables defined in a tree scope.</p>
<h2 id="built-in-variables"><a class="header" href="#built-in-variables">Built-in variables</a></h2>
<p>Garden automatically defines some built-in variables that can be useful
when constructing values for variables, commands, and paths.</p>
<ul>
<li><strong>GARDEN_CONFIG_DIR</strong> -- Directory containing the <code>garden.yaml</code> file.</li>
<li><strong>GARDEN_ROOT</strong> -- Root directory for trees.</li>
<li><strong>TREE_NAME</strong> -- Current tree name.</li>
<li><strong>TREE_PATH</strong> -- Current tree path.</li>
</ul>
<h3 id="variables-for-custom-commands"><a class="header" href="#variables-for-custom-commands">Variables for Custom Commands</a></h3>
<p>The following built-in variables are provided to make it easier to write custom commands
that re-execute <code>garden</code>. These variables allow you to forward the user-specified
<code>-vv</code> or <code>--quiet</code> options to child commands.</p>
<ul>
<li><strong>GARDEN_CMD_QUIET</strong> -- <code>--quiet</code> when <code>--quiet</code> is specified, empty otherwise.</li>
<li><strong>GARDEN_CMD_VERBOSE</strong> -- <code>-v</code>, <code>-vv</code> etc. when verbosity is increased, empty otherwise.</li>
</ul>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h2>
<p>The "environment" block defines variables that are stored in the environment.</p>
<p>Environment variables are resolved in the same order as garden variables:
global scope, tree scope, and garden scope.  This allows gardens to
prepend/append variables after a tree, thus allowing for customization
of behavior from the garden scope.</p>
<p>Values in environment blocks prepend to the environment variable by default.
The <code>:</code> UNIX path separator is used when prepending and appending values.</p>
<pre><code class="language-yaml">trees:
  foo:
    environment:
      PATH: ${TREE_PATH}/bin
</code></pre>
<p>The example above prepends the <code>foo/bin</code> directory to the colon (<code>:</code>)-delimited <code>PATH</code>
environment variable.</p>
<p>Names with an equals sign (<code>=</code>) suffix are treated as "store" operations and are
stored into the environment, fully replacing any pre-existing values.</p>
<pre><code class="language-yaml">trees:
  foo:
    environment:
      ${TREE_NAME}_LOCATION=: ${TREE_PATH}
</code></pre>
<p>Environment variable entries can use garden <code>${variable}</code> syntax when defining
both their name and values. The example above exports a variable called <code>foo_LOCATION</code>
with the location of the tree. If <code>foo_LOCATION</code> is already defined then its value is
replaced.</p>
<p>A plus sign (<code>+</code>) suffix in the name append to a variable instead of prepending.</p>
<pre><code class="language-yaml">trees:
  foo:
    environment:
      PATH+: ${TREE_PATH}/bin
</code></pre>
<p>The example above appends to the <code>PATH</code> environment variable.
Note the <code>+</code> suffix after <code>PATH</code>.</p>
<h3 id="os-environment-variables"><a class="header" href="#os-environment-variables">OS Environment Variables</a></h3>
<p>OS-level environment variables that are present in garden's runtime
environment can be referenced using garden <code>${variable}</code> expression syntax.
Garden variables have higher precedence than environment variables when
resolving <code>${variable}</code> references -- the environment is checked only when
no garden variables exist by that name.</p>
<h3 id="variable-expression-evaluation-order"><a class="header" href="#variable-expression-evaluation-order">Variable Expression Evaluation Order</a></h3>
<p>Garden <code>${variables}</code> expressions can reference other variables and they can also
reference variables from <code>environment</code> entries.</p>
<p>Referencing variables defined in an <code>environment</code> section from a <code>variables</code>
entry is generally discouraged for simplicity, but it is supported and valid.
It is recommended that a <code>variables</code> entry should only reference other
<code>variables</code> and avoid referencing entries from <code>environment</code> blocks.</p>
<p>Following this rule of thumb results in configurations where entries from
<code>environment</code> sections depend on entries from <code>variables</code> and not the other way around.
This minimizes the chance of introducing cyclical dependencies across variables.</p>
<p><code>environment</code> entries are only used during variable resolution when the expression
evaluation engine is unable to find the variable in any of the higher-precedence scopes.</p>
<p>The precedence order when expanding variables, from strongest to weakest, is as follows:</p>
<ul>
<li>
<p>The <code>variables</code> block in a garden's scope.</p>
</li>
<li>
<p>The <code>variables</code> block in a tree's scope.</p>
</li>
<li>
<p>The <code>variables</code> block in the global configuration scope.</p>
</li>
<li>
<p>The <code>environments</code> block in a garden's scope.</p>
</li>
<li>
<p>The <code>environments</code> block in a tree's scope.</p>
</li>
<li>
<p>The <code>environments</code> block in the global configuration scope.</p>
</li>
<li>
<p>OS environment variables.</p>
</li>
</ul>
<p>The first entry found is used when expanding <code>${variable}</code> expressions.</p>
<h2 id="gardens-groups-and-trees"><a class="header" href="#gardens-groups-and-trees">Gardens, Groups and Trees</a></h2>
<p>Trees are Git repositories with configuration that allows for the
specification of arbitrary commands and workflows.  Groups are a simple
named grouping mechanism.</p>
<p>Gardens aggregate groups and trees.  Define a group and reuse the group in
different gardens to share tree lists between gardens.  Defining gardens
and groups make those names available when querying and performing operations
over trees.</p>
<p>Gardens can also include environment, gitconfig, and custom group-level
commands in addition to the commands provided by each tree.</p>
<h2 id="trees"><a class="header" href="#trees">Trees</a></h2>
<p>The <code>trees</code> block in a <code>garden.yaml</code> Garden file defines the trees that
are available for running commands against.</p>
<p>Trees represent Git worktrees and can be aggregated into groups and gardens.
The <code>tree</code> block defines properties about a tree such as its Git URL,
custom variables, environment variables, Git remotes, Git configuration variables,
and custom commands.</p>
<pre><code class="language-yaml">trees:
  git-scm:
    description: Fast, scalable, distributed version control
    path: git
    url: git://git.kernel.org/pub/scm/git/git.git
    remotes:
      gitster: https://github.com/gitster/git.git
      gitlab: https://gitlab.com/git-scm/git.git
      github: https://github.com/git/git.git
    commands:
      build: make all -j ${num_procs} "$@"
      test: make test "$@"
    variables:
      num_procs: $ nproc 2&gt;/dev/null || sysctl -n hw.activecpu 2&gt;/dev/null || echo 4
    links:
      - "https://gitgitgadget.github.io/"
      - "https://github.com/gitgitgadget/git/issues"
</code></pre>
<p>All fields are more or less optional. The <code>path</code> field defaults to the same
name as the tree, so the <code>path: git</code> setting above can be omitted without
any differences in behavior.</p>
<p>The <code>path</code> field can be used to name trees independently of directory on disk.
The <code>path</code> value defaults to the same name as the tree, for example <code>git-scm</code>
would be used as the directory without the <code>path: git</code> setting above.</p>
<p>The <code>path: git</code> setting causes <code>garden grow git-scm</code> to clone into a directory called
<code>git</code> instead of <code>git-scm</code>.</p>
<p>Relative paths are assumed to be relative to the <code>${GARDEN_ROOT}</code>, typically the
same directory as the <code>garden.yaml</code>.</p>
<p>If the only field you want to configure is the <code>url</code> field then you can also
use a <code>string</code> rather than a <code>dictionary</code> / <code>table</code> to represent a tree
by providing just the URL. This configures a tree with a single <code>origin</code>
remote pointing to the configured URL.</p>
<pre><code class="language-yaml">trees:
  git-scm: git://git.kernel.org/pub/scm/git/git.git
</code></pre>
<h3 id="default-tree"><a class="header" href="#default-tree">Default Tree</a></h3>
<p>The <code>trees</code> block is optional when a <code>commands</code> block exists.</p>
<p>An implicit default tree called <code>.</code> will be synthesized into existence when the <code>trees</code>
block is empty.</p>
<p>The default tree's <code>path</code> is set to the <code>${GARDEN_CONFIG_DIR}</code>.
Omitting the <code>trees</code> block lets you use <code>garden</code> as a simple command runner.</p>
<h3 id="remotes"><a class="header" href="#remotes">Remotes</a></h3>
<p>The <code>remotes</code> field defines named
<a href="https://git-scm.com/book/en/v2/Git-Basics-Working-with-Remotes">Git remotes</a>
that will be configured when growing the repository.</p>
<p>If you edit your <code>garden.yaml</code> then you can always re-run <code>garden grow</code> to add remotes
that were added to <code>garden.yaml</code>.</p>
<p>Likewise, you can always rerun <code>garden plant</code> to record new remotes that
you may have added using the <code>git remote add</code>
<a href="https://git-scm.com/docs/git-remote">command-line interface</a>.</p>
<h3 id="default-remote-name"><a class="header" href="#default-remote-name">Default Remote Name</a></h3>
<p>The default <code>origin</code> remote name used by Git can be overridden by setting the
<code>default-remote</code> field in the tree's configuration.</p>
<pre><code class="language-yaml">trees:
  git:
    url: git://git.kernel.org/pub/scm/git/git.git
    default-remote: kernel.org
</code></pre>
<p>This will create a remote called <code>kernel.org</code> instead or <code>origin</code> when growing trees.
This feature can also be used when multiple named remotes are configured.</p>
<pre><code class="language-yaml">trees:
  git:
    default-remote: kernel.org
    remotes:
      kernel.org: git://git.kernel.org/pub/scm/git/git.git
      gitster: https://github.com/gitster/git.git
</code></pre>
<h3 id="links"><a class="header" href="#links">Links</a></h3>
<p>The <code>links</code> field allows you to specify a list of related URLs.
Links are displayed by <code>garden ls</code> and are clickable when using a capable terminal.</p>
<h2 id="templates"><a class="header" href="#templates">Templates</a></h2>
<p>Templates allow sharing of command, variable, gitconfig, and environment
definitions across trees. Adding an entry to the <code>templates</code> configuration block
makes a template available when defining trees.</p>
<p>Specify <code>templates: &lt;template-name&gt;</code> to inherit the specified template's
settings when defining trees. The <code>templates</code> field also accepts a list of
template names.</p>
<p>Trees can also reuse another tree definition by specifying the "extend"
keyword with the name of another tree.  Only the first remote is used when
extending a tree.</p>
<pre><code class="language-yaml">templates:
  hello:
    variables:
      message: Hello ${TREE_NAME}.
    commands:
      echo: echo ${message}

trees:
  hello-tree:
    templates: hello
  hello-tree-extended:
    extend: hello-tree
    variables:
      message: The time is now: $(date)
</code></pre>
<p>When a tree specifies multiple templates then all of the templates are merged into
the tree's definitions. If variables are multiply-defined across multiple templates
then the variable's value from the last specified template will be used.</p>
<h2 id="string-to-list-promotion"><a class="header" href="#string-to-list-promotion">String to List Promotion</a></h2>
<p>Fields that expect Lists can also be specified using a String value.
Strings will be promoted to a List containing a single String.
This is useful when defining <code>commands</code> and <code>groups</code>.</p>
<p>The <code>commands</code> block defines commands that are specified using Lists of Strings.
<em>String to List Promotion</em> makes it easier to define commands by specifying a single
String that can either be a simple value or a multi-line YAML String.</p>
<p>The following commands show the various ways that <code>commands</code> can be specified
due to the automatic promotion of Strings into Lists.</p>
<pre><code class="language-yaml">commands:
  # commands are lists of command strings.
  cmd1:
    - echo cmd1 ${TREE_NAME}
    - pwd

  # Strings are promoted to a list with a single item.
  cmd2: echo cmd2 ${TREE_NAME} &amp;&amp; pwd
  # cmd2 is equivalent to...
  cmd2:
    - echo cmd2 ${TREE_NAME} &amp;&amp; pwd

  # Multi-line command strings can be written using "|" YAML syntax.
  cmd4: |
    echo ${TREE_NAME}
    pwd

  # cmd4 is promoted into
  cmd4:
    - "echo ${TREE_NAME}\npwd"
</code></pre>
<h2 id="wildcards-2"><a class="header" href="#wildcards-2">Wildcards</a></h2>
<p>The names in garden <code>tree</code> and <code>group</code> lists, and group member names accept glob
wildcard patterns.</p>
<p>The "annex" group definition is: <code>annex/*</code>.   This matches all trees that
start with "annex/".  The "git-all" group has two entries -- <code>git*</code> and
<code>cola</code>.  The first matches all trees that start with "git", and the second one
matches "cola" only.</p>
<h2 id="symlinks"><a class="header" href="#symlinks">Symlinks</a></h2>
<p>Symlink trees create a symlink on the filesystem during <code>garden init</code>.
<code>garden exec</code>, and custom <code>garden cmd</code> commands ignore symlink trees.</p>
<pre><code class="language-yaml">trees:
  media:
    path: ~/media
    symlink: /media/${USER}
</code></pre>
<p>The "path" entry behaves like the tree "path" entry -- when unspecified it
defaults to a path named after the tree relative to the garden root.</p>
<h2 id="grafts"><a class="header" href="#grafts">Grafts</a></h2>
<p>A more advanced modularity feature allow you to stitch additional <code>garden.yaml</code>
files underneath a custom "graft namespace".</p>
<p>The example below demonstrates how to define trees and variables in separate
"graft" files and refer to them using a <code>graft::</code> namespace qualifier.</p>
<pre><code class="language-yaml"># Top-level garden.yaml
grafts:
  graft: graft.yaml
  graft-repos:
    config: repos.yaml
    root: repos

trees:
  local-tree:
    url: https://example.com/trees/repo.git
    variables:
      value: "local ${graft::value}"

variables:
  value: "global ${graft::value}"

gardens:
  example:
    trees:
      - local-tree
      - graft::tree
      - graft-repos::example
</code></pre>
<p>The <code>graft-repos</code> graft entry demonstrates how to use a custom root directory for
the trees provided by the grafted configuration.</p>
<p>The <code>grafts.yaml</code> file provides a tree called <code>tree</code> and a variable called <code>value</code>.
We refer to them as <code>graft::tree</code> when specifying trees and <code>${graft::value}</code> when
using variables.</p>
<p><code>graft.yaml</code> contains the following:</p>
<pre><code class="language-yaml"># The grafted "graft.yaml" file.
trees:
  tree: https://example.org/trees/tree.git

variables:
  value: "grafted value"
</code></pre>
<p>Running <code>garden eval '${graft::value}'</code> will output <code>grafted value</code>.</p>
<p>Running <code>garden eval '${value}'</code> will output <code>global grafted value</code>, as it evaluates at
global scope.</p>
<p>Running <code>garden eval '${value}' local-tree</code> will output <code>local grafted value</code>, as it
evaluates from <code>local-tree</code>'s scope.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="examples"><a class="header" href="#examples">Examples</a></h1>
<p>These examples demonstrate how to use <code>garden</code> using runnable examples.</p>
<h2 id="photo-restoration"><a class="header" href="#photo-restoration">Photo Restoration</a></h2>
<p>The "Photo Restoration" example sets up the
<a href="https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life">Bringing Old Photos Back to Life</a>
software for restoring old photos that suffer from severe degradation using
machine-learning techniques.</p>
<h2 id="git-cola"><a class="header" href="#git-cola">Git Cola</a></h2>
<p>The "Git Cola" example sets up a development environment for
<a href="https://git-cola.github.io/">Git Cola</a>, a PyQt-based graphical user interface for Git.</p>
<p><a href="https://github.com/git-cola/git-cola/blob/main/garden.yaml">Git Cola's garden.yaml</a>
uses garden as a command runner, to keep track of development forks, and to gather
associated trees without the overhead of using submodules.</p>
<h2 id="command-interpreters"><a class="header" href="#command-interpreters">Command Interpreters</a></h2>
<p>The "Command Interpreters" example demonstrates how to use a custom interpreter
on a per-command basis.</p>
<h2 id="python"><a class="header" href="#python">Python</a></h2>
<p>The "Python" example demonstrates how to use <code>python3</code> to interpret all custom commands.</p>
<h2 id="node"><a class="header" href="#node">Node</a></h2>
<p>The "Node" example demonstrates how to use <code>node</code> to interpret all custom commands.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="photo-restoration-1"><a class="header" href="#photo-restoration-1">Photo Restoration</a></h1>
<p>This example demonstrates how to run the
<a href="https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life">Bringing Old Photo Back to Life</a>
photo restoration project.</p>
<h2 id="setup-1"><a class="header" href="#setup-1">Setup</a></h2>
<p>Run the following commands to clone the repository, download pre-trained deep-learning
model data files used by the software and configure a Python virtualenv used to
run the tools.</p>
<p><em>NOTE</em>: this example uses almost 7GB of disk space.</p>
<pre><code class="language-bash"># Create a directory we'll clone and build a few repositories.
mkdir -p photo-restoration &amp;&amp; cd photo-restoration

# Download and audit the garden file we're going to run.
wget https://gitlab.com/garden-rs/garden/-/raw/main/doc/src/examples/photo-restoration/garden.yaml
cat garden.yaml

# One-time setup: Clone all of the trees. This will clone an "old-photos" repo.
garden grow old-photos

# One-time setup: Download resources.
garden setup old-photos
</code></pre>
<h2 id="run-the-software"><a class="header" href="#run-the-software">Run the Software</a></h2>
<p>Now that everything is setup we can run the tools using the custom <code>run</code> command
provided by the <code>garden.yaml</code> file. The <code>run.py</code> script takes several options.</p>
<pre><code class="language-bash">garden run old-photos -- --help
</code></pre>
<p>Arguments can be passed directly to <code>run.py</code> by passing additional arguments
after the special double-dash <code>--</code> "end of options" marker.</p>
<p>The example above pases the <code>--help</code> option for demonstration purposes.
You will have to specify the <code>--input_folder &lt;folder&gt;</code> and <code>--output_folder &lt;folder&gt;</code>
in order to use the photo restoration tool. See the <code>--help</code> output for more details.</p>
<h2 id="gardenyaml"><a class="header" href="#gardenyaml">garden.yaml</a></h2>
<p>The following is the contents of the <code>garden.yaml</code> file used in this example.</p>
<p>The <code>setup</code> command defines what happens during <code>garden setup old-photos</code>.</p>
<p>The <code>run</code> command defines when happens during <code>garden run old-photos</code>.</p>
<p>Additional command-line arguments specified after the double-dash <code>--</code> marker are
available to commands via conventional <code>$1</code>, <code>$2</code>, <code>$N</code>, ... <code>"$@"</code> shell variables.</p>
<pre><code class="language-yaml">trees:
  old-photos:
    description: |
      Restore old photos using machine-learning.
      $ garden grow old-photos
      $ garden setup old-photos
      $ garden run old-photos -- --help
    url: "https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life.git"
    links:
      - "https://colab.research.google.com/drive/1NEm6AsybIiC5TwTU_4DqDkQO0nFRB-uA?usp=sharing&amp;authuser=2#scrollTo=32jCofdSr8AW"
      - "http://raywzy.com/Old_Photo/"
      - "https://news.ycombinator.com/item?id=25148253"
    environment:
      PATH: "${TREE_PATH}/${env3}/bin"
    commands:
      # "setup" uses "&gt;" post-commands to run "setup/virtualenv" and "setup/download-*".
      setup&gt;:
        - setup/virtualenv
        - setup/download-face-landmarks
        - setup/download-face-checkpoints
        - setup/download-global-checkpoints
      setup/virtualenv: |
        test -d ${env3} || (
            python3 -m venv ${env3}
            ${env3}/bin/pip install -r requirements.txt
        )
      setup/download-face-landmarks: |
        cd ./Face_Detection
        test -f shape_predictor_68_face_landmarks.dat || (
            curl -L http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2 \
                -o shape_predictor_68_face_landmarks.dat.bz2
            bzip2 -v -d shape_predictor_68_face_landmarks.dat.bz2
        )
      setup/download-face-checkpoints: |
        cd ./Face_Enhancement
        test -f checkpoints.zip ||
        curl -L https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life/releases/download/v1.0/face_checkpoints.zip \
            -o checkpoints.zip
        test -d checkpoints || unzip checkpoints.zip
      setup/download-global-checkpoints: |
        cd ./Global
        test -f checkpoints.zip ||
        curl -L https://github.com/microsoft/Bringing-Old-Photos-Back-to-Life/releases/download/v1.0/global_checkpoints.zip \
            -o checkpoints.zip
        test -d checkpoints || unzip checkpoints.zip
      run: ${env3}/bin/python3 run.py "$@"

variables:
  env3: $ python3 -c 'import sys; print("env%s%s" % sys.version_info[:2])'
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git-cola-development"><a class="header" href="#git-cola-development">Git Cola Development</a></h1>
<p>This garden file sets up a development garden with the latest version of Git, Git Cola,
qtpy and vx.</p>
<p>Run the following commands to see this in action.</p>
<pre><code class="language-bash"># Create a directory we'll clone and build a few repositories.
mkdir -p cola &amp;&amp; cd cola

# Download and audit the garden file we're going to run.
wget https://gitlab.com/garden-rs/garden/-/raw/main/doc/src/examples/git-cola/garden.yaml
cat garden.yaml

# One-time setup: Clone all of the repos in the "cola" garden and use a custom
# "garden grow" is a garden built-in command that clones.
garden grow cola

# "garden setup" command defined in "garden.yaml" to initializes the environment.
garden setup cola

# All set! Now we can run Git Cola from the development environment.
garden run

# Daily development workflow: run tests in each repository in-place.
garden test cola

# Commands can be passed to the underlying "run" command to run Git Cola
# against any Git repository.
garden run -- --repo path/to/any/git/tree

# These projects don't need to be "built", so this is technically a no-op.
# A Rust or C++ Rust project could use something like this to run "make"
# in each repository.
garden build cola
</code></pre>
<p>The development repositories are now in your current directory and a
development virtualenv is present in the <code>./dist</code> directory.</p>
<h2 id="gardenyaml-1"><a class="header" href="#gardenyaml-1">garden.yaml</a></h2>
<p>The following is the contents of the <code>garden.yaml</code> file used in this example.</p>
<pre><code class="language-yaml"># Create environments for developing Git Cola against development versions of Git.
#
# The following gardens are defined: "cola", "cola/main" and "cola/next".
#
# The "cola" garden runs git-cola using the "git" command from your $PATH.
# The "cola/main" garden runs git-cola using git.git's "main" branch.
# The "cola/next" garden runs git-cola using git.git's "next" branch.
#
# One-time Setup:
#
# * Clone repositories and create worktrees:
#
#   garden grow cola/main cola/next
#
# * Initialize git-cola's Python virtualenv environment.
#
#   garden setup cola
#
# Development workflows:
#
# * Build the "cola/main" garden using git.git's "main" branch:
#   garden build cola/main
#
# * Build the "cola/next" garden using git.git's "next" branch:
#   garden build cola/next
#
# * Run Git Cola
#   garden run
#
# * Run Git Cola on the git/next and git-cola trees using the cola/next garden environment:
#   garden run --trees git/next cola/next
#   garden run -t git-cola cola/next
#
# * Open a shell for running Git Cola in different enviornments
#   garden shell cola/main
#   garden shell cola/next
#
# * Run just Git Cola's tests in each environment.
#   garden test/cola cola
#   garden test/cola cola/main
#   garden test/cola cola/next
#
# * Run tests for all projects in each environment. Also runs Git's testsuite.
#   garden test cola
#   garden test cola/main
#   garden test cola/next

# The following variables are used in the custom commands below.
variables:
  # A virtualenv is created in the ./dist/git-cola/env3 directory.
  prefix: ${GARDEN_ROOT}/git-cola/env3
  jobs: $ nproc 2&gt;/dev/null || sysctl -n hw.ncpu 2&gt;/dev/null || echo 8

commands:
  add-all: git add --update
  diff: GIT_PAGER= git diff --patience --color-words "$@"
  lol: git log --decorate --graph --oneline "$@" &amp;&amp; echo
  run: vx ${prefix} git cola "$@"
  status:
    - git status --short
    - git branch

templates:
  bin:
    environment:
      PATH: ${TREE_PATH}/bin
  python:
    environment:
      PYTHONPATH: ${TREE_PATH}
  makefile:
    commands:
      build: make -j ${jobs} prefix="${prefix}" all "$@"
      install: make -j ${jobs} prefix="${prefix}" install "$@"
      test: make -j ${jobs} prefix="${prefix}" test "$@"
      doc: make -j ${jobs} prefix="${prefix}" doc "$@"

trees:
  # git/main is the parent worktree that shares its .git storage with the child
  # git/next worktrees using "git worktree" -- https://git-scm.com/docs/git-worktree
  git/main:
    url: https://github.com/git/git.git
    templates: makefile
    environment:
      PATH: ${TREE_PATH}/bin-wrappers
      # git/next is a "git worktree" for git.git's "next" branch.
  git/next:
    worktree: git/main
    branch: next

  # git-cola's worktree can be reused alongside any of the git/* trees defined above.
  git-cola:
    url: https://gitlab.com/git-cola/git-cola.git
    templates: [bin, python]
    commands:
      setup: garden dev
      test/cola: garden test "$@"
      install: garden -D prefix="${prefix}" install "$@"
      test: garden test "$@"
      doc: garden doc "$@"

  qtpy:
    description: Qt abstraction library used by git-cola
    url: https://github.com/spyder-ide/qtpy.git
    templates: python
    setup: vx ${prefix} pip install pytest-qt

  vx:
    description: Utility for activating Python virtualenvs
    url: https://gitlab.com/davvid/vx.git
    depth: 1  # Create a shallow clone using "git clone --depth=1"
    environment:
      PATH: ${TREE_PATH}
    commands:
      test: make test

  # This tree allows the "run" command to be run from any directory.
  cwd:
    path: ${PWD}

groups:
  cola-repos-grp:
    - git-cola
    - qtpy
    - vx

gardens:
  cola:
    groups: cola-repos-grp
    environment:
      PATH: ${prefix}/bin
  cola/main:
    groups: cola-repos-grp
    trees: git/main
    environment:
      PATH: ${prefix}/bin
  cola/next:
    groups: cola-repos-grp
    trees: git/next
    environment:
      PATH: ${prefix}/bin
</code></pre>
<h2 id="pre-defined-custom-commands-and-ad-hoc-commands"><a class="header" href="#pre-defined-custom-commands-and-ad-hoc-commands">Pre-defined Custom Commands and Ad-Hoc Commands</a></h2>
<p>Included in <code>garden.yaml</code> are a few few helpful commands that give us a quick
view of what's going on in each tree:</p>
<pre><code class="language-bash">garden diff cola
garden status cola
garden lol cola
</code></pre>
<p>If we want to perform git stuff (like fetch the latest changes), we can
always use <code>garden exec</code> to run arbitrary commands:</p>
<pre><code class="language-bash">garden exec cola git fetch --verbose

# When needed, we can hop into a shell with all of the environment variables set
garden shell cola
</code></pre>
<h2 id="self-contained-installation-demo"><a class="header" href="#self-contained-installation-demo">Self-contained installation demo</a></h2>
<p>The <code>garden run</code> example runs <code>git</code> and <code>git cola</code> in-place in their
respective trees. The <code>git-cola</code> project is not installed into the <code>./dist</code> directory.
It contains just the virtualenv created needed to run it.</p>
<p>In order to create a self-contained installation to run the tools
independently of their source repositories we have to install them into the
<code>./dist</code> directory.</p>
<p>The following example installs Git and Git Cola into the <code>./dist</code> directory
by running the "make install" targets in each repo:</p>
<pre><code class="language-bash">garden install cola
</code></pre>
<p>Now we can test the installed tools directly by adding <code>./dist/bin</code> to our
<code>$PATH</code>, or just invoke the script directly:</p>
<pre><code class="language-bash">./dist/bin/git-cola
</code></pre>
<p>Voila, we now have a fully functional development environment with PyQt5, qtpy
and Git Cola ready to go for development.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-interpreters-1"><a class="header" href="#command-interpreters-1">Command Interpreters</a></h1>
<p>This example demonstrates how to use custom interpreters on a per-command basis.</p>
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<pre><code class="language-bash">garden hello
garden info
# Pass additional arguments after the double-dash `--` end-of-options marker.
garden hello -- cat
</code></pre>
<h2 id="gardenyaml-2"><a class="header" href="#gardenyaml-2">garden.yaml</a></h2>
<pre><code class="language-yaml"># Demo using custom interpreters on a per-command basis.
commands:
  # The "#!" shebang line specifies the interpreter to use.
  hello: |
    #!python3 -c
    import sys
    # dash_c = sys.argv[0]  # sys.argv[0] contains '-c'
    args = sys.argv[1:]  # additional arguments specified after '--'
    if args:
        world = ' '.join(args)
    else:
        world = 'world'
    print(f'hello {world}')
  # The default `garden.shell` is used when no shebang line is present.
  info: echo ${uname}

# NOTE: exec expressions are always run using the system's default #!/bin/sh shell.
variables:
  uname: $ uname -a
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="python-commands"><a class="header" href="#python-commands">Python Commands</a></h1>
<p>This example demonstrates how to configure <code>garden.shell</code> to use <code>python3</code>
when running custom commands.</p>
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<pre><code class="language-bash">garden hello
garden info
# Pass additional arguments after the double-dash `--` end-of-options marker.
garden hello -- cat
</code></pre>
<h2 id="gardenyaml-3"><a class="header" href="#gardenyaml-3">garden.yaml</a></h2>
<pre><code class="language-yaml"># Demo using "python3" as the interpreter for custom commands.
garden:
  shell: python3

commands:
  hello: |
    import sys
    # dash_c = sys.argv[0]  # sys.argv[0] contains '-c'
    args = sys.argv[1:]  # additional arguments specified after '--'
    if args:
        world = ' '.join(args)
    else:
        world = 'world'
    print(f'hello {world}')

  info: |
    import os
    import sys
    print(f'os.name = {os.name}')
    print(f'sys.platform = {sys.platform}')
    print(r'sys.int_info = {sys.int_info}')
    print('uname = ${uname}')

variables:
  # NOTE: exec expressions are always run using the system's default #!/bin/sh shell.
  uname: $ uname -a
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nodejs-commands"><a class="header" href="#nodejs-commands">Node.js Commands</a></h1>
<p>This example demonstrates how to configure <code>garden.shell</code> to use <code>node</code>
when running custom commands.</p>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<pre><code class="language-bash">garden hello
garden info
# Pass additional arguments after the double-dash `--` end-of-options marker.
garden hello -- cat
</code></pre>
<h2 id="gardenyaml-4"><a class="header" href="#gardenyaml-4">garden.yaml</a></h2>
<pre><code class="language-yaml"># Demo using "node" as the interpreter for custom commands.
garden:
  shell: node

commands:
  hello: |
    if (process.argv.length &gt; 1) {
      console.log('hello ' + process.argv.slice(1).join(' '));
    } else {
      console.log('hello world')
    }

  info: |
    console.log(process)
    console.log('${uname}')

# NOTE: exec expressions are always run using the system's default #!/bin/sh shell.
variables:
  uname: $ uname -a
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="faq-tips-and-tricks"><a class="header" href="#faq-tips-and-tricks">FAQ, Tips and Tricks</a></h1>
<h2 id="can-garden-print-out-each-command-in-a-multi-line-command-as-it-is-run"><a class="header" href="#can-garden-print-out-each-command-in-a-multi-line-command-as-it-is-run">Can garden print out each command in a multi-line command as it is run?</a></h2>
<p>While <code>garden -vv</code> can be used to make <code>garden</code> print out the rendered command
right before garden runs it, all of the commands in a multi-line command are
printed at once before any command is run.</p>
<p>You can enable "echo mode" in the command's shell to make it print out
each command as it is run.</p>
<p>Enable echo mode by calling <code>set -x</code> in your command.</p>
<pre><code class="language-yaml">commands:
  echo: |
    set -x
    echo hello
    echo world
</code></pre>
<p>Calling <code>set -x</code> results in the following output from <code>garden echo</code>:</p>
<pre><code class="language-bash">$ garden --quiet echo
+ echo hello
hello
+ echo world
world
</code></pre>
<p>Lines starting with <code>+</code> display the command being used.</p>
<p>The following is printed instead when "echo mode" is not enabled.</p>
<pre><code class="language-bash">$ garden --quiet echo
hello
world
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<h2 id="upcoming"><a class="header" href="#upcoming">Upcoming</a></h2>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden grow</code> is now runnable from the <code>garden gui</code> commands and query results.</p>
</li>
<li>
<p><code>garden ls</code> is now runnable from the <code>garden gui</code> commands and query results.</p>
</li>
<li>
<p>Missing trees are now displayed in red in the <code>garden gui</code> query results.</p>
</li>
<li>
<p>Tree names and paths can now be copied to the system clipboard from the
<code>garden gui</code> query results.</p>
</li>
<li>
<p>Autocompletion was added to the <code>garden gui</code> query field.</p>
</li>
<li>
<p>Escape and Ctrl-Q hotkeys can now close the <code>garden gui</code> command details window.</p>
</li>
<li>
<p>The Ctrl-Q hotkey will now close the main <code>garden gui</code> window.</p>
</li>
<li>
<p><code>garden ls</code> now has <code>-G | --no-groups</code> and <code>-N | --no-gardens</code> options
for omitting groups and gardens from its output.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>The <code>v2.0.0</code> release removed <code>Cargo.lock</code> and added an entry for it to <code>.gitignore</code>.
The <code>.gitignore</code> entry has now been removed to make it easier for packagers to track
their changes.</p>
</li>
<li>
<p>The <code>yaml-rust2</code> dependency was upgraded to v0.10.</p>
</li>
</ul>
<p><strong>Documentation</strong>:</p>
<ul>
<li>Windows support was improved in <code>v1.10.1</code> to the point where we can now consider
Windows as being officially supported. This development has now been documented
in the installation section of the Garden User Guide.</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li>The Nightly Build artifacts from Gitlab CI have been updated to include <code>garden-gui</code>.</li>
</ul>
<h2 id="v200"><a class="header" href="#v200">v2.0.0</a></h2>
<p><em>Released 2025-01-26</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>A new <code>garden-gui</code> graphical user interface for Garden is now available.
Garden GUI is provided as a separate <code>cargo install garden-gui</code> crate.</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>The <code>dirs</code> dependency was upgraded to v6.0.</p>
</li>
<li>
<p>The <code>thiserror</code> dependency was upgraded to v2.0.</p>
</li>
<li>
<p>The <code>which</code> dependency was upgraded to v7.0.</p>
</li>
</ul>
<h2 id="v1101"><a class="header" href="#v1101">v1.10.1</a></h2>
<p><em>Released 2025-01-14</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden completion</code> now includes a comment in its output indicating which version of
<code>garden</code> was used to generate the completion script.</p>
</li>
<li>
<p>Windows support was improved by avoiding UNC paths.
(<a href="https://gitlab.com/garden-rs/garden/-/issues/20">#20</a>)</p>
</li>
</ul>
<h2 id="v1100"><a class="header" href="#v1100">v1.10.0</a></h2>
<p><em>Released 2024-12-14</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden grow</code> can now filter the remotes that will be updated by specifying a glob
pattern to the new <code>--remote</code> option.</p>
</li>
<li>
<p><code>garden ls</code> now has a <code>-s | --sort</code> option that allows you to sort
trees by name or modification time.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>Use of the <a href="https://rustsec.org/advisories/RUSTSEC-2024-0388">unmaintained</a>
<code>derivative</code> crate has been eliminated.</li>
</ul>
<h2 id="v191"><a class="header" href="#v191">v1.9.1</a></h2>
<p><em>Released 2024-11-06</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li><code>GARDEN_CMD_VERBOSE</code> and <code>GARDEN_CMD_QUIET</code> are now updated when using
<code>garden &lt;command&gt; -v ...</code> and <code>garden cmd &lt;command&gt; -v ...</code>.
Previously, these variables were only set when <code>-v</code> was used against the <code>garden</code>
command directly, before any sub-commands, e.g. <code>garden -v ...</code>.</li>
</ul>
<p><strong>Fixes</strong>:</p>
<ul>
<li><code>garden exec</code>'s parallel mode was made more robust.</li>
</ul>
<h2 id="v190"><a class="header" href="#v190">v1.9.0</a></h2>
<p><em>Released 2024-10-11</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li><code>garden exec</code> can now run commands in parallel using the <code>-j# | --jobs=#</code> option.
(<a href="https://github.com/garden-rs/garden/issues/43">#43</a>)</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li>Garden's Nix flake was improved and using Garden with Nix home-manager was documented.
(<a href="https://github.com/garden-rs/garden/pull/46">#46</a>)
(<a href="https://github.com/garden-rs/garden/issues/17">#17</a>)</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>Internal APIs for running commands were refactored.</p>
</li>
<li>
<p>The <code>yaml-rust2</code> dependency was upgraded to v0.9.</p>
</li>
</ul>
<h2 id="v180"><a class="header" href="#v180">v1.8.0</a></h2>
<p><em>Released 2024-09-26</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden cmd</code> and custom commands now have a <code>-j# | --jobs=#</code> option for
<a href="https://garden-rs.gitlab.io/commands.html#parallel-execution">running commands in parallel</a>.
Use <code>-j0 | --jobs=0</code> to use all available cores.
(<a href="https://github.com/garden-rs/garden/issues/43">#43</a>)
(<a href="https://github.com/garden-rs/garden/pull/45">#45</a>)</p>
</li>
<li>
<p><code>garden ls</code> now has a <code>--reverse | -r</code> option to display trees in reverse order.
(<a href="https://github.com/garden-rs/garden/pull/44">#44</a>)</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>The <code>which</code>, <code>yansi</code> and <code>strum</code> dependencies were upgraded. <code>yansi</code> was a new major version
and required a fair amount of changes. <code>strum</code> involved minor changes.
(<a href="https://github.com/garden-rs/garden/pull/42">#42</a>)</li>
</ul>
<h2 id="v170"><a class="header" href="#v170">v1.7.0</a></h2>
<p><em>Released 2024-06-29</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden ls</code> now has a <code>--commands | -c</code> option to display just commands.
The related <code>--no-commands | -C</code> option is used to omit commands from being displayed.
(<a href="https://github.com/garden-rs/garden/issues/39">#39</a>)
(<a href="https://github.com/garden-rs/garden/pull/41">#41</a>)</p>
</li>
<li>
<p><code>garden cmd</code> and <code>garden &lt;custom-command&gt;</code> now support a <code>--dry-run | -N</code> option
to perform trial runs without actually running any commands.
(<a href="https://github.com/garden-rs/garden/issues/39">#39</a>)
(<a href="https://github.com/garden-rs/garden/pull/41">#41</a>)</p>
</li>
<li>
<p><code>garden exec</code> made <code>-N</code> the short option for its <code>--dry-run</code> option and the original
<code>-n</code> short option was made an undocumented alias for compatibility.
(<a href="https://github.com/garden-rs/garden/pull/41">#41</a>)</p>
</li>
<li>
<p>The <code>garden eval</code>, <code>garden exec</code>, <code>garden cmd</code> and custom sub-commands
now accept the same <code>--define | -D name=value</code> override options as the root
<code>garden</code> command.</p>
</li>
<li>
<p><code>garden grow</code> reports more details about the commands it runs and no
longer prints redundant <code>git config</code> commands.</p>
</li>
</ul>
<p><strong>Fixes</strong>:</p>
<ul>
<li><code>garden ls</code> now prints the list of commands in the same order as they appear in <code>garden.yaml</code>.
(<a href="https://github.com/garden-rs/garden/issues/39">#39</a>)
(<a href="https://github.com/garden-rs/garden/pull/41">#41</a>)</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li>
<p>The nix flake was updated to re-enable llvm coverage.
(<a href="https://github.com/garden-rs/garden/pull/38">#38</a>)</p>
</li>
<li>
<p><code>nix run</code> can now be used to run <code>garden</code> and <code>nix shell</code> can now be used to
open a nix shell with garden installed.
(<a href="https://github.com/garden-rs/garden/pull/40">#40</a>)</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>More structs, functions and methods were made private.</p>
</li>
<li>
<p>Several types were renamed from "HashMap" to "Map".</p>
</li>
</ul>
<h2 id="v160"><a class="header" href="#v160">v1.6.0</a></h2>
<p><em>Released 2024-06-02</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>zsh</code> is now invoked using <code>zsh +o nomatch</code> for better portability across
shells. This prevents zsh from erroring when wildcard patterns find
no matches. Wildcards can be used, for example, to implement a
custom <code>clean</code> command that feeds <code>rm -f</code> using wildcard patterns,
but these commands would generate errors without disabling <code>nomatch</code>.
The zsh <code>nomatch</code> option is a less useful option for non-interactive use
so we disable it unconditionally.</p>
</li>
<li>
<p>The <code>--verbose | -v</code> option can now be passed to custom and built-in commands.
The <code>verbose</code> option was previously a global option that had to
be specified before sub-commands. The following invocations are all
equivalent now:</p>
<ul>
<li><code>garden -vv build</code></li>
<li><code>garden -v build -v</code></li>
<li><code>garden build -vv</code></li>
</ul>
<p>(<a href="https://github.com/garden-rs/garden/pull/36">#36</a>)</p>
</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li>The nix flake was updated to use Fenix for the latest stable rustc 1.78.0.
(<a href="https://github.com/garden-rs/garden/pull/37">#37</a>)</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>An <code>.envrc</code> file was added to enable the nix flake for direnv users.
(<a href="https://github.com/garden-rs/garden/pull/37">#37</a>)</li>
</ul>
<h2 id="v150"><a class="header" href="#v150">v1.5.0</a></h2>
<p><em>Released 2024-04-14</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>Running <code>garden init</code> inside a Git repository will now record the
current directory as a tree with its path set to  <code>${GARDEN_CONFIG_DIR}</code>.
(<a href="https://github.com/garden-rs/garden/pull/34">#34</a>)</p>
</li>
<li>
<p>Custom commands skip missing trees by default. A new <code>-f | --force</code>
option can be used to make <code>garden</code> run commands on missing trees.
(<a href="https://github.com/garden-rs/garden/issues/33">#33</a>)</p>
</li>
<li>
<p><code>garden plant</code> now avoids updating the configuration when a tree is
re-planted and its configuration contains expressions that evaluate
to the same value as currently exist in git.
(<a href="https://github.com/garden-rs/garden/issues/31">#31</a>)
(<a href="https://github.com/garden-rs/garden/pull/32">#32</a>)</p>
</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li><a href="https://github.com/garden-rs/garden/releases">Prebuilt binaries</a>
are now available!</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>The original github repository under <code>davvid</code>'s namespace was transferred to the
<a href="https://github.com/garden-rs/garden">garden-rs</a> organization on github.</p>
</li>
<li>
<p>The <code>yaml-rust2</code> dependency was upgraded to <code>0.8.0</code> to avoid the <code>encoding</code> crate
(<a href="https://rustsec.org/advisories/RUSTSEC-2021-0153">RUSTSEC-2021-0153</a>).</p>
</li>
</ul>
<h2 id="v141"><a class="header" href="#v141">v1.4.1</a></h2>
<p><em>Released 2024-03-22</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>The empty directory detection in <code>garden grow</code> was improved.</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>The internal APIs were updated to use <code>AsRef&lt;Path&gt;</code> wherever possible.</li>
</ul>
<h2 id="v140"><a class="header" href="#v140">v1.4.0</a></h2>
<p><em>Released 2024-03-21</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>Custom commands can now specify an interpreter to use on a per-command basis.
If a command uses a shebang <code>#!</code> line then the command's text will be passed as the
next argument to the specified command. For example, using <code>#!python3 -c</code> as the
first line in a custom command will cause <code>python3 -c &lt;command&gt;</code> to be executed.</p>
</li>
<li>
<p>Trees can now use branches defined in separate remotes when configuring the
default branch to checkout. <code>garden grow</code> will now fetch the remote associated with the
configured branch switching branches in order to make this possible.</p>
</li>
<li>
<p>Trees can now use any upstream branch from any configured remote in the <code>branches</code> section.
Previously, branches associated with non-default remotes could not be created unless
they were fetched beforehand. <code>garden grow</code> will now fetch the associated remote
before creating the local branch.</p>
</li>
<li>
<p><code>garden grow</code> now detects empty directories (e.g. the directories that are created
when using uninitialized Git submodules) and will properly clone into the empty directories
instead of treating them like an already-grown tree.
(<a href="https://github.com/garden-rs/garden/pull/30">#30</a>)</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p><code>garden</code> can now be built on Windows. Symlink trees and the XDG base directory support
is UNIX-only and disabled on Windows.
(<a href="https://gitlab.com/garden-rs/garden/-/issues/17">#17</a>)</p>
</li>
<li>
<p><a href="https://crates.io/crates/yaml-rust2">yaml-rust2</a> is now used instead of
the <a href="https://crates.io/crates/yaml-rust-davvid">yaml-rust-davvid</a> fork that was
being maintained by <a href="https://github.com/davvid">@davvid</a> for use by garden.
(<a href="https://github.com/garden-rs/garden/pull/29">#29</a>)</p>
</li>
</ul>
<h2 id="v130"><a class="header" href="#v130">v1.3.0</a></h2>
<p><em>Released 2024-02-19</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden eval</code> and garden expressions in general will now resolve variables defined
within <code>environment</code> blocks. Environment blocks were previously not considered when
resolving variables. Environment blocks are now resolved and checked for variables
when <code>${variable}</code> expressions do not find the variable in scopes with higher
precedence. The precedence order, from strongest to weakest, is the <code>variables</code>
block in a garden's scope, the <code>variables</code> block in a tree's scope, the
<code>variables</code> block in global configuration scope, the <code>environments</code> block in
a garden's scope, the <code>environments</code> block in a tree's scope, the
<code>environments</code> block in global configuration scope and, lastly, OS environment
variables. The first entry found is used when expanding variable expressions.
(<a href="https://github.com/garden-rs/garden/pull/23">#23</a>)</p>
</li>
<li>
<p>Evaluation cycles (i.e. circular variable dependencies) are now prevented when
evaluating garden variables. The evaluation engine will now return empty strings
when a variable with a cyclical expression is evaluated.
(<a href="https://github.com/garden-rs/garden/pull/24">#24</a>)</p>
</li>
<li>
<p>When <code>zsh</code> is used as the <code>garden.shell</code>, which happens automatically when <code>zsh</code>
is installed, <code>garden</code> will now use <code>zsh -o shwordsplit</code> in order to enable
word-splitting of <code>$variable</code> expressions by default. This makes <code>zsh</code> behave
just like other shells by default, which improves the portability of commands.
Configure <code>garden.shell-wordsplit</code> to <code>false</code> or use the
<code>garden &lt;cmd&gt; -z | --no-wordsplit</code> option to opt-out of this behavior.
(<a href="https://github.com/garden-rs/garden/pull/25">#25</a>)</p>
</li>
<li>
<p><code>garden.shell</code> can now be configured to use arbitrary commands for executing
command strings. Garden uses the configured <code>garden.shell</code> as-is and does
not augment its options (e.g. <code>-e</code>  or <code>-o shwordsplit</code>) when a custom command
is used. Custom commands are identified as commands that expand to 2 or more
command-line arguments. Thus, <code>python3</code> is not considered a custom command
and <code>garden</code> will run <code>python3 -c &lt;string&gt;</code> to run commands. On the other
hand, specifying <code>ruby -e</code> <em>is</em> considered a custom command because it
expands to <code>["ruby", "-e"]</code> under the hood. If you need to use a custom
command  that takes no additional command-line arguments then you can
use <code>env</code> as an extra argument to have it be considered as a custom shell.
For example, <code>env custom-shell</code> will cause <code>garden</code> to run
<code>env custom-shell &lt;string&gt;</code>, which is equivalent to <code>custom-shell &lt;string&gt;</code>.
Using just <code>custom-shell</code> would have resulted in <code>garden</code> running
<code>custom-shell -c &lt;string&gt;</code> instead, which may not be desired.
(<a href="https://github.com/garden-rs/garden/pull/26">#26</a>)</p>
</li>
<li>
<p>The <code>garden shell</code> command can now be configured to use an interactive command shell
that is distinct from the command specified in the <code>garden.shell</code> configuration by
configuring the <code>garden.interactive-shell</code> value.
(<a href="https://github.com/garden-rs/garden/pull/26">#26</a>)</p>
</li>
<li>
<p><code>garden shell</code> can now be run without any arguments. The tree query now defaults to
<code>.</code> so that the tree in the current directory is used when nothing is specified.
(<a href="https://github.com/garden-rs/garden/pull/26">#26</a>)</p>
</li>
<li>
<p>Custom commands now have access to a <code>${GARDEN_CMD_VERBOSE}</code> and <code>${GARDEN_CMD_QUIET}</code>
variables which can be used to forward the <code>--verbose</code> and <code>--quiet</code> arguments
down into child <code>garden</code> invocations. <code>${GARDEN_CMD_VERBOSE}</code> uses the short <code>-v</code>
flag in the value to support the case where the verbose option is specified
multiples times to increase the verbosity level (e.g. <code>-vv</code>).
(<a href="https://github.com/garden-rs/garden/pull/27">#27</a>)</p>
</li>
</ul>
<h2 id="v121"><a class="header" href="#v121">v1.2.1</a></h2>
<p><em>Released 2024-02-05</em></p>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>The <code>yaml-rust-davvid</code> dependency was upgraded to <code>v0.6.0</code>.</p>
</li>
<li>
<p>Documentation and code maintenance.</p>
</li>
</ul>
<h2 id="v120"><a class="header" href="#v120">v1.2.0</a></h2>
<p><em>Released 2024-01-27</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>If a garden file has no trees defined at all then an implicit tree called
<code>.</code> will now be synthesized into existence. The presence of this implicit tree
allows garden files that define just the current directory as a tree to omit
the entire <code>trees</code> section altogether. This consequently makes it easier
to use garden as a simple command runner because the <code>commands</code> section
is the only section required in order to run <code>garden</code> commands.</p>
</li>
<li>
<p>When <code>garden.root</code> is not configured <code>garden</code> will behave as if
<code>garden.root</code> is configured to <code>${GARDEN_CONFIG_DIR}</code>. This allows garden files to
omit <code>garden.root</code> from their configuration in typical scenarios.</p>
</li>
<li>
<p>Configuring <code>garden.root</code> to an empty string (<code>""</code>) will behave as if <code>garden.root</code>
is configured to the current directory from which <code>garden</code> was run.</p>
</li>
<li>
<p>When a <code>garden.yaml</code> file does not exist in the current directory then garden
will walk up the file system searching for <code>garden.yaml</code> or the name specified using
<code>garden -c &lt;name&gt;</code>. Garden will behave as if it were launched from the directory
containing the garden file when a configuration file is found.</p>
</li>
<li>
<p>The <code>GARDEN_CEILING_DIRS</code> and <code>GIT_CEILING_DIRS</code> environment variables can be
used to limit the <code>garden.yaml</code> discovery by preventing <code>garden</code> from traversing
into and beyond the specified directories when discovering garden files.</p>
</li>
<li>
<p><code>garden exec</code>, <code>garden cmd</code> <code>garden grow</code>, <code>garden ls</code> and custom garden commands
can now filter the trees they operate over by passing a glob pattern using
<code>-t | --trees</code> option. These commands will only operate on the trees whose names
match the pattern. This allows you to specify a garden as the tree query and use
the full set of environment variables from all trees in the query while
executing commands over a subset of the trees in that garden.</p>
</li>
<li>
<p><code>garden init</code> will now add the current directory to the <code>trees</code> block
when the current directory contains a Git repository. Use <code>garden init --empty</code>
to disable this behavior.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>The <code>shlex</code> dependency was upgraded to <code>1.3.0</code>, which includes fixes for
<a href="https://rustsec.org/advisories/RUSTSEC-2024-0006.html">RUSTSEC-2024-0006</a> a.k.a.
<a href="https://github.com/comex/rust-shlex/security/advisories/GHSA-r7qv-8r2h-pg27">GHSA-r7qv-8r2h-pg27</a>.</li>
</ul>
<h2 id="v110"><a class="header" href="#v110">v1.1.0</a></h2>
<p><em>Released 2024-01-15</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden ls</code> now displays information about trees, groups, gardens and commands.</p>
</li>
<li>
<p><code>garden ls -c</code> (i.e. <code>--no-commands</code>) hides command details from the output.</p>
</li>
<li>
<p><code>garden plant -s</code> (i.e. <code>--sort</code>) sorts all of the configured <code>trees</code> entries
after planting the specified trees.</p>
</li>
<li>
<p><code>garden exec -n</code> (i.e. <code>--dry-run</code>) performs a trial run without executing
any commands.</p>
</li>
<li>
<p><code>garden.shell-errexit</code> can now be configured to <code>false</code> in <code>garden.yaml</code> to
opt-out of using the <code>-e</code> exit-on-error shell option when running custom commands.</p>
</li>
<li>
<p><code>garden.shell</code> can now be configured to <code>bun</code>, <code>fish</code>, <code>node</code>, <code>perl</code> and <code>python3</code>
in addition to the traditional <code>bash</code>, <code>zsh</code>, <code>dash</code>, <code>ksh</code> and <code>sh</code> shells.
This allows you to use these interpreters to run custom commands.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>Garden is now using
<a href="https://gitlab.com/ijackson/rust-shellexpand#version-300-2022-12-01">shellexpand v3</a>.</li>
</ul>
<h2 id="v100"><a class="header" href="#v100">v1.0.0</a></h2>
<p><em>Released 2023-12-23</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>Commands can now specify pre-commands and post-commands that are run before/after
the specified command.
(<a href="https://github.com/garden-rs/garden/issues/3">#3</a>)
(<a href="https://garden-rs.gitlab.io/commands.html#pre-and-post-commands">documentation</a>)</p>
</li>
<li>
<p>The default <code>origin</code> remote name can now be configured using <code>tree.&lt;tree&gt;.default-remote</code>.
(<a href="https://gitlab.com/garden-rs/garden/-/issues/16">#16</a>)</p>
</li>
<li>
<p>Commands now display the tree's current branch alongside the tree name.
(<a href="https://github.com/garden-rs/garden/issues/18">#18</a>)</p>
</li>
<li>
<p><code>garden -vv exec</code> and <code>garden -vv shell</code> now display the command being run.</p>
</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li><code>garden</code> can now be installed as a <code>nix flake</code> package.
A <code>flake.nix</code> file is now provided.
(<a href="https://github.com/garden-rs/garden/issues/16">#16</a>)</li>
</ul>
<h2 id="v091"><a class="header" href="#v091">v0.9.1</a></h2>
<p><em>Released 2023-11-19</em></p>
<p><strong>Fixes</strong>:</p>
<ul>
<li><code>garden -D name=value</code> now overrides variables in all scopes.
Variables defined in tree scope were not subject to overrides and
will now get properly overridden by the <code>--define</code> / <code>-D</code>
command-line options.</li>
</ul>
<h2 id="v090"><a class="header" href="#v090">v0.9.0</a></h2>
<p><em>Released 2023-11-02</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li><code>garden grow</code> now sets <code>git config remote.$name.tagopt --no-tags</code>
when adding additional remotes. This prevents accidentally fetching tags
when interacting with remotes.</li>
</ul>
<h2 id="v081"><a class="header" href="#v081">v0.8.1</a></h2>
<p><em>Released 2023-07-18</em></p>
<p><strong>Fixes</strong>:</p>
<ul>
<li><code>garden grow</code> was fixed to detect existing branches when growing
<code>git worktree</code>-created child worktrees.</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p><code>strum</code> is now used to implement <code>FromStr</code> for <code>enum ColorMode</code>.</p>
</li>
<li>
<p><a href="https://crates.io/crates/is-terminal">is-terminal</a> is now used instead of
the unmaintained <code>atty</code> crate.</p>
</li>
</ul>
<h2 id="v080"><a class="header" href="#v080">v0.8.0</a></h2>
<p><em>Released 2023-07-16</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden</code> now supports a <code>grafts</code> feature that allows you to
<a href="https://garden-rs.gitlab.io/configuration.html#grafts">stitch configuration entities from separate garden files</a>
into a graft-specific namespace. Trees and variables from grafted configurations can be
referenced using <code>graft::</code> namespace qualifiers.</p>
</li>
<li>
<p><code>garden grow</code> can now configure <a href="https://garden-rs.gitlab.io/commands.html#upstream-branches">upstream branches</a>.</p>
</li>
<li>
<p><code>garden grow</code> can now configure <a href="https://garden-rs.gitlab.io/commands.html#upstream-branches#git-configuration-values">gitconfig settings with multiple values</a>
using <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt---add"><code>git config --add &lt;name&gt; &lt;value&gt;</code></a>.</p>
</li>
</ul>
<h2 id="v070"><a class="header" href="#v070">v0.7.0</a></h2>
<p><em>Released 2023-02-12</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p>Trees, Groups, Gardens and Commands defined in the top-level <code>garden.yaml</code> can now
override entries defined via <code>garden.includes</code>. Configuration entities now follow
"last one wins" semantics -- if the same entity is defined in multiple includes files
then only the final definition will be used.
(<a href="https://github.com/garden-rs/garden/issues/14">#14</a>)
(<a href="https://github.com/garden-rs/garden/pull/15">#15</a>)</p>
</li>
<li>
<p><a href="https://garden-rs.gitlab.io/configuration.html#l#the-last-one-wins-rule">Trees now sparsely override existing entries</a>.
This behavior allows a tree definition to replace just the <code>url</code> field, or to replace
individual tree commands while retaining the rest. Use <code>replace: true</code> in a Tree
definition in order to completely replace the existing entry instead of sparsely
overriding it.</p>
</li>
<li>
<p>Improved shell completions for <code>garden</code>, <code>garden init</code> and <code>garden plant</code>.</p>
</li>
</ul>
<p><strong>Packaging</strong>:</p>
<ul>
<li><a href="https://github.com/0323">0323pin</a> packaged <code>garden</code> for pkgsrc/NetBSD and
<a href="http://mail-index.netbsd.org/pkgsrc-changes/2023/01/22/msg267560.html">merged the package into the main branch!</a>
(<a href="https://github.com/garden-rs/garden/issues/13">#13</a>)</li>
</ul>
<h2 id="v060"><a class="header" href="#v060">v0.6.0</a></h2>
<p><em>Released 2023-01-20</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>Both names and values in <code>gitconfig</code> can now use <code>${var}</code> expressions.
Previously only values were evaluated. Names are evaluated now as well.</li>
</ul>
<p><strong>Fixes</strong>:</p>
<ul>
<li>The <code>zsh</code> workaround for <code>garden completion zsh</code> is no longer needed.
The <a href="https://garden-rs.gitlab.io/commands.html#zsh">documentation for generating zsh completions</a>
has been updated.
(<a href="https://github.com/garden-rs/garden/issues/10">#10</a>)</li>
</ul>
<h2 id="v051"><a class="header" href="#v051">v0.5.1</a></h2>
<p><em>Released 2023-01-15</em></p>
<p><strong>Fixes</strong>:</p>
<ul>
<li>Exec expressions were previously run with the current directory set to the
directory from which garden was run. Exec expressions are now run in the
tree's current directory.</li>
</ul>
<h2 id="v050"><a class="header" href="#v050">v0.5.0</a></h2>
<p><em>Released 2023-01-12</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><a href="https://garden-rs.gitlab.io/configuration.html#includes">Garden configuration files can now include other configuration files
</a> by specifying
the additional files to include in the <code>garden.includes</code> field.
The <code>includes</code> feature makes it possible to create modular and reusable garden files.
The <code>trees</code>, <code>variables</code>, <code>commands</code>, <code>groups</code> and <code>gardens</code> defined in the included
files are added to the current configuration.
(<a href="https://github.com/garden-rs/garden/pull/7">#7</a>)</p>
</li>
<li>
<p><a href="https://garden-rs.gitlab.io/commands.html#shell-syntax">Garden commands can now use shell variables</a>
using the standard (brace-less) shell <code>$variable</code> syntax. The braced <code>${garden}</code>
variable syntax remains reserved for resolving Garden Variables.
Double-<code>$</code> braces (ex: <code>$${...}</code>) can be used to escape a <code>$${variable}</code> from
evaluation so that a literal <code>${variable}</code> value is used in the garden command.
(<a href="https://github.com/garden-rs/garden/issues/11">#11</a>)
(<a href="https://github.com/garden-rs/garden/pull/12">#12</a>)</p>
</li>
<li>
<p>A new <code>garden completion</code> subcommand was added for providing shell command-line
completion using the <a href="https://crates.io/crates/clap_complete">clap_complete</a> crate.
(<a href="https://github.com/garden-rs/garden/pull/9">#9</a>)</p>
</li>
<li>
<p><code>garden -V | --version</code> was added alongside the <code>clap</code> rewrite for displaying
the <code>garden</code> command version.</p>
</li>
</ul>
<p><strong>Development</strong>:</p>
<ul>
<li>
<p>The <code>Makefile</code> has been replaced by a <code>garden.yaml</code> Garden file.
We can now use <code>garden {build, test, check, fmt, clippy, ...}</code> instead of <code>make ...</code>.
See <a href="https://gitlab.com/garden-rs/garden/-/raw/5ef8d0ab16a64660fef2bfc551e69cc782dfd4a3/garden.yaml">garden.yaml @ 5ef8d0ab16 for more details</a>.
Packagers can use <code>cargo install</code> to install <code>garden</code> and invoke <code>mdbook</code> directly
to install the user manual. We also provide
<code>garden -D DESTDIR=/tmp/stage -D prefix=/usr/local install-doc</code> if distros
want to install the user manual using our recipe.
(<a href="https://github.com/garden-rs/garden/pull/8">#8</a>)</p>
</li>
<li>
<p>Garden's command-line parsing has been rewritten to leverage the
<a href="https://crates.io/crates/clap">clap</a> crate and ecosystem.</p>
</li>
</ul>
<h2 id="v041"><a class="header" href="#v041">v0.4.1</a></h2>
<p><em>Released 2022-12-26</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li>The <code>garden cmd --no-errexit</code> option was extended to work with commands that are
configured using a YAML list of strings. Commands that are specified using lists
are now indistinguishable from commands specified using multi-line strings.</li>
</ul>
<h2 id="v040"><a class="header" href="#v040">v0.4.0</a></h2>
<p><em>Released 2022-12-23</em></p>
<p><strong>Breaking Changes</strong>:</p>
<ul>
<li>
<p><code>garden cmd</code> now runs custom commands using <code>&lt;shell&gt; -e -c '&lt;command&gt;'</code> by default.
The use of <code>-e</code> is a change in behavior and causes multi-line / multi-statement
commands to halt execution when the first non-zero exit code is encountered.
Use <code>set +e</code> at the top of of a multi-line command to opt-out of this behavior
on a per-command basis, or specify the <code>-n | --no-errexit</code> option.</p>
</li>
<li>
<p><code>garden</code> will now fallback to <code>bash</code> (and <code>sh</code>) as the default <code>garden.shell</code> value
when <code>zsh</code> (and <code>bash</code>) are not installed. As before, the <code>garden.shell</code>
configuration variable can be used to override the default shell.</p>
</li>
</ul>
<p><strong>Features</strong>:</p>
<ul>
<li>
<p><code>garden prune</code> was added for removing orphaned Git repositories.
(<a href="https://github.com/garden-rs/garden/issues/4">#4</a>)</p>
</li>
<li>
<p><code>garden cmd</code> can now run commands in breadth-first order when the
<code>-b/--breadth-first</code> option is used. Depth-first tree traversal is the default.
The <code>garden cmd --breadth-first</code> traversal runs all commands on a tree before
continuing on to the next tree. The default <code>garden cmd</code> depth-first traversal
runs a command across all trees before continuing on to the next command.
(<a href="https://github.com/garden-rs/garden/issues/3">#3</a>)</p>
</li>
</ul>
<h2 id="v030"><a class="header" href="#v030">v0.3.0</a></h2>
<p><em>Released 2022-08-20</em></p>
<p><strong>Features</strong>:</p>
<ul>
<li><code>garden plant</code> can now detect <code>git worktree</code> repositories.
(<a href="https://github.com/garden-rs/garden/issues/1">#1</a>)</li>
</ul>
<h2 id="v020"><a class="header" href="#v020">v0.2.0</a></h2>
<p><em>Released 2022-07-29</em></p>
<p><strong>Breaking Changes</strong>:</p>
<ul>
<li><code>garden add</code> was renamed to <code>garden plant</code>.</li>
</ul>
<p><strong>Features</strong>:</p>
<ul>
<li><code>garden grow</code> can now grow trees using "git worktree" (#1).</li>
<li><code>garden grow</code> learned to clone specific branches.</li>
<li><code>garden grow</code> and <code>garden plant</code> can now handle bare repositories.</li>
</ul>
<h2 id="v010"><a class="header" href="#v010">v0.1.0</a></h2>
<p><em>Released 2022-06-13</em></p>
<p><strong>Features</strong>:</p>
<p>This is the initial garden release.</p>
<ul>
<li><code>garden grow</code> grows worktrees.</li>
<li><code>garden init</code> initializes configuration.</li>
<li><code>garden plant</code> (formerly <code>garden add</code>) adds existing trees.</li>
<li><code>garden cmd</code> and <code>garden &lt;custom-command&gt;</code> can run custom commands.</li>
<li>Templates, variables, and environment variables are all supported.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
